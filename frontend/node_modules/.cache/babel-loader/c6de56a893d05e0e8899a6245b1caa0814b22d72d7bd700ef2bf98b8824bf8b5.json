{"ast":null,"code":"import { reactive, ref, computed, onMounted } from 'vue';\nimport { useRouter } from 'vue-router';\nimport { ElMessage } from 'element-plus';\nimport auth from '../store/auth';\n\n/* eslint-disable vue/multi-word-component-names */\nexport default {\n  name: 'LoginView',\n  setup() {\n    const router = useRouter();\n    const loginForm = ref(null);\n    const form = reactive({\n      phone: '',\n      password: '',\n      userType: 1 // 默认为员工\n    });\n    const rules = {\n      phone: [{\n        required: true,\n        message: '请输入手机号或账号',\n        trigger: 'blur'\n      }\n      // 移除手机号格式验证以便于测试\n      ],\n      password: [{\n        required: true,\n        message: '请输入密码',\n        trigger: 'blur'\n      }]\n    };\n\n    // 员工登录不需要密码，管理员需要\n    const showPassword = computed(() => form.userType !== 1);\n\n    // 切换用户类型时重置表单\n    const handleUserTypeChange = () => {\n      if (form.userType === 1) {\n        form.password = '';\n      }\n      if (loginForm.value) {\n        loginForm.value.clearValidate();\n      }\n    };\n\n    // 提交表单\n    const submitForm = () => {\n      // 无论是员工还是管理员，先验证手机号\n      loginForm.value.validateField('phone', async errorPhone => {\n        if (errorPhone) return; // 如果手机号验证失败，则停止\n\n        // 如果是管理员，还需要验证密码\n        if (showPassword.value) {\n          loginForm.value.validateField('password', async errorPwd => {\n            if (!errorPwd) {\n              await doLogin();\n            }\n          });\n        } else {\n          // 员工不需要密码，直接登录\n          await doLogin();\n        }\n      });\n    };\n\n    // 执行登录\n    const doLogin = async () => {\n      try {\n        const result = await auth.login(form.phone, form.password);\n        if (result.success) {\n          const user = result.user;\n          ElMessage.success(`欢迎，${user.username || user.phone}`);\n\n          // 根据用户角色跳转到不同页面\n          if (user.role_id === 3) {\n            // 超级管理员\n            router.push('/admin-records');\n          } else {\n            // 其他用户直接进入对应单位的填报页面\n            router.push(`/unit/${user.unit_id}`);\n          }\n        }\n      } catch (error) {\n        console.error('Login error:', error);\n      }\n    };\n\n    // 如果已登录，自动跳转\n    onMounted(() => {\n      if (auth.state.isLoggedIn) {\n        const user = auth.state.user;\n        if (user.role_id === 3) {\n          router.push('/admin-records');\n        } else {\n          router.push(`/unit/${user.unit_id}`);\n        }\n      }\n    });\n    return {\n      form,\n      rules,\n      loginForm,\n      showPassword,\n      handleUserTypeChange,\n      submitForm,\n      auth\n    };\n  }\n};","map":{"version":3,"names":["reactive","ref","computed","onMounted","useRouter","ElMessage","auth","name","setup","router","loginForm","form","phone","password","userType","rules","required","message","trigger","showPassword","handleUserTypeChange","value","clearValidate","submitForm","validateField","errorPhone","errorPwd","doLogin","result","login","success","user","username","role_id","push","unit_id","error","console","state","isLoggedIn"],"sources":["C:\\Users\\10150\\Desktop\\hazardous-waste-management\\frontend\\src\\views\\Login.vue"],"sourcesContent":["<template>\n  <div class=\"login-container\">\n    <div class=\"login-card\">\n      <div class=\"login-header\">\n        <h1>危险废物管理系统</h1>\n        <h2>用户登录</h2>\n      </div>\n      \n      <el-form \n        ref=\"loginForm\" \n        :model=\"form\" \n        :rules=\"rules\" \n        label-width=\"80px\"\n        class=\"login-form\"\n      >\n        <el-form-item label=\"账号\" prop=\"phone\">\n          <el-input \n            v-model=\"form.phone\" \n            placeholder=\"请输入账号\" \n            @keyup.enter=\"submitForm\"\n          />\n        </el-form-item>\n        \n        <el-form-item v-if=\"showPassword\" label=\"密码\" prop=\"password\">\n          <el-input \n            v-model=\"form.password\" \n            type=\"password\" \n            placeholder=\"请输入密码\" \n            show-password\n            @keyup.enter=\"submitForm\"\n          />\n        </el-form-item>\n        \n        <el-form-item>\n          <el-radio-group v-model=\"form.userType\" @change=\"handleUserTypeChange\">\n            <el-radio :label=\"1\">员工</el-radio>\n            <el-radio :label=\"2\">单位管理员</el-radio>\n            <el-radio :label=\"3\">超级管理员</el-radio>\n          </el-radio-group>\n        </el-form-item>\n        \n        <el-form-item>\n          <el-button \n            type=\"primary\" \n            @click=\"submitForm\" \n            :loading=\"auth.state.loading\"\n            style=\"width: 100%\"\n          >\n            登录\n          </el-button>\n        </el-form-item>\n      </el-form>\n      \n      <div v-if=\"auth.state.error\" class=\"login-error\">\n        {{ auth.state.error }}\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { reactive, ref, computed, onMounted } from 'vue';\nimport { useRouter } from 'vue-router';\nimport { ElMessage } from 'element-plus';\nimport auth from '../store/auth';\n\n/* eslint-disable vue/multi-word-component-names */\nexport default {\n  name: 'LoginView',\n  setup() {\n    const router = useRouter();\n    const loginForm = ref(null);\n    \n    const form = reactive({\n      phone: '',\n      password: '',\n      userType: 1 // 默认为员工\n    });\n    \n    const rules = {\n      phone: [\n        { required: true, message: '请输入手机号或账号', trigger: 'blur' }\n        // 移除手机号格式验证以便于测试\n      ],\n      password: [\n        { required: true, message: '请输入密码', trigger: 'blur' }\n      ]\n    };\n    \n    // 员工登录不需要密码，管理员需要\n    const showPassword = computed(() => form.userType !== 1);\n    \n    // 切换用户类型时重置表单\n    const handleUserTypeChange = () => {\n      if (form.userType === 1) {\n        form.password = '';\n      }\n      if (loginForm.value) {\n        loginForm.value.clearValidate();\n      }\n    };\n    \n    // 提交表单\n    const submitForm = () => {\n      // 无论是员工还是管理员，先验证手机号\n      loginForm.value.validateField('phone', async (errorPhone) => {\n        if (errorPhone) return; // 如果手机号验证失败，则停止\n        \n        // 如果是管理员，还需要验证密码\n        if (showPassword.value) {\n          loginForm.value.validateField('password', async (errorPwd) => {\n            if (!errorPwd) {\n              await doLogin();\n            }\n          });\n        } else {\n          // 员工不需要密码，直接登录\n          await doLogin();\n        }\n      });\n    };\n    \n    // 执行登录\n    const doLogin = async () => {\n      try {\n        const result = await auth.login(form.phone, form.password);\n        \n        if (result.success) {\n          const user = result.user;\n          \n          ElMessage.success(`欢迎，${user.username || user.phone}`);\n          \n          // 根据用户角色跳转到不同页面\n          if (user.role_id === 3) {\n            // 超级管理员\n            router.push('/admin-records');\n          } else {\n            // 其他用户直接进入对应单位的填报页面\n            router.push(`/unit/${user.unit_id}`);\n          }\n        }\n      } catch (error) {\n        console.error('Login error:', error);\n      }\n    };\n    \n    // 如果已登录，自动跳转\n    onMounted(() => {\n      if (auth.state.isLoggedIn) {\n        const user = auth.state.user;\n        if (user.role_id === 3) {\n          router.push('/admin-records');\n        } else {\n          router.push(`/unit/${user.unit_id}`);\n        }\n      }\n    });\n    \n    return {\n      form,\n      rules,\n      loginForm,\n      showPassword,\n      handleUserTypeChange,\n      submitForm,\n      auth\n    };\n  }\n};\n</script>\n\n<style scoped>\n.login-container {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  min-height: 100vh;\n  background-color: #f0f2f5;\n}\n\n.login-card {\n  width: 400px;\n  padding: 30px;\n  background-color: #fff;\n  border-radius: 8px;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n}\n\n.login-header {\n  text-align: center;\n  margin-bottom: 30px;\n}\n\n.login-header h1 {\n  font-size: 24px;\n  color: #409EFF;\n  margin-bottom: 10px;\n}\n\n.login-header h2 {\n  font-size: 18px;\n  color: #555;\n  font-weight: normal;\n}\n\n.login-form {\n  margin-top: 20px;\n}\n\n.login-error {\n  color: #f56c6c;\n  text-align: center;\n  margin-top: 15px;\n  font-size: 14px;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}