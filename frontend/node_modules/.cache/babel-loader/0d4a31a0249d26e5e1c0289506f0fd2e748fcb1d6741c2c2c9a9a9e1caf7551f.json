{"ast":null,"code":"// 用于导出数据到CSV和Excel的工具函数\nimport * as XLSX from 'xlsx';\nimport Table2Excel from 'js-table2excel';\n// import { saveAs } from 'file-saver';\n\n// 检查XLSX库是否正确加载\nconsole.log('XLSX库版本:', XLSX.version);\nconsole.log('XLSX库可用方法:', Object.keys(XLSX).join(', '));\n\n// 解析照片路径函数（与页面中使用的方式相同）\nconst parsePhotoPath = path => {\n  if (!path) return [];\n  try {\n    // 尝试解析为JSON\n    if (typeof path === 'string' && path.startsWith('[') && path.endsWith(']')) {\n      return JSON.parse(path);\n    }\n    // 如果不是JSON格式，则将其作为单个路径返回\n    return [path];\n  } catch (error) {\n    console.error('解析照片路径失败:', error);\n    // 如果解析失败，将其作为单个路径返回\n    return [path];\n  }\n};\n\n// 将图片URL转换为Base64\nconst imageUrlToBase64 = url => {\n  console.log('开始转换图片URL到Base64:', url);\n  return new Promise((resolve, reject) => {\n    const img = new Image();\n    img.crossOrigin = 'Anonymous'; // 处理跨域问题\n    console.log('设置图片crossOrigin为Anonymous');\n    img.onload = () => {\n      console.log('图片加载成功，尺寸:', img.width, 'x', img.height);\n      try {\n        const canvas = document.createElement('canvas');\n        canvas.width = img.width;\n        canvas.height = img.height;\n        console.log('创建canvas元素，尺寸:', canvas.width, 'x', canvas.height);\n        const ctx = canvas.getContext('2d');\n        ctx.drawImage(img, 0, 0);\n        console.log('图片已绘制到canvas');\n        const dataURL = canvas.toDataURL('image/jpeg');\n        console.log('转换为dataURL成功，长度:', dataURL.length);\n        console.log('dataURL前30个字符:', dataURL.substring(0, 30) + '...');\n        resolve(dataURL);\n      } catch (error) {\n        console.error('转换图片失败:', error);\n        console.error('错误详情:', error.message);\n        console.error('错误堆栈:', error.stack);\n        reject(error);\n      }\n    };\n    img.onerror = error => {\n      console.error('加载图片失败:', error);\n      console.error('图片URL:', url);\n      console.error('错误类型:', typeof error);\n      console.error('错误详情:', error ? error.message : 'Unknown error');\n      reject(error);\n    };\n    console.log('设置图片src:', url);\n    img.src = url;\n\n    // 添加超时处理\n    setTimeout(() => {\n      if (!img.complete) {\n        console.error('图片加载超时:', url);\n        reject(new Error('Image loading timeout'));\n      }\n    }, 10000); // 10秒超时\n  });\n};\n\n/**\r\n * 使用js-table2excel将数据导出为Excel文件，包含图片\r\n * @param {Array} data - 要导出的数据数组\r\n * @param {String} fileName - 导出的文件名（不含后缀）\r\n * @param {Array} headers - 要导出的列标题和对应字段名\r\n */\nexport const exportToExcelWithImages = async (data, fileName, headers) => {\n  if (!data || data.length === 0) {\n    console.error('导出失败：没有数据');\n    return false;\n  }\n  try {\n    console.log('使用js-table2excel导出Excel，开始处理图片...');\n    console.log('数据条数:', data.length);\n    console.log('第一条数据示例:', JSON.stringify(data[0]).substring(0, 200) + '...');\n\n    // 处理文件名\n    fileName = fileName.replace(/[\\\\/:*?\"<>|]/g, '_');\n    const timestamp = new Date().toISOString().replace(/[-:.]/g, '').substring(0, 14);\n    const fullFileName = `${fileName}_${timestamp}`;\n    console.log('导出文件名:', fullFileName);\n\n    // 预处理图片，确保所有图片都加载完成\n    const processedData = [];\n\n    // 逐行处理数据\n    for (let rowIndex = 0; rowIndex < data.length; rowIndex++) {\n      console.log(`处理第 ${rowIndex + 1}/${data.length} 条记录...`);\n      const row = data[rowIndex];\n      const record = row['__original'] || {};\n      console.log(`记录ID: ${record.id || 'unknown'}`);\n\n      // 处理清理前照片\n      let beforePhotoData = null;\n      if (record.photo_path_before) {\n        console.log(`记录 ${rowIndex} 清理前照片路径:`, record.photo_path_before);\n        const photoPaths = parsePhotoPath(record.photo_path_before);\n        console.log(`解析后的照片路径:`, photoPaths);\n        if (photoPaths && photoPaths.length > 0) {\n          const firstPath = photoPaths[0];\n          console.log(`选择第一张照片:`, firstPath);\n\n          // 构建完整URL\n          const imageUrl = window.location.origin + firstPath;\n          console.log(`记录 ${rowIndex} 清理前照片完整URL:`, imageUrl);\n          try {\n            console.log(`开始转换清理前照片...`);\n            beforePhotoData = await imageUrlToBase64(imageUrl);\n            console.log(`记录 ${rowIndex} 清理前照片已转换为Base64，长度:`, beforePhotoData ? beforePhotoData.length : 0);\n          } catch (error) {\n            console.error(`记录 ${rowIndex} 清理前照片转换失败:`, error);\n          }\n        } else {\n          console.log(`记录 ${rowIndex} 没有有效的清理前照片路径`);\n        }\n      } else {\n        console.log(`记录 ${rowIndex} 没有清理前照片`);\n      }\n\n      // 处理清理后照片\n      let afterPhotoData = null;\n      if (record.photo_path_after) {\n        console.log(`记录 ${rowIndex} 清理后照片路径:`, record.photo_path_after);\n        const photoPaths = parsePhotoPath(record.photo_path_after);\n        console.log(`解析后的照片路径:`, photoPaths);\n        if (photoPaths && photoPaths.length > 0) {\n          const firstPath = photoPaths[0];\n          console.log(`选择第一张照片:`, firstPath);\n\n          // 构建完整URL\n          const imageUrl = window.location.origin + firstPath;\n          console.log(`记录 ${rowIndex} 清理后照片完整URL:`, imageUrl);\n          try {\n            console.log(`开始转换清理后照片...`);\n            afterPhotoData = await imageUrlToBase64(imageUrl);\n            console.log(`记录 ${rowIndex} 清理后照片已转换为Base64，长度:`, afterPhotoData ? afterPhotoData.length : 0);\n          } catch (error) {\n            console.error(`记录 ${rowIndex} 清理后照片转换失败:`, error);\n          }\n        } else {\n          console.log(`记录 ${rowIndex} 没有有效的清理后照片路径`);\n        }\n      } else {\n        console.log(`记录 ${rowIndex} 没有清理后照片`);\n      }\n\n      // 保存处理后的数据\n      processedData.push({\n        ...row,\n        __beforePhotoData: beforePhotoData,\n        __afterPhotoData: afterPhotoData\n      });\n      console.log(`记录 ${rowIndex} 处理完成`);\n    }\n    console.log('所有图片处理完成，开始创建Excel...');\n    console.log('处理后的数据条数:', processedData.length);\n\n    // 创建一个临时表格元素\n    const table = document.createElement('table');\n    table.style.display = 'none';\n    document.body.appendChild(table);\n    console.log('创建临时表格元素');\n\n    // 创建表头\n    const thead = document.createElement('thead');\n    const headerRow = document.createElement('tr');\n    headers.forEach(header => {\n      const th = document.createElement('th');\n      th.textContent = header.text;\n      headerRow.appendChild(th);\n    });\n    thead.appendChild(headerRow);\n    table.appendChild(thead);\n    console.log('表头创建完成');\n\n    // 创建表体\n    const tbody = document.createElement('tbody');\n\n    // 添加数据行\n    processedData.forEach((row, index) => {\n      console.log(`创建第 ${index + 1}/${processedData.length} 行...`);\n      const tr = document.createElement('tr');\n      headers.forEach(header => {\n        const td = document.createElement('td');\n\n        // 处理清理前照片列\n        if (header.field === '清理前照片') {\n          if (row.__beforePhotoData) {\n            console.log(`添加第 ${index + 1} 行清理前照片，Base64长度:`, row.__beforePhotoData.length);\n            // 使用Base64数据创建图片\n            const img = document.createElement('img');\n            img.src = row.__beforePhotoData;\n            img.style.width = '100px';\n            img.style.height = '100px';\n            td.appendChild(img);\n            console.log(`第 ${index + 1} 行清理前照片添加成功`);\n          } else {\n            td.textContent = '无图片';\n            console.log(`第 ${index + 1} 行没有清理前照片`);\n          }\n        }\n        // 处理清理后照片列 \n        else if (header.field === '清理后照片') {\n          if (row.__afterPhotoData) {\n            console.log(`添加第 ${index + 1} 行清理后照片，Base64长度:`, row.__afterPhotoData.length);\n            // 使用Base64数据创建图片\n            const img = document.createElement('img');\n            img.src = row.__afterPhotoData;\n            img.style.width = '100px';\n            img.style.height = '100px';\n            td.appendChild(img);\n            console.log(`第 ${index + 1} 行清理后照片添加成功`);\n          } else {\n            td.textContent = '无图片';\n            console.log(`第 ${index + 1} 行没有清理后照片`);\n          }\n        } else {\n          // 普通文本列\n          td.textContent = row[header.field] || '';\n        }\n        tr.appendChild(td);\n      });\n      tbody.appendChild(tr);\n      console.log(`第 ${index + 1} 行创建完成`);\n    });\n    table.appendChild(tbody);\n    console.log('表格创建完成');\n\n    // 检查表格内容\n    console.log('表格行数:', table.rows.length);\n    console.log('表格列数:', table.rows[0] ? table.rows[0].cells.length : 0);\n\n    // 使用js-table2excel导出\n    console.log('开始使用js-table2excel导出...');\n    const table2excel = new Table2Excel();\n    console.log('Table2Excel实例创建成功');\n    try {\n      console.log('调用export方法...');\n      table2excel.export(table, fullFileName);\n      console.log('export方法调用成功');\n    } catch (exportError) {\n      console.error('export方法调用失败:', exportError);\n      throw exportError;\n    }\n\n    // 导出完成后移除临时表格\n    document.body.removeChild(table);\n    console.log('临时表格已移除');\n    return true;\n  } catch (error) {\n    console.error('使用js-table2excel导出Excel失败:', error);\n    console.error('错误详情:', error.message);\n    console.error('错误堆栈:', error.stack);\n\n    // 如果js-table2excel导出失败，尝试使用CSV导出\n    try {\n      console.log('尝试使用CSV导出...');\n\n      // 准备CSV内容\n      let csvContent = '';\n\n      // 添加表头\n      csvContent += headers.map(header => `\"${header.text}\"`).join(',') + '\\n';\n\n      // 添加数据行\n      data.forEach(row => {\n        const rowData = headers.map(header => {\n          const value = row[header.field] || '';\n          // 如果值包含逗号、双引号或换行符，需要用双引号包裹并转义内部的双引号\n          if (value.includes(',') || value.includes('\"') || value.includes('\\n')) {\n            return `\"${value.replace(/\"/g, '\"\"')}\"`;\n          }\n          return `\"${value}\"`;\n        });\n        csvContent += rowData.join(',') + '\\n';\n      });\n\n      // 创建Blob对象\n      const blob = new Blob([csvContent], {\n        type: 'text/csv;charset=utf-8;'\n      });\n\n      // 创建下载链接\n      const link = document.createElement('a');\n      const url = URL.createObjectURL(blob);\n      link.setAttribute('href', url);\n      link.setAttribute('download', `${fileName}_${new Date().toISOString().replace(/[-:.]/g, '').substring(0, 14)}.csv`);\n      link.style.visibility = 'hidden';\n      document.body.appendChild(link);\n\n      // 触发下载\n      link.click();\n\n      // 清理\n      document.body.removeChild(link);\n      URL.revokeObjectURL(url);\n      return true;\n    } catch (csvError) {\n      console.error('CSV导出也失败:', csvError);\n      return false;\n    }\n  }\n};\n\n/**\r\n * 将数据导出为Excel文件\r\n * @param {Array} data - 要导出的数据数组\r\n * @param {String} fileName - 导出的文件名（不含后缀）\r\n * @param {Array} headers - 要导出的列标题和对应字段名\r\n * @param {Object} imageData - 图片数据对象（可选）\r\n */\nexport const exportToExcel = (data, fileName, headers, imageData = null) => {\n  if (!data || data.length === 0) {\n    console.error('导出失败：没有数据');\n    return false;\n  }\n\n  // 处理文件名\n  fileName = fileName.replace(/[\\\\/:*?\"<>|]/g, '_');\n  const timestamp = new Date().toISOString().replace(/[-:.]/g, '').substring(0, 14);\n  console.log('导出函数被调用，数据条数:', data.length);\n  console.log('是否有图片数据:', imageData ? '是' : '否');\n  if (imageData) {\n    console.log('图片数据条数:', Object.keys(imageData).length);\n  }\n\n  // 强制使用XLSX导出Excel（不管是否有图片）\n  try {\n    console.log('尝试导出Excel...');\n\n    // 创建工作簿\n    const wb = XLSX.utils.book_new();\n    console.log('工作簿创建成功');\n\n    // 准备数据\n    let enhancedData = [];\n\n    // 如果有图片数据，添加图片链接\n    if (imageData && Object.keys(imageData).length > 0) {\n      enhancedData = data.map((row, index) => {\n        const newRow = {\n          ...row\n        };\n\n        // 检查是否有图片数据\n        if (imageData[index]) {\n          // 添加图片链接\n          if (imageData[index][7] && imageData[index][7].url) {\n            newRow['清理前照片'] = imageData[index][7].url;\n          }\n          if (imageData[index][8] && imageData[index][8].url) {\n            newRow['清理后照片'] = imageData[index][8].url;\n          }\n        }\n        return newRow;\n      });\n    } else {\n      enhancedData = data;\n    }\n    console.log('数据准备完成，开始创建工作表');\n\n    // 创建工作表\n    const ws = XLSX.utils.json_to_sheet(enhancedData);\n    console.log('工作表创建成功');\n\n    // 设置列宽\n    const colWidths = headers.map(() => ({\n      wch: 20\n    }));\n    ws['!cols'] = colWidths;\n\n    // 添加工作表到工作簿\n    XLSX.utils.book_append_sheet(wb, ws, '危险废物记录');\n    console.log('工作表已添加到工作簿');\n\n    // 导出Excel文件\n    const excelFileName = `${fileName}_${timestamp}.xlsx`;\n    console.log('准备导出Excel文件:', excelFileName);\n\n    // 使用write方法导出\n    console.log('使用XLSX.write方法导出...');\n    const wbout = XLSX.write(wb, {\n      bookType: 'xlsx',\n      type: 'array'\n    });\n    console.log('Excel数据生成成功，大小:', wbout.length, '字节');\n\n    // 创建Blob对象\n    const blob = new Blob([wbout], {\n      type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'\n    });\n    console.log('Blob创建成功，大小:', blob.size, '字节');\n\n    // 创建下载链接\n    const url = URL.createObjectURL(blob);\n    console.log('URL创建成功:', url.substring(0, 30) + '...');\n    const link = document.createElement('a');\n    link.href = url;\n    link.download = excelFileName;\n    console.log('下载链接创建成功，准备触发点击');\n\n    // 触发下载\n    document.body.appendChild(link);\n    link.click();\n    document.body.removeChild(link);\n    URL.revokeObjectURL(url);\n    console.log('Excel导出成功');\n    return true;\n  } catch (error) {\n    console.error('导出Excel失败，错误详情:', error);\n    console.log('回退到CSV导出');\n    // 如果Excel导出失败，回退到CSV导出\n    exportToCSV(data, fileName, headers);\n    return false;\n  }\n};\n\n/**\r\n * 导出为CSV文件\r\n * @param {Array} data - 数据数组\r\n * @param {String} fileName - 文件名\r\n * @param {Array} headers - 表头配置\r\n */\nexport const exportToCSV = (data, fileName, headers) => {\n  // 处理文件名\n  const timestamp = new Date().toISOString().replace(/[-:.]/g, '').substring(0, 14);\n  const csvFileName = `${fileName}_${timestamp}.csv`;\n\n  // 准备CSV内容\n  let csvContent = '\\uFEFF'; // 添加BOM以支持中文\n\n  // 添加表头\n  const headerRow = headers.map(h => `\"${h.title}\"`).join(',');\n  csvContent += headerRow + '\\r\\n';\n\n  // 添加数据行\n  data.forEach(item => {\n    const row = headers.map(header => {\n      const value = item[header.field];\n\n      // 处理null和undefined\n      if (value === null || value === undefined) {\n        return '';\n      }\n\n      // 处理数字\n      if (header.type === 'number' || typeof value === 'number') {\n        return value;\n      }\n\n      // 处理字符串，特别是包含逗号、引号或换行符的字符串\n      let cellValue = String(value);\n      if (cellValue.includes(',') || cellValue.includes('\"') || cellValue.includes('\\n')) {\n        cellValue = cellValue.replace(/\"/g, '\"\"'); // 将引号替换为两个引号\n        cellValue = `\"${cellValue}\"`; // 用引号包裹整个值\n      }\n      return cellValue;\n    }).join(',');\n    csvContent += row + '\\r\\n';\n  });\n\n  // 创建下载链接\n  const blob = new Blob([csvContent], {\n    type: 'text/csv;charset=utf-8;'\n  });\n  const url = URL.createObjectURL(blob);\n  const link = document.createElement('a');\n  link.setAttribute('href', url);\n  link.setAttribute('download', csvFileName);\n  link.style.visibility = 'hidden';\n  document.body.appendChild(link);\n  link.click();\n  document.body.removeChild(link);\n  URL.revokeObjectURL(url);\n  console.log('CSV导出成功');\n};\n\n/**\r\n * 准备图片数据用于导出\r\n * @param {Array} records - 记录数据\r\n * @param {String} baseUrl - 基础URL\r\n * @returns {Object} 图片数据对象\r\n */\nexport const prepareImageExportData = async (records, baseUrl) => {\n  const imageData = {};\n  try {\n    console.log('准备图片数据，记录数:', records.length);\n    console.log('基础URL:', baseUrl);\n\n    // 处理每条记录的图片\n    records.forEach((record, index) => {\n      imageData[index] = {\n        beforeImages: [],\n        afterImages: []\n      };\n\n      // 处理清理前照片\n      if (record.photo_path_before) {\n        console.log(`记录 ${index} 清理前照片路径:`, record.photo_path_before);\n        let beforePaths = [];\n        try {\n          // 尝试解析JSON\n          if (typeof record.photo_path_before === 'string' && record.photo_path_before.startsWith('[')) {\n            beforePaths = JSON.parse(record.photo_path_before);\n            console.log(`记录 ${index} 解析后的清理前照片路径:`, beforePaths);\n          } else {\n            beforePaths = [record.photo_path_before];\n          }\n        } catch (e) {\n          console.error('解析清理前照片路径失败:', e);\n          beforePaths = [record.photo_path_before];\n        }\n\n        // 添加完整URL\n        imageData[index].beforeImages = beforePaths.map(path => {\n          // 确保路径是字符串\n          const pathStr = String(path);\n          // 如果路径已经是完整URL，则直接返回\n          if (pathStr.startsWith('http://') || pathStr.startsWith('https://')) {\n            return pathStr;\n          }\n          // 否则拼接基础URL\n          return `${baseUrl}${pathStr}`;\n        });\n        console.log(`记录 ${index} 完整的清理前照片URL:`, imageData[index].beforeImages);\n      }\n\n      // 处理清理后照片\n      if (record.photo_path_after) {\n        console.log(`记录 ${index} 清理后照片路径:`, record.photo_path_after);\n        let afterPaths = [];\n        try {\n          // 尝试解析JSON\n          if (typeof record.photo_path_after === 'string' && record.photo_path_after.startsWith('[')) {\n            afterPaths = JSON.parse(record.photo_path_after);\n            console.log(`记录 ${index} 解析后的清理后照片路径:`, afterPaths);\n          } else {\n            afterPaths = [record.photo_path_after];\n          }\n        } catch (e) {\n          console.error('解析清理后照片路径失败:', e);\n          afterPaths = [record.photo_path_after];\n        }\n\n        // 添加完整URL\n        imageData[index].afterImages = afterPaths.map(path => {\n          // 确保路径是字符串\n          const pathStr = String(path);\n          // 如果路径已经是完整URL，则直接返回\n          if (pathStr.startsWith('http://') || pathStr.startsWith('https://')) {\n            return pathStr;\n          }\n          // 否则拼接基础URL\n          return `${baseUrl}${pathStr}`;\n        });\n        console.log(`记录 ${index} 完整的清理后照片URL:`, imageData[index].afterImages);\n      }\n    });\n    console.log('图片数据准备完成，总记录数:', Object.keys(imageData).length);\n    return imageData;\n  } catch (error) {\n    console.error('准备图片数据失败:', error);\n    return {};\n  }\n};","map":{"version":3,"names":["XLSX","Table2Excel","console","log","version","Object","keys","join","parsePhotoPath","path","startsWith","endsWith","JSON","parse","error","imageUrlToBase64","url","Promise","resolve","reject","img","Image","crossOrigin","onload","width","height","canvas","document","createElement","ctx","getContext","drawImage","dataURL","toDataURL","length","substring","message","stack","onerror","src","setTimeout","complete","Error","exportToExcelWithImages","data","fileName","headers","stringify","replace","timestamp","Date","toISOString","fullFileName","processedData","rowIndex","row","record","id","beforePhotoData","photo_path_before","photoPaths","firstPath","imageUrl","window","location","origin","afterPhotoData","photo_path_after","push","__beforePhotoData","__afterPhotoData","table","style","display","body","appendChild","thead","headerRow","forEach","header","th","textContent","text","tbody","index","tr","td","field","rows","cells","table2excel","export","exportError","removeChild","csvContent","map","rowData","value","includes","blob","Blob","type","link","URL","createObjectURL","setAttribute","visibility","click","revokeObjectURL","csvError","exportToExcel","imageData","wb","utils","book_new","enhancedData","newRow","ws","json_to_sheet","colWidths","wch","book_append_sheet","excelFileName","wbout","write","bookType","size","href","download","exportToCSV","csvFileName","h","title","item","undefined","cellValue","String","prepareImageExportData","records","baseUrl","beforeImages","afterImages","beforePaths","e","pathStr","afterPaths"],"sources":["F:/Project/Hazardous-waste-management-system/frontend/src/utils/exportUtils.js"],"sourcesContent":["// 用于导出数据到CSV和Excel的工具函数\r\nimport * as XLSX from 'xlsx';\r\nimport Table2Excel from 'js-table2excel';\r\n// import { saveAs } from 'file-saver';\r\n\r\n// 检查XLSX库是否正确加载\r\nconsole.log('XLSX库版本:', XLSX.version);\r\nconsole.log('XLSX库可用方法:', Object.keys(XLSX).join(', '));\r\n\r\n// 解析照片路径函数（与页面中使用的方式相同）\r\nconst parsePhotoPath = (path) => {\r\n  if (!path) return [];\r\n  \r\n  try {\r\n    // 尝试解析为JSON\r\n    if (typeof path === 'string' && path.startsWith('[') && path.endsWith(']')) {\r\n      return JSON.parse(path);\r\n    }\r\n    // 如果不是JSON格式，则将其作为单个路径返回\r\n    return [path];\r\n  } catch (error) {\r\n    console.error('解析照片路径失败:', error);\r\n    // 如果解析失败，将其作为单个路径返回\r\n    return [path];\r\n  }\r\n};\r\n\r\n// 将图片URL转换为Base64\r\nconst imageUrlToBase64 = (url) => {\r\n  console.log('开始转换图片URL到Base64:', url);\r\n  return new Promise((resolve, reject) => {\r\n    const img = new Image();\r\n    img.crossOrigin = 'Anonymous'; // 处理跨域问题\r\n    console.log('设置图片crossOrigin为Anonymous');\r\n    \r\n    img.onload = () => {\r\n      console.log('图片加载成功，尺寸:', img.width, 'x', img.height);\r\n      try {\r\n        const canvas = document.createElement('canvas');\r\n        canvas.width = img.width;\r\n        canvas.height = img.height;\r\n        console.log('创建canvas元素，尺寸:', canvas.width, 'x', canvas.height);\r\n        \r\n        const ctx = canvas.getContext('2d');\r\n        ctx.drawImage(img, 0, 0);\r\n        console.log('图片已绘制到canvas');\r\n        \r\n        const dataURL = canvas.toDataURL('image/jpeg');\r\n        console.log('转换为dataURL成功，长度:', dataURL.length);\r\n        console.log('dataURL前30个字符:', dataURL.substring(0, 30) + '...');\r\n        \r\n        resolve(dataURL);\r\n      } catch (error) {\r\n        console.error('转换图片失败:', error);\r\n        console.error('错误详情:', error.message);\r\n        console.error('错误堆栈:', error.stack);\r\n        reject(error);\r\n      }\r\n    };\r\n    \r\n    img.onerror = (error) => {\r\n      console.error('加载图片失败:', error);\r\n      console.error('图片URL:', url);\r\n      console.error('错误类型:', typeof error);\r\n      console.error('错误详情:', error ? error.message : 'Unknown error');\r\n      reject(error);\r\n    };\r\n    \r\n    console.log('设置图片src:', url);\r\n    img.src = url;\r\n    \r\n    // 添加超时处理\r\n    setTimeout(() => {\r\n      if (!img.complete) {\r\n        console.error('图片加载超时:', url);\r\n        reject(new Error('Image loading timeout'));\r\n      }\r\n    }, 10000); // 10秒超时\r\n  });\r\n};\r\n\r\n/**\r\n * 使用js-table2excel将数据导出为Excel文件，包含图片\r\n * @param {Array} data - 要导出的数据数组\r\n * @param {String} fileName - 导出的文件名（不含后缀）\r\n * @param {Array} headers - 要导出的列标题和对应字段名\r\n */\r\nexport const exportToExcelWithImages = async (data, fileName, headers) => {\r\n  if (!data || data.length === 0) {\r\n    console.error('导出失败：没有数据');\r\n    return false;\r\n  }\r\n\r\n  try {\r\n    console.log('使用js-table2excel导出Excel，开始处理图片...');\r\n    console.log('数据条数:', data.length);\r\n    console.log('第一条数据示例:', JSON.stringify(data[0]).substring(0, 200) + '...');\r\n    \r\n    // 处理文件名\r\n    fileName = fileName.replace(/[\\\\/:*?\"<>|]/g, '_');\r\n    const timestamp = new Date().toISOString().replace(/[-:.]/g, '').substring(0, 14);\r\n    const fullFileName = `${fileName}_${timestamp}`;\r\n    console.log('导出文件名:', fullFileName);\r\n    \r\n    // 预处理图片，确保所有图片都加载完成\r\n    const processedData = [];\r\n    \r\n    // 逐行处理数据\r\n    for (let rowIndex = 0; rowIndex < data.length; rowIndex++) {\r\n      console.log(`处理第 ${rowIndex + 1}/${data.length} 条记录...`);\r\n      const row = data[rowIndex];\r\n      const record = row['__original'] || {};\r\n      console.log(`记录ID: ${record.id || 'unknown'}`);\r\n      \r\n      // 处理清理前照片\r\n      let beforePhotoData = null;\r\n      if (record.photo_path_before) {\r\n        console.log(`记录 ${rowIndex} 清理前照片路径:`, record.photo_path_before);\r\n        const photoPaths = parsePhotoPath(record.photo_path_before);\r\n        console.log(`解析后的照片路径:`, photoPaths);\r\n        \r\n        if (photoPaths && photoPaths.length > 0) {\r\n          const firstPath = photoPaths[0];\r\n          console.log(`选择第一张照片:`, firstPath);\r\n          \r\n          // 构建完整URL\r\n          const imageUrl = window.location.origin + firstPath;\r\n          console.log(`记录 ${rowIndex} 清理前照片完整URL:`, imageUrl);\r\n          \r\n          try {\r\n            console.log(`开始转换清理前照片...`);\r\n            beforePhotoData = await imageUrlToBase64(imageUrl);\r\n            console.log(`记录 ${rowIndex} 清理前照片已转换为Base64，长度:`, beforePhotoData ? beforePhotoData.length : 0);\r\n          } catch (error) {\r\n            console.error(`记录 ${rowIndex} 清理前照片转换失败:`, error);\r\n          }\r\n        } else {\r\n          console.log(`记录 ${rowIndex} 没有有效的清理前照片路径`);\r\n        }\r\n      } else {\r\n        console.log(`记录 ${rowIndex} 没有清理前照片`);\r\n      }\r\n      \r\n      // 处理清理后照片\r\n      let afterPhotoData = null;\r\n      if (record.photo_path_after) {\r\n        console.log(`记录 ${rowIndex} 清理后照片路径:`, record.photo_path_after);\r\n        const photoPaths = parsePhotoPath(record.photo_path_after);\r\n        console.log(`解析后的照片路径:`, photoPaths);\r\n        \r\n        if (photoPaths && photoPaths.length > 0) {\r\n          const firstPath = photoPaths[0];\r\n          console.log(`选择第一张照片:`, firstPath);\r\n          \r\n          // 构建完整URL\r\n          const imageUrl = window.location.origin + firstPath;\r\n          console.log(`记录 ${rowIndex} 清理后照片完整URL:`, imageUrl);\r\n          \r\n          try {\r\n            console.log(`开始转换清理后照片...`);\r\n            afterPhotoData = await imageUrlToBase64(imageUrl);\r\n            console.log(`记录 ${rowIndex} 清理后照片已转换为Base64，长度:`, afterPhotoData ? afterPhotoData.length : 0);\r\n          } catch (error) {\r\n            console.error(`记录 ${rowIndex} 清理后照片转换失败:`, error);\r\n          }\r\n        } else {\r\n          console.log(`记录 ${rowIndex} 没有有效的清理后照片路径`);\r\n        }\r\n      } else {\r\n        console.log(`记录 ${rowIndex} 没有清理后照片`);\r\n      }\r\n      \r\n      // 保存处理后的数据\r\n      processedData.push({\r\n        ...row,\r\n        __beforePhotoData: beforePhotoData,\r\n        __afterPhotoData: afterPhotoData\r\n      });\r\n      console.log(`记录 ${rowIndex} 处理完成`);\r\n    }\r\n    \r\n    console.log('所有图片处理完成，开始创建Excel...');\r\n    console.log('处理后的数据条数:', processedData.length);\r\n    \r\n    // 创建一个临时表格元素\r\n    const table = document.createElement('table');\r\n    table.style.display = 'none';\r\n    document.body.appendChild(table);\r\n    console.log('创建临时表格元素');\r\n    \r\n    // 创建表头\r\n    const thead = document.createElement('thead');\r\n    const headerRow = document.createElement('tr');\r\n    \r\n    headers.forEach(header => {\r\n      const th = document.createElement('th');\r\n      th.textContent = header.text;\r\n      headerRow.appendChild(th);\r\n    });\r\n    \r\n    thead.appendChild(headerRow);\r\n    table.appendChild(thead);\r\n    console.log('表头创建完成');\r\n    \r\n    // 创建表体\r\n    const tbody = document.createElement('tbody');\r\n    \r\n    // 添加数据行\r\n    processedData.forEach((row, index) => {\r\n      console.log(`创建第 ${index + 1}/${processedData.length} 行...`);\r\n      const tr = document.createElement('tr');\r\n      \r\n      headers.forEach(header => {\r\n        const td = document.createElement('td');\r\n        \r\n        // 处理清理前照片列\r\n        if (header.field === '清理前照片') {\r\n          if (row.__beforePhotoData) {\r\n            console.log(`添加第 ${index + 1} 行清理前照片，Base64长度:`, row.__beforePhotoData.length);\r\n            // 使用Base64数据创建图片\r\n            const img = document.createElement('img');\r\n            img.src = row.__beforePhotoData;\r\n            img.style.width = '100px';\r\n            img.style.height = '100px';\r\n            td.appendChild(img);\r\n            console.log(`第 ${index + 1} 行清理前照片添加成功`);\r\n          } else {\r\n            td.textContent = '无图片';\r\n            console.log(`第 ${index + 1} 行没有清理前照片`);\r\n          }\r\n        }\r\n        // 处理清理后照片列 \r\n        else if (header.field === '清理后照片') {\r\n          if (row.__afterPhotoData) {\r\n            console.log(`添加第 ${index + 1} 行清理后照片，Base64长度:`, row.__afterPhotoData.length);\r\n            // 使用Base64数据创建图片\r\n            const img = document.createElement('img');\r\n            img.src = row.__afterPhotoData;\r\n            img.style.width = '100px';\r\n            img.style.height = '100px';\r\n            td.appendChild(img);\r\n            console.log(`第 ${index + 1} 行清理后照片添加成功`);\r\n          } else {\r\n            td.textContent = '无图片';\r\n            console.log(`第 ${index + 1} 行没有清理后照片`);\r\n          }\r\n        }\r\n        else {\r\n          // 普通文本列\r\n          td.textContent = row[header.field] || '';\r\n        }\r\n        \r\n        tr.appendChild(td);\r\n      });\r\n      \r\n      tbody.appendChild(tr);\r\n      console.log(`第 ${index + 1} 行创建完成`);\r\n    });\r\n    \r\n    table.appendChild(tbody);\r\n    console.log('表格创建完成');\r\n    \r\n    // 检查表格内容\r\n    console.log('表格行数:', table.rows.length);\r\n    console.log('表格列数:', table.rows[0] ? table.rows[0].cells.length : 0);\r\n    \r\n    // 使用js-table2excel导出\r\n    console.log('开始使用js-table2excel导出...');\r\n    const table2excel = new Table2Excel();\r\n    console.log('Table2Excel实例创建成功');\r\n    \r\n    try {\r\n      console.log('调用export方法...');\r\n      table2excel.export(table, fullFileName);\r\n      console.log('export方法调用成功');\r\n    } catch (exportError) {\r\n      console.error('export方法调用失败:', exportError);\r\n      throw exportError;\r\n    }\r\n    \r\n    // 导出完成后移除临时表格\r\n    document.body.removeChild(table);\r\n    console.log('临时表格已移除');\r\n    \r\n    return true;\r\n  } catch (error) {\r\n    console.error('使用js-table2excel导出Excel失败:', error);\r\n    console.error('错误详情:', error.message);\r\n    console.error('错误堆栈:', error.stack);\r\n    \r\n    // 如果js-table2excel导出失败，尝试使用CSV导出\r\n    try {\r\n      console.log('尝试使用CSV导出...');\r\n      \r\n      // 准备CSV内容\r\n      let csvContent = '';\r\n      \r\n      // 添加表头\r\n      csvContent += headers.map(header => `\"${header.text}\"`).join(',') + '\\n';\r\n      \r\n      // 添加数据行\r\n      data.forEach(row => {\r\n        const rowData = headers.map(header => {\r\n          const value = row[header.field] || '';\r\n          // 如果值包含逗号、双引号或换行符，需要用双引号包裹并转义内部的双引号\r\n          if (value.includes(',') || value.includes('\"') || value.includes('\\n')) {\r\n            return `\"${value.replace(/\"/g, '\"\"')}\"`;\r\n          }\r\n          return `\"${value}\"`;\r\n        });\r\n        csvContent += rowData.join(',') + '\\n';\r\n      });\r\n      \r\n      // 创建Blob对象\r\n      const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\r\n      \r\n      // 创建下载链接\r\n      const link = document.createElement('a');\r\n      const url = URL.createObjectURL(blob);\r\n      link.setAttribute('href', url);\r\n      link.setAttribute('download', `${fileName}_${new Date().toISOString().replace(/[-:.]/g, '').substring(0, 14)}.csv`);\r\n      link.style.visibility = 'hidden';\r\n      document.body.appendChild(link);\r\n      \r\n      // 触发下载\r\n      link.click();\r\n      \r\n      // 清理\r\n      document.body.removeChild(link);\r\n      URL.revokeObjectURL(url);\r\n      \r\n      return true;\r\n    } catch (csvError) {\r\n      console.error('CSV导出也失败:', csvError);\r\n      return false;\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * 将数据导出为Excel文件\r\n * @param {Array} data - 要导出的数据数组\r\n * @param {String} fileName - 导出的文件名（不含后缀）\r\n * @param {Array} headers - 要导出的列标题和对应字段名\r\n * @param {Object} imageData - 图片数据对象（可选）\r\n */\r\nexport const exportToExcel = (data, fileName, headers, imageData = null) => {\r\n  if (!data || data.length === 0) {\r\n    console.error('导出失败：没有数据');\r\n    return false;\r\n  }\r\n\r\n  // 处理文件名\r\n  fileName = fileName.replace(/[\\\\/:*?\"<>|]/g, '_');\r\n  const timestamp = new Date().toISOString().replace(/[-:.]/g, '').substring(0, 14);\r\n  \r\n  console.log('导出函数被调用，数据条数:', data.length);\r\n  console.log('是否有图片数据:', imageData ? '是' : '否');\r\n  if (imageData) {\r\n    console.log('图片数据条数:', Object.keys(imageData).length);\r\n  }\r\n  \r\n  // 强制使用XLSX导出Excel（不管是否有图片）\r\n  try {\r\n    console.log('尝试导出Excel...');\r\n    \r\n    // 创建工作簿\r\n    const wb = XLSX.utils.book_new();\r\n    console.log('工作簿创建成功');\r\n    \r\n    // 准备数据\r\n    let enhancedData = [];\r\n    \r\n    // 如果有图片数据，添加图片链接\r\n    if (imageData && Object.keys(imageData).length > 0) {\r\n      enhancedData = data.map((row, index) => {\r\n        const newRow = {...row};\r\n        \r\n        // 检查是否有图片数据\r\n        if (imageData[index]) {\r\n          // 添加图片链接\r\n          if (imageData[index][7] && imageData[index][7].url) {\r\n            newRow['清理前照片'] = imageData[index][7].url;\r\n          }\r\n          if (imageData[index][8] && imageData[index][8].url) {\r\n            newRow['清理后照片'] = imageData[index][8].url;\r\n          }\r\n        }\r\n        \r\n        return newRow;\r\n      });\r\n    } else {\r\n      enhancedData = data;\r\n    }\r\n    \r\n    console.log('数据准备完成，开始创建工作表');\r\n    \r\n    // 创建工作表\r\n    const ws = XLSX.utils.json_to_sheet(enhancedData);\r\n    \r\n    console.log('工作表创建成功');\r\n    \r\n    // 设置列宽\r\n    const colWidths = headers.map(() => ({ wch: 20 }));\r\n    ws['!cols'] = colWidths;\r\n    \r\n    // 添加工作表到工作簿\r\n    XLSX.utils.book_append_sheet(wb, ws, '危险废物记录');\r\n    console.log('工作表已添加到工作簿');\r\n    \r\n    // 导出Excel文件\r\n    const excelFileName = `${fileName}_${timestamp}.xlsx`;\r\n    console.log('准备导出Excel文件:', excelFileName);\r\n    \r\n    // 使用write方法导出\r\n    console.log('使用XLSX.write方法导出...');\r\n    const wbout = XLSX.write(wb, { bookType: 'xlsx', type: 'array' });\r\n    console.log('Excel数据生成成功，大小:', wbout.length, '字节');\r\n    \r\n    // 创建Blob对象\r\n    const blob = new Blob([wbout], { \r\n      type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' \r\n    });\r\n    console.log('Blob创建成功，大小:', blob.size, '字节');\r\n    \r\n    // 创建下载链接\r\n    const url = URL.createObjectURL(blob);\r\n    console.log('URL创建成功:', url.substring(0, 30) + '...');\r\n    \r\n    const link = document.createElement('a');\r\n    link.href = url;\r\n    link.download = excelFileName;\r\n    console.log('下载链接创建成功，准备触发点击');\r\n    \r\n    // 触发下载\r\n    document.body.appendChild(link);\r\n    link.click();\r\n    document.body.removeChild(link);\r\n    URL.revokeObjectURL(url);\r\n    \r\n    console.log('Excel导出成功');\r\n    return true;\r\n  } catch (error) {\r\n    console.error('导出Excel失败，错误详情:', error);\r\n    console.log('回退到CSV导出');\r\n    // 如果Excel导出失败，回退到CSV导出\r\n    exportToCSV(data, fileName, headers);\r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * 导出为CSV文件\r\n * @param {Array} data - 数据数组\r\n * @param {String} fileName - 文件名\r\n * @param {Array} headers - 表头配置\r\n */\r\nexport const exportToCSV = (data, fileName, headers) => {\r\n  // 处理文件名\r\n  const timestamp = new Date().toISOString().replace(/[-:.]/g, '').substring(0, 14);\r\n  const csvFileName = `${fileName}_${timestamp}.csv`;\r\n  \r\n  // 准备CSV内容\r\n  let csvContent = '\\uFEFF'; // 添加BOM以支持中文\r\n  \r\n  // 添加表头\r\n  const headerRow = headers.map(h => `\"${h.title}\"`).join(',');\r\n  csvContent += headerRow + '\\r\\n';\r\n  \r\n  // 添加数据行\r\n  data.forEach(item => {\r\n    const row = headers.map(header => {\r\n      const value = item[header.field];\r\n      \r\n      // 处理null和undefined\r\n      if (value === null || value === undefined) {\r\n        return '';\r\n      }\r\n      \r\n      // 处理数字\r\n      if (header.type === 'number' || typeof value === 'number') {\r\n        return value;\r\n      }\r\n      \r\n      // 处理字符串，特别是包含逗号、引号或换行符的字符串\r\n      let cellValue = String(value);\r\n      if (cellValue.includes(',') || cellValue.includes('\"') || cellValue.includes('\\n')) {\r\n        cellValue = cellValue.replace(/\"/g, '\"\"'); // 将引号替换为两个引号\r\n        cellValue = `\"${cellValue}\"`; // 用引号包裹整个值\r\n      }\r\n      \r\n      return cellValue;\r\n    }).join(',');\r\n    \r\n    csvContent += row + '\\r\\n';\r\n  });\r\n  \r\n  // 创建下载链接\r\n  const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });\r\n  const url = URL.createObjectURL(blob);\r\n  const link = document.createElement('a');\r\n  link.setAttribute('href', url);\r\n  link.setAttribute('download', csvFileName);\r\n  link.style.visibility = 'hidden';\r\n  document.body.appendChild(link);\r\n  link.click();\r\n  document.body.removeChild(link);\r\n  URL.revokeObjectURL(url);\r\n  \r\n  console.log('CSV导出成功');\r\n};\r\n\r\n/**\r\n * 准备图片数据用于导出\r\n * @param {Array} records - 记录数据\r\n * @param {String} baseUrl - 基础URL\r\n * @returns {Object} 图片数据对象\r\n */\r\nexport const prepareImageExportData = async (records, baseUrl) => {\r\n  const imageData = {};\r\n  \r\n  try {\r\n    console.log('准备图片数据，记录数:', records.length);\r\n    console.log('基础URL:', baseUrl);\r\n    \r\n    // 处理每条记录的图片\r\n    records.forEach((record, index) => {\r\n      imageData[index] = {\r\n        beforeImages: [],\r\n        afterImages: []\r\n      };\r\n      \r\n      // 处理清理前照片\r\n      if (record.photo_path_before) {\r\n        console.log(`记录 ${index} 清理前照片路径:`, record.photo_path_before);\r\n        \r\n        let beforePaths = [];\r\n        try {\r\n          // 尝试解析JSON\r\n          if (typeof record.photo_path_before === 'string' && record.photo_path_before.startsWith('[')) {\r\n            beforePaths = JSON.parse(record.photo_path_before);\r\n            console.log(`记录 ${index} 解析后的清理前照片路径:`, beforePaths);\r\n          } else {\r\n            beforePaths = [record.photo_path_before];\r\n          }\r\n        } catch (e) {\r\n          console.error('解析清理前照片路径失败:', e);\r\n          beforePaths = [record.photo_path_before];\r\n        }\r\n        \r\n        // 添加完整URL\r\n        imageData[index].beforeImages = beforePaths.map(path => {\r\n          // 确保路径是字符串\r\n          const pathStr = String(path);\r\n          // 如果路径已经是完整URL，则直接返回\r\n          if (pathStr.startsWith('http://') || pathStr.startsWith('https://')) {\r\n            return pathStr;\r\n          }\r\n          // 否则拼接基础URL\r\n          return `${baseUrl}${pathStr}`;\r\n        });\r\n        \r\n        console.log(`记录 ${index} 完整的清理前照片URL:`, imageData[index].beforeImages);\r\n      }\r\n      \r\n      // 处理清理后照片\r\n      if (record.photo_path_after) {\r\n        console.log(`记录 ${index} 清理后照片路径:`, record.photo_path_after);\r\n        \r\n        let afterPaths = [];\r\n        try {\r\n          // 尝试解析JSON\r\n          if (typeof record.photo_path_after === 'string' && record.photo_path_after.startsWith('[')) {\r\n            afterPaths = JSON.parse(record.photo_path_after);\r\n            console.log(`记录 ${index} 解析后的清理后照片路径:`, afterPaths);\r\n          } else {\r\n            afterPaths = [record.photo_path_after];\r\n          }\r\n        } catch (e) {\r\n          console.error('解析清理后照片路径失败:', e);\r\n          afterPaths = [record.photo_path_after];\r\n        }\r\n        \r\n        // 添加完整URL\r\n        imageData[index].afterImages = afterPaths.map(path => {\r\n          // 确保路径是字符串\r\n          const pathStr = String(path);\r\n          // 如果路径已经是完整URL，则直接返回\r\n          if (pathStr.startsWith('http://') || pathStr.startsWith('https://')) {\r\n            return pathStr;\r\n          }\r\n          // 否则拼接基础URL\r\n          return `${baseUrl}${pathStr}`;\r\n        });\r\n        \r\n        console.log(`记录 ${index} 完整的清理后照片URL:`, imageData[index].afterImages);\r\n      }\r\n    });\r\n    \r\n    console.log('图片数据准备完成，总记录数:', Object.keys(imageData).length);\r\n    return imageData;\r\n  } catch (error) {\r\n    console.error('准备图片数据失败:', error);\r\n    return {};\r\n  }\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}