{"ast":null,"code":"import { createRouter, createWebHistory } from 'vue-router';\nimport UnitSelection from '../views/UnitSelection.vue';\nimport WasteForm from '../views/WasteForm.vue';\nimport RecordsList from '../views/RecordsList.vue';\nimport Login from '../views/Login.vue';\nimport auth from '../store/auth';\nconst routes = [{\n  path: '/login',\n  name: 'Login',\n  component: Login,\n  meta: {\n    requiresAuth: false\n  }\n}, {\n  path: '/',\n  name: 'UnitSelection',\n  component: UnitSelection,\n  meta: {\n    requiresAuth: true,\n    requiresSuperAdmin: true\n  }\n}, {\n  path: '/unit/:id',\n  name: 'WasteForm',\n  component: WasteForm,\n  props: true,\n  meta: {\n    requiresAuth: true\n  }\n}, {\n  path: '/records/:unitId',\n  name: 'RecordsList',\n  component: RecordsList,\n  props: true,\n  meta: {\n    requiresAuth: true\n  }\n}];\nconst router = createRouter({\n  history: createWebHistory(process.env.BASE_URL),\n  routes\n});\n\n// 路由守卫\nrouter.beforeEach((to, from, next) => {\n  // 检查页面是否需要授权\n  const requiresAuth = to.matched.some(record => record.meta.requiresAuth);\n  const requiresSuperAdmin = to.matched.some(record => record.meta.requiresSuperAdmin);\n\n  // 如果路由需要登录但用户未登录，重定向到登录页面\n  if (requiresAuth && !auth.state.isLoggedIn) {\n    next({\n      name: 'Login'\n    });\n    return;\n  }\n\n  // 如果路由需要超级管理员权限但用户不是超级管理员\n  if (requiresSuperAdmin && auth.state.isLoggedIn && auth.state.user.role_id !== 3) {\n    // 如果用户已登录但不是超级管理员，重定向到其单位页面\n    next({\n      name: 'WasteForm',\n      params: {\n        id: auth.state.user.unit_id\n      }\n    });\n    return;\n  }\n\n  // 如果用户已登录且尝试访问登录页面，重定向到合适的页面\n  if (to.name === 'Login' && auth.state.isLoggedIn) {\n    if (auth.state.user.role_id === 3) {\n      next({\n        name: 'UnitSelection'\n      }); // 超级管理员到单位选择页面\n    } else {\n      next({\n        name: 'WasteForm',\n        params: {\n          id: auth.state.user.unit_id\n        }\n      }); // 其他用户到单位页面\n    }\n    return;\n  }\n\n  // 检查用户是否尝试访问不属于自己单位的页面\n  if (to.name === 'WasteForm' && auth.state.isLoggedIn && auth.state.user.role_id !== 3 &&\n  // 不是超级管理员\n  auth.state.user.unit_id !== parseInt(to.params.id)) {\n    // 如果用户尝试访问其他单位，重定向到自己的单位\n    next({\n      name: 'WasteForm',\n      params: {\n        id: auth.state.user.unit_id\n      }\n    });\n    return;\n  }\n\n  // 其他情况正常通过\n  next();\n});\nexport default router;","map":{"version":3,"names":["createRouter","createWebHistory","UnitSelection","WasteForm","RecordsList","Login","auth","routes","path","name","component","meta","requiresAuth","requiresSuperAdmin","props","router","history","process","env","BASE_URL","beforeEach","to","from","next","matched","some","record","state","isLoggedIn","user","role_id","params","id","unit_id","parseInt"],"sources":["C:/Users/10150/Desktop/hazardous-waste-management/frontend/src/router/index.js"],"sourcesContent":["import { createRouter, createWebHistory } from 'vue-router'\nimport UnitSelection from '../views/UnitSelection.vue'\nimport WasteForm from '../views/WasteForm.vue'\nimport RecordsList from '../views/RecordsList.vue'\nimport Login from '../views/Login.vue'\nimport auth from '../store/auth'\n\nconst routes = [\n  {\n    path: '/login',\n    name: 'Login',\n    component: Login,\n    meta: { requiresAuth: false }\n  },\n  {\n    path: '/',\n    name: 'UnitSelection',\n    component: UnitSelection,\n    meta: { requiresAuth: true, requiresSuperAdmin: true }\n  },\n  {\n    path: '/unit/:id',\n    name: 'WasteForm',\n    component: WasteForm,\n    props: true,\n    meta: { requiresAuth: true }\n  },\n  {\n    path: '/records/:unitId',\n    name: 'RecordsList',\n    component: RecordsList,\n    props: true,\n    meta: { requiresAuth: true }\n  }\n]\n\nconst router = createRouter({\n  history: createWebHistory(process.env.BASE_URL),\n  routes\n})\n\n// 路由守卫\nrouter.beforeEach((to, from, next) => {\n  // 检查页面是否需要授权\n  const requiresAuth = to.matched.some(record => record.meta.requiresAuth);\n  const requiresSuperAdmin = to.matched.some(record => record.meta.requiresSuperAdmin);\n  \n  // 如果路由需要登录但用户未登录，重定向到登录页面\n  if (requiresAuth && !auth.state.isLoggedIn) {\n    next({ name: 'Login' });\n    return;\n  }\n  \n  // 如果路由需要超级管理员权限但用户不是超级管理员\n  if (requiresSuperAdmin && auth.state.isLoggedIn && auth.state.user.role_id !== 3) {\n    // 如果用户已登录但不是超级管理员，重定向到其单位页面\n    next({ name: 'WasteForm', params: { id: auth.state.user.unit_id } });\n    return;\n  }\n  \n  // 如果用户已登录且尝试访问登录页面，重定向到合适的页面\n  if (to.name === 'Login' && auth.state.isLoggedIn) {\n    if (auth.state.user.role_id === 3) {\n      next({ name: 'UnitSelection' }); // 超级管理员到单位选择页面\n    } else {\n      next({ name: 'WasteForm', params: { id: auth.state.user.unit_id } }); // 其他用户到单位页面\n    }\n    return;\n  }\n  \n  // 检查用户是否尝试访问不属于自己单位的页面\n  if (to.name === 'WasteForm' && auth.state.isLoggedIn && \n      auth.state.user.role_id !== 3 && // 不是超级管理员\n      auth.state.user.unit_id !== parseInt(to.params.id)) {\n    // 如果用户尝试访问其他单位，重定向到自己的单位\n    next({ name: 'WasteForm', params: { id: auth.state.user.unit_id } });\n    return;\n  }\n  \n  // 其他情况正常通过\n  next();\n});\n\nexport default router\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}