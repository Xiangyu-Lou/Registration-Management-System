{"ast":null,"code":"import { createElementVNode as _createElementVNode, resolveComponent as _resolveComponent, withKeys as _withKeys, createVNode as _createVNode, withCtx as _withCtx, openBlock as _openBlock, createBlock as _createBlock, createCommentVNode as _createCommentVNode, createTextVNode as _createTextVNode, toDisplayString as _toDisplayString, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"login-container\"\n};\nconst _hoisted_2 = {\n  class: \"login-card\"\n};\nconst _hoisted_3 = {\n  key: 0,\n  class: \"login-error\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_el_input = _resolveComponent(\"el-input\");\n  const _component_el_form_item = _resolveComponent(\"el-form-item\");\n  const _component_el_radio = _resolveComponent(\"el-radio\");\n  const _component_el_radio_group = _resolveComponent(\"el-radio-group\");\n  const _component_el_button = _resolveComponent(\"el-button\");\n  const _component_el_form = _resolveComponent(\"el-form\");\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_cache[7] || (_cache[7] = _createElementVNode(\"div\", {\n    class: \"login-header\"\n  }, [_createElementVNode(\"h1\", null, \"危险废物管理系统\"), _createElementVNode(\"h2\", null, \"用户登录\")], -1 /* HOISTED */)), _createVNode(_component_el_form, {\n    ref: \"loginForm\",\n    model: $setup.form,\n    rules: $setup.rules,\n    \"label-width\": \"80px\",\n    class: \"login-form\"\n  }, {\n    default: _withCtx(() => [_createVNode(_component_el_form_item, {\n      label: \"手机号\",\n      prop: \"phone\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_input, {\n        modelValue: $setup.form.phone,\n        \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => $setup.form.phone = $event),\n        placeholder: \"请输入手机号\",\n        onKeyup: _withKeys($setup.submitForm, [\"enter\"])\n      }, null, 8 /* PROPS */, [\"modelValue\", \"onKeyup\"])]),\n      _: 1 /* STABLE */\n    }), $setup.showPassword ? (_openBlock(), _createBlock(_component_el_form_item, {\n      key: 0,\n      label: \"密码\",\n      prop: \"password\"\n    }, {\n      default: _withCtx(() => [_createVNode(_component_el_input, {\n        modelValue: $setup.form.password,\n        \"onUpdate:modelValue\": _cache[1] || (_cache[1] = $event => $setup.form.password = $event),\n        type: \"password\",\n        placeholder: \"请输入密码\",\n        \"show-password\": \"\",\n        onKeyup: _withKeys($setup.submitForm, [\"enter\"])\n      }, null, 8 /* PROPS */, [\"modelValue\", \"onKeyup\"])]),\n      _: 1 /* STABLE */\n    })) : _createCommentVNode(\"v-if\", true), _createVNode(_component_el_form_item, null, {\n      default: _withCtx(() => [_createVNode(_component_el_radio_group, {\n        modelValue: $setup.form.userType,\n        \"onUpdate:modelValue\": _cache[2] || (_cache[2] = $event => $setup.form.userType = $event),\n        onChange: $setup.handleUserTypeChange\n      }, {\n        default: _withCtx(() => [_createVNode(_component_el_radio, {\n          label: 1\n        }, {\n          default: _withCtx(() => _cache[3] || (_cache[3] = [_createTextVNode(\"员工\")])),\n          _: 1 /* STABLE */\n        }), _createVNode(_component_el_radio, {\n          label: 2\n        }, {\n          default: _withCtx(() => _cache[4] || (_cache[4] = [_createTextVNode(\"单位管理员\")])),\n          _: 1 /* STABLE */\n        }), _createVNode(_component_el_radio, {\n          label: 3\n        }, {\n          default: _withCtx(() => _cache[5] || (_cache[5] = [_createTextVNode(\"超级管理员\")])),\n          _: 1 /* STABLE */\n        })]),\n        _: 1 /* STABLE */\n      }, 8 /* PROPS */, [\"modelValue\", \"onChange\"])]),\n      _: 1 /* STABLE */\n    }), _createVNode(_component_el_form_item, null, {\n      default: _withCtx(() => [_createVNode(_component_el_button, {\n        type: \"primary\",\n        onClick: $setup.submitForm,\n        loading: $setup.auth.state.loading,\n        style: {\n          \"width\": \"100%\"\n        }\n      }, {\n        default: _withCtx(() => _cache[6] || (_cache[6] = [_createTextVNode(\" 登录 \")])),\n        _: 1 /* STABLE */\n      }, 8 /* PROPS */, [\"onClick\", \"loading\"])]),\n      _: 1 /* STABLE */\n    })]),\n    _: 1 /* STABLE */\n  }, 8 /* PROPS */, [\"model\", \"rules\"]), $setup.auth.state.error ? (_openBlock(), _createElementBlock(\"div\", _hoisted_3, _toDisplayString($setup.auth.state.error), 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true)])]);\n}","map":{"version":3,"names":["class","key","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_createVNode","_component_el_form","ref","model","$setup","form","rules","default","_withCtx","_component_el_form_item","label","prop","_component_el_input","modelValue","phone","_cache","$event","placeholder","onKeyup","_withKeys","submitForm","_","showPassword","_createBlock","password","type","_createCommentVNode","_component_el_radio_group","userType","onChange","handleUserTypeChange","_component_el_radio","_createTextVNode","_component_el_button","onClick","loading","auth","state","style","error","_hoisted_3","_toDisplayString"],"sources":["C:\\Users\\10150\\Desktop\\hazardous-waste-management\\frontend\\src\\views\\Login.vue"],"sourcesContent":["<template>\n  <div class=\"login-container\">\n    <div class=\"login-card\">\n      <div class=\"login-header\">\n        <h1>危险废物管理系统</h1>\n        <h2>用户登录</h2>\n      </div>\n      \n      <el-form \n        ref=\"loginForm\" \n        :model=\"form\" \n        :rules=\"rules\" \n        label-width=\"80px\"\n        class=\"login-form\"\n      >\n        <el-form-item label=\"手机号\" prop=\"phone\">\n          <el-input \n            v-model=\"form.phone\" \n            placeholder=\"请输入手机号\" \n            @keyup.enter=\"submitForm\"\n          />\n        </el-form-item>\n        \n        <el-form-item v-if=\"showPassword\" label=\"密码\" prop=\"password\">\n          <el-input \n            v-model=\"form.password\" \n            type=\"password\" \n            placeholder=\"请输入密码\" \n            show-password\n            @keyup.enter=\"submitForm\"\n          />\n        </el-form-item>\n        \n        <el-form-item>\n          <el-radio-group v-model=\"form.userType\" @change=\"handleUserTypeChange\">\n            <el-radio :label=\"1\">员工</el-radio>\n            <el-radio :label=\"2\">单位管理员</el-radio>\n            <el-radio :label=\"3\">超级管理员</el-radio>\n          </el-radio-group>\n        </el-form-item>\n        \n        <el-form-item>\n          <el-button \n            type=\"primary\" \n            @click=\"submitForm\" \n            :loading=\"auth.state.loading\"\n            style=\"width: 100%\"\n          >\n            登录\n          </el-button>\n        </el-form-item>\n      </el-form>\n      \n      <div v-if=\"auth.state.error\" class=\"login-error\">\n        {{ auth.state.error }}\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { reactive, ref, computed, onMounted } from 'vue';\nimport { useRouter } from 'vue-router';\nimport { ElMessage } from 'element-plus';\nimport auth from '../store/auth';\n\n/* eslint-disable vue/multi-word-component-names */\nexport default {\n  name: 'LoginView',\n  setup() {\n    const router = useRouter();\n    const loginForm = ref(null);\n    \n    const form = reactive({\n      phone: '',\n      password: '',\n      userType: 1 // 默认为员工\n    });\n    \n    const rules = {\n      phone: [\n        { required: true, message: '请输入手机号', trigger: 'blur' },\n        { pattern: /^1[3-9]\\d{9}$/, message: '请输入正确的手机号格式', trigger: 'blur' }\n      ],\n      password: [\n        { required: true, message: '请输入密码', trigger: 'blur' }\n      ]\n    };\n    \n    // 员工登录不需要密码，管理员需要\n    const showPassword = computed(() => form.userType !== 1);\n    \n    // 切换用户类型时重置表单\n    const handleUserTypeChange = () => {\n      if (form.userType === 1) {\n        form.password = '';\n      }\n      if (loginForm.value) {\n        loginForm.value.clearValidate();\n      }\n    };\n    \n    // 提交表单\n    const submitForm = () => {\n      if (!showPassword.value) {\n        // 员工登录不需要验证密码\n        loginForm.value.validateField('phone', async (error) => {\n          if (!error) {\n            await doLogin();\n          }\n        });\n      } else {\n        // 管理员需要验证所有字段\n        loginForm.value.validate(async (valid) => {\n          if (valid) {\n            await doLogin();\n          }\n        });\n      }\n    };\n    \n    // 执行登录\n    const doLogin = async () => {\n      try {\n        const result = await auth.login(form.phone, form.password);\n        \n        if (result.success) {\n          const user = result.user;\n          \n          ElMessage.success(`欢迎，${user.username || user.phone}`);\n          \n          // 根据用户角色跳转到不同页面\n          if (user.role_id === 3) {\n            // 超级管理员\n            router.push('/');\n          } else {\n            // 其他用户直接进入对应单位的填报页面\n            router.push(`/unit/${user.unit_id}`);\n          }\n        }\n      } catch (error) {\n        console.error('Login error:', error);\n      }\n    };\n    \n    // 如果已登录，自动跳转\n    onMounted(() => {\n      if (auth.state.isLoggedIn) {\n        const user = auth.state.user;\n        if (user.role_id === 3) {\n          router.push('/');\n        } else {\n          router.push(`/unit/${user.unit_id}`);\n        }\n      }\n    });\n    \n    return {\n      form,\n      rules,\n      loginForm,\n      showPassword,\n      handleUserTypeChange,\n      submitForm,\n      auth\n    };\n  }\n};\n</script>\n\n<style scoped>\n.login-container {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  min-height: 100vh;\n  background-color: #f0f2f5;\n}\n\n.login-card {\n  width: 400px;\n  padding: 30px;\n  background-color: #fff;\n  border-radius: 8px;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n}\n\n.login-header {\n  text-align: center;\n  margin-bottom: 30px;\n}\n\n.login-header h1 {\n  font-size: 24px;\n  color: #409EFF;\n  margin-bottom: 10px;\n}\n\n.login-header h2 {\n  font-size: 18px;\n  color: #555;\n  font-weight: normal;\n}\n\n.login-form {\n  margin-top: 20px;\n}\n\n.login-error {\n  color: #f56c6c;\n  text-align: center;\n  margin-top: 15px;\n  font-size: 14px;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}