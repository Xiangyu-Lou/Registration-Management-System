{"ast":null,"code":"import { reactive } from 'vue';\nimport httpService from '../config/httpService';\nimport apiConfig from '../config/api';\n\n// 初始化状态\nconst defaultState = {\n  user: null,\n  isLoggedIn: false,\n  loading: false,\n  error: null\n};\n\n// 创建响应式状态\nconst state = reactive({\n  ...defaultState\n});\n\n// 从localStorage获取已保存的用户信息\nconst init = () => {\n  const savedUser = localStorage.getItem('user');\n  if (savedUser) {\n    try {\n      const user = JSON.parse(savedUser);\n      state.user = user;\n      state.isLoggedIn = true;\n    } catch (e) {\n      console.error('Error parsing saved user data:', e);\n      localStorage.removeItem('user');\n    }\n  }\n};\n\n// 登录方法\nconst login = async (phone, password) => {\n  // 设置加载状态\n  state.loading = true;\n  state.error = null;\n  console.log('auth.login 开始执行，手机号:', phone);\n  try {\n    // 员工登录不发送密码字段，管理员必须发送密码\n    const postData = {\n      phone\n    };\n\n    // 只有在密码存在且非空时才添加到请求中\n    if (password !== null && password !== undefined && password !== '') {\n      postData.password = password;\n      console.log('auth.login 发送密码参数');\n    } else {\n      console.log('auth.login 不发送密码参数');\n    }\n    console.log('发送登录请求，数据:', postData);\n    const response = await httpService.post(apiConfig.endpoints.login, postData);\n    console.log('登录请求成功响应:', response.data);\n    const user = response.data;\n    state.user = user;\n    state.isLoggedIn = true;\n\n    // 保存到localStorage以便刷新后保持登录状态\n    localStorage.setItem('user', JSON.stringify(user));\n    return {\n      success: true,\n      user\n    };\n  } catch (error) {\n    state.error = error.response?.data?.error || '登录失败，请检查网络连接';\n    console.error('Login error:', error);\n    return {\n      success: false,\n      error: state.error\n    };\n  } finally {\n    state.loading = false;\n  }\n};\n\n// 注销方法\nconst logout = () => {\n  state.user = null;\n  state.isLoggedIn = false;\n  localStorage.removeItem('user');\n};\n\n// 初始化\ninit();\nexport default {\n  state,\n  login,\n  logout\n};","map":{"version":3,"names":["reactive","httpService","apiConfig","defaultState","user","isLoggedIn","loading","error","state","init","savedUser","localStorage","getItem","JSON","parse","e","console","removeItem","login","phone","password","log","postData","undefined","response","post","endpoints","data","setItem","stringify","success","logout"],"sources":["C:/Users/10150/Desktop/Hazardous-waste-management-system/frontend/src/store/auth.js"],"sourcesContent":["import { reactive } from 'vue';\nimport httpService from '../config/httpService';\nimport apiConfig from '../config/api';\n\n// 初始化状态\nconst defaultState = {\n  user: null,\n  isLoggedIn: false,\n  loading: false,\n  error: null\n};\n\n// 创建响应式状态\nconst state = reactive({\n  ...defaultState\n});\n\n// 从localStorage获取已保存的用户信息\nconst init = () => {\n  const savedUser = localStorage.getItem('user');\n  if (savedUser) {\n    try {\n      const user = JSON.parse(savedUser);\n      state.user = user;\n      state.isLoggedIn = true;\n    } catch (e) {\n      console.error('Error parsing saved user data:', e);\n      localStorage.removeItem('user');\n    }\n  }\n};\n\n// 登录方法\nconst login = async (phone, password) => {\n  // 设置加载状态\n  state.loading = true;\n  state.error = null;\n  \n  console.log('auth.login 开始执行，手机号:', phone);\n\n  try {\n    // 员工登录不发送密码字段，管理员必须发送密码\n    const postData = { phone };\n    \n    // 只有在密码存在且非空时才添加到请求中\n    if (password !== null && password !== undefined && password !== '') {\n      postData.password = password;\n      console.log('auth.login 发送密码参数');\n    } else {\n      console.log('auth.login 不发送密码参数');\n    }\n    \n    console.log('发送登录请求，数据:', postData);\n    const response = await httpService.post(apiConfig.endpoints.login, postData);\n    console.log('登录请求成功响应:', response.data);\n\n    const user = response.data;\n    state.user = user;\n    state.isLoggedIn = true;\n    \n    // 保存到localStorage以便刷新后保持登录状态\n    localStorage.setItem('user', JSON.stringify(user));\n    \n    return { success: true, user };\n  } catch (error) {\n    state.error = error.response?.data?.error || '登录失败，请检查网络连接';\n    console.error('Login error:', error);\n    return { success: false, error: state.error };\n  } finally {\n    state.loading = false;\n  }\n};\n\n// 注销方法\nconst logout = () => {\n  state.user = null;\n  state.isLoggedIn = false;\n  localStorage.removeItem('user');\n};\n\n// 初始化\ninit();\n\nexport default {\n  state,\n  login,\n  logout\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}