(function(){"use strict";var e={6839:function(e,t,o){var a=o(5130),l=o(6768);const r={id:"app"};function n(e,t,o,a,n,s){const i=(0,l.g2)("app-header"),u=(0,l.g2)("router-view");return(0,l.uX)(),(0,l.CE)("div",r,[a.showHeader?((0,l.uX)(),(0,l.Wv)(i,{key:0})):(0,l.Q3)("",!0),(0,l.bF)(u)])}var s=o(1387),i=o(4232);const u={class:"app-header"},d={key:0,class:"user-info"},c={class:"welcome-text"},p={key:0,class:"unit-tag"};function m(e,t,o,a,r,n){const s=(0,l.g2)("user"),m=(0,l.g2)("el-icon"),g=(0,l.g2)("el-button");return(0,l.uX)(),(0,l.CE)("div",u,[t[3]||(t[3]=(0,l.Lk)("div",{class:"logo"},[(0,l.Lk)("h1",null,"固体废物管理系统")],-1)),a.auth.state.isLoggedIn?((0,l.uX)(),(0,l.CE)("div",d,[(0,l.Lk)("span",c,[t[0]||(t[0]=(0,l.eW)(" 欢迎, ")),(0,l.Lk)("strong",null,(0,i.v_)(a.userName),1),a.auth.state.user.unit_name?((0,l.uX)(),(0,l.CE)("span",p,(0,i.v_)(a.auth.state.user.unit_name),1)):(0,l.Q3)("",!0)]),(0,l.bF)(g,{type:"text",class:"profile-button",onClick:a.goToProfile},{default:(0,l.k6)((()=>[(0,l.bF)(m,null,{default:(0,l.k6)((()=>[(0,l.bF)(s)])),_:1}),t[1]||(t[1]=(0,l.eW)(" 账号设置 "))])),_:1},8,["onClick"]),(0,l.bF)(g,{type:"text",class:"logout-button",onClick:a.handleLogout},{default:(0,l.k6)((()=>t[2]||(t[2]=[(0,l.eW)(" 退出登录 ")]))),_:1},8,["onClick"])])):(0,l.Q3)("",!0)])}var g=o(1219),f=o(144),h=o(4373);const v="";var w={baseURL:v,endpoints:{login:"/api/login",users:"/api/users",userStatus:"/api/users/:id/status",userProfile:"/api/users/:id/profile",units:"/api/units",wasteTypes:"/api/waste-types",wasteRecords:"/api/waste-records",wasteRecordsByUnit:"/api/waste-records",wasteRecordDetail:"/api/waste-records/detail",wasteRecordsByUser:"/api/waste-records/user",exportWasteRecords:"/api/waste-records/export/user"},getUrl(e){return`${this.baseURL}${e}`}};const k={class:"unit-selection-container"},b={class:"content"},y={class:"units-grid"},_={class:"unit-name"};function F(e,t,o,a,r,n){const s=(0,l.g2)("el-card");return(0,l.uX)(),(0,l.CE)("div",k,[t[1]||(t[1]=(0,l.Lk)("div",{class:"header"},[(0,l.Lk)("h1",null,"固体废物管理系统")],-1)),(0,l.Lk)("div",b,[t[0]||(t[0]=(0,l.Lk)("h2",null,"请选择您的单位",-1)),(0,l.Lk)("div",y,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.units,(e=>((0,l.uX)(),(0,l.Wv)(s,{key:e.id,class:"unit-card",shadow:"hover",onClick:t=>n.selectUnit(e)},{default:(0,l.k6)((()=>[(0,l.Lk)("div",_,(0,i.v_)(e.name),1)])),_:2},1032,["onClick"])))),128))])]),t[2]||(t[2]=(0,l.Lk)("div",{class:"footer"},[(0,l.Lk)("p",null,"© 2025 固体废物管理系统")],-1))])}var x={name:"UnitSelection",data(){return{units:[],loading:!1}},created(){this.fetchUnits()},methods:{async fetchUnits(){this.loading=!0;try{console.log("正在获取单位列表...");const e=await h.A.get(w.getUrl(w.endpoints.units));console.log("获取单位列表成功:",e.data),this.units=e.data}catch(e){console.error("获取单位列表失败:",e),g.nk.error("获取单位列表失败")}finally{this.loading=!1}},selectUnit(e){this.$router.push({name:"WasteForm",params:{id:e.id}})}}},I=o(1241);const L=(0,I.A)(x,[["render",F],["__scopeId","data-v-249742c5"]]);var R=L;const C={class:"waste-form-container"},W={class:"header"},V={key:1},$={class:"content"},T={class:"unit-info"},U={class:"form-row"},P={key:0,class:"upload-warning"},S={class:"form-actions"},E={class:"upload-progress"},K={class:"upload-status"};function A(e,t,o,a,r,n){const s=(0,l.g2)("arrow-left"),u=(0,l.g2)("el-icon"),d=(0,l.g2)("document"),c=(0,l.g2)("el-option"),p=(0,l.g2)("el-select"),m=(0,l.g2)("el-form-item"),g=(0,l.g2)("el-input"),f=(0,l.g2)("el-date-picker"),h=(0,l.g2)("clock"),v=(0,l.g2)("el-time-picker"),w=(0,l.g2)("el-input-number"),k=(0,l.g2)("el-alert"),b=(0,l.g2)("plus"),y=(0,l.g2)("el-upload"),_=(0,l.g2)("el-button"),F=(0,l.g2)("el-form"),x=(0,l.g2)("el-progress"),I=(0,l.g2)("el-dialog");return(0,l.uX)(),(0,l.CE)("div",C,[(0,l.Lk)("div",W,[a.isAdmin?((0,l.uX)(),(0,l.CE)("div",{key:0,class:"back-button",onClick:t[0]||(t[0]=(...e)=>a.goBack&&a.goBack(...e))},[(0,l.bF)(u,null,{default:(0,l.k6)((()=>[(0,l.bF)(s)])),_:1}),t[13]||(t[13]=(0,l.eW)(" 返回 "))])):((0,l.uX)(),(0,l.CE)("div",V)),t[15]||(t[15]=(0,l.Lk)("h1",null,"固体废物填报",-1)),(0,l.Lk)("div",{class:"view-records",onClick:t[1]||(t[1]=(...e)=>a.viewRecords&&a.viewRecords(...e))},[t[14]||(t[14]=(0,l.eW)(" 查看记录 ")),(0,l.bF)(u,null,{default:(0,l.k6)((()=>[(0,l.bF)(d)])),_:1})])]),(0,l.Lk)("div",$,[(0,l.Lk)("div",T,[(0,l.Lk)("h2",null,(0,i.v_)(a.unitName),1)]),(0,l.bF)(F,{ref:"wasteForm",model:a.form,rules:a.rules,"label-position":"top",class:"waste-form"},{default:(0,l.k6)((()=>[(0,l.bF)(m,{label:"废物类型",prop:"wasteTypeId"},{default:(0,l.k6)((()=>[(0,l.bF)(p,{modelValue:a.form.wasteTypeId,"onUpdate:modelValue":t[2]||(t[2]=e=>a.form.wasteTypeId=e),placeholder:"请选择废物类型",style:{width:"100%"}},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(a.wasteTypes,(e=>((0,l.uX)(),(0,l.Wv)(c,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,l.bF)(m,{label:"产生工序",prop:"process"},{default:(0,l.k6)((()=>[(0,l.bF)(p,{modelValue:a.form.process,"onUpdate:modelValue":t[3]||(t[3]=e=>a.form.process=e),placeholder:"请选择产生工序",style:{width:"100%"}},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(a.processOptions,(e=>((0,l.uX)(),(0,l.Wv)(c,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),"其他"===a.form.process?((0,l.uX)(),(0,l.Wv)(g,{key:0,modelValue:a.customProcess,"onUpdate:modelValue":t[4]||(t[4]=e=>a.customProcess=e),placeholder:"请输入具体产生工序",style:{"margin-top":"10px",height:"40px"}},null,8,["modelValue"])):(0,l.Q3)("",!0)])),_:1}),(0,l.bF)(m,{label:"产生地点",prop:"location"},{default:(0,l.k6)((()=>[(0,l.bF)(p,{modelValue:a.form.location,"onUpdate:modelValue":t[5]||(t[5]=e=>a.form.location=e),placeholder:"请选择废物产生地点",style:{width:"100%"}},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(a.locationOptions,(e=>((0,l.uX)(),(0,l.Wv)(c,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),"其他"===a.form.location?((0,l.uX)(),(0,l.Wv)(g,{key:0,modelValue:a.customLocation,"onUpdate:modelValue":t[6]||(t[6]=e=>a.customLocation=e),placeholder:"请输入具体产生地点",style:{"margin-top":"10px",height:"40px"}},null,8,["modelValue"])):(0,l.Q3)("",!0)])),_:1}),(0,l.bF)(m,{label:"备注",prop:"remarks"},{default:(0,l.k6)((()=>[(0,l.bF)(g,{modelValue:a.form.remarks,"onUpdate:modelValue":t[7]||(t[7]=e=>a.form.remarks=e),type:"textarea",rows:1,placeholder:"请输入备注信息（选填）"},null,8,["modelValue"])])),_:1}),(0,l.Lk)("div",U,[(0,l.bF)(m,{label:"收集日期",class:"date-item"},{default:(0,l.k6)((()=>[(0,l.bF)(f,{modelValue:a.form.collectionDate,"onUpdate:modelValue":t[8]||(t[8]=e=>a.form.collectionDate=e),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},editable:!1,"popper-class":"date-picker-popup",teleported:!1},null,8,["modelValue"])])),_:1}),(0,l.bF)(m,{label:"收集时间",class:"time-item"},{default:(0,l.k6)((()=>[(0,l.bF)(v,{modelValue:a.form.collectionTime,"onUpdate:modelValue":t[9]||(t[9]=e=>a.form.collectionTime=e),format:"HH:mm",placeholder:"选择时间","value-format":"HH:mm",style:{width:"100%"},editable:!1,"popper-class":"time-picker-popup",teleported:!1},{prefix:(0,l.k6)((()=>[(0,l.bF)(u,null,{default:(0,l.k6)((()=>[(0,l.bF)(h)])),_:1})])),_:1},8,["modelValue"])])),_:1})]),(0,l.bF)(m,{label:"收集数量(吨)",prop:"quantity"},{default:(0,l.k6)((()=>[(0,l.bF)(w,{modelValue:a.form.quantity,"onUpdate:modelValue":t[10]||(t[10]=e=>a.form.quantity=e),min:0,precision:3,step:.001,style:{width:"100%"},onFocus:t[11]||(t[11]=e=>a.selectAllText(e)),"input-props":{inputmode:"decimal",pattern:"[0-9]*[.,]?[0-9]*"},controls:!1},null,8,["modelValue"])])),_:1}),(0,l.bF)(m,{label:"现场照片（收集前）",prop:"photo_before"},{default:(0,l.k6)((()=>[t[16]||(t[16]=(0,l.Lk)("div",{class:"photo-tip"},"请上传废物收集前的现场照片（最多5张）",-1)),a.showLargeFileWarning?((0,l.uX)(),(0,l.CE)("div",P,[(0,l.bF)(k,{title:"上传大文件可能会导致处理时间较长，请耐心等待",type:"warning",closable:!1,"show-icon":""})])):(0,l.Q3)("",!0),(0,l.bF)(y,{class:"waste-photo-uploader",action:"#","auto-upload":!1,"on-change":a.handlePhotoBeforeChange,"on-remove":a.handlePhotoBeforeRemove,"file-list":a.fileListBefore,limit:5,multiple:"","list-type":"picture-card","before-upload":a.handleBeforeUpload,accept:"image/jpeg,image/jpg,image/png,image/gif,image/bmp,image/webp,.jpeg,.jpg,.png,.gif,.bmp,.webp"},{default:(0,l.k6)((()=>[(0,l.bF)(u,null,{default:(0,l.k6)((()=>[(0,l.bF)(b)])),_:1})])),_:1},8,["on-change","on-remove","file-list","before-upload"])])),_:1}),(0,l.bF)(m,{label:"现场照片（收集后）",prop:"photo_after"},{default:(0,l.k6)((()=>[t[17]||(t[17]=(0,l.Lk)("div",{class:"photo-tip"},"请上传废物收集后的现场照片（最多5张）",-1)),(0,l.bF)(y,{class:"waste-photo-uploader",action:"#","auto-upload":!1,"on-change":a.handlePhotoAfterChange,"on-remove":a.handlePhotoAfterRemove,"file-list":a.fileListAfter,limit:5,multiple:"","list-type":"picture-card","before-upload":a.handleBeforeUpload,accept:"image/jpeg,image/jpg,image/png,image/gif,image/bmp,image/webp,.jpeg,.jpg,.png,.gif,.bmp,.webp"},{default:(0,l.k6)((()=>[(0,l.bF)(u,null,{default:(0,l.k6)((()=>[(0,l.bF)(b)])),_:1})])),_:1},8,["on-change","on-remove","file-list","before-upload"])])),_:1}),(0,l.Lk)("div",S,[(0,l.bF)(_,{type:"primary",class:"submit-btn",onClick:a.submitForm,loading:a.loading},{default:(0,l.k6)((()=>t[18]||(t[18]=[(0,l.eW)("提交")]))),_:1},8,["onClick","loading"]),(0,l.bF)(_,{class:"reset-btn",onClick:a.resetForm},{default:(0,l.k6)((()=>t[19]||(t[19]=[(0,l.eW)("重置")]))),_:1},8,["onClick"])])])),_:1},8,["model","rules"])]),(0,l.bF)(I,{modelValue:a.showUploadProgress,"onUpdate:modelValue":t[12]||(t[12]=e=>a.showUploadProgress=e),title:"正在上传文件",width:"30%","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},{default:(0,l.k6)((()=>[(0,l.Lk)("div",E,[t[20]||(t[20]=(0,l.Lk)("p",null,"正在上传文件，请勿关闭页面...",-1)),(0,l.bF)(x,{percentage:a.uploadPercentage,format:a.percentageFormat,status:100===a.uploadPercentage?"success":""},null,8,["percentage","format","status"]),(0,l.Lk)("p",K,(0,i.v_)(a.uploadStatus),1)])])),_:1},8,["modelValue"]),t[21]||(t[21]=(0,l.Lk)("div",{class:"footer"},[(0,l.Lk)("p",null,"© 2025 固体废物管理系统")],-1))])}var Q=o(7477),X=o(9372),q=o.n(X),B={name:"WasteForm",components:{ArrowLeft:Q.nkM,Document:Q.yoT,Plus:Q.FWt,Clock:Q.zD7},props:{id:{type:[String,Number],required:!0}},setup(e){const t=(0,s.rd)(),o=(0,f.KR)(null),a=(0,f.KR)(!1),r=(0,f.KR)(""),n=(0,f.KR)([]),i=(0,f.KR)([]),u=(0,f.KR)([]),d=(0,f.KR)([]),c=(0,f.KR)([]),p=(0,f.KR)(!1),m=(0,f.KR)(0),h=(0,f.KR)("准备上传..."),v=(0,f.KR)(!1),k=(0,f.KR)([]),b=(0,f.KR)(""),y=(0,f.KR)(""),_=["作业现场","清罐清理","报废清理","管线刺漏","历史遗留","日常维护","封井退出","其他"],F={"桓台":["金家接转站","金17-1注采站","金17-2注采站","金6金9项目组","金8注采站","其他"],"潍北":["潍北联合站","昌79注采站","昌3注采站","疃3注采站","昌15注采站","其他"],"高青":["高青联合站","樊107注采站","樊14注采站","高21注采站","高54注采站","其他"],"牛庄":["牛25集输站","牛25注采站","营13注采站","史112注采站","其他"],"金角":["长堤注采站","桩23注采站","其他"],"信远":["河125注采站","河122注采站","永551注采站","其他"],"滨博":["樊142注采站","樊142-2-12注采站","樊162注采站","樊页1井组","滨博接转站","其他"],"无棣":["车41注采站","车142注采站","车40注采站","车408注采站","车274注采站","车1接转站","东风港联合站","其他"],"河口":["沾14东注采站","沾14西注采站","渤南注采站","大北注采站","沾5注采站","太平接转站","沾5接转站","其他"],"胜兴":["博兴注采站","其他"],"其他":["其他"]},x=(0,l.EW)((()=>fo.state.isLoggedIn&&(3===fo.state.user.role_id||4===fo.state.user.role_id))),I=(0,f.Kh)({wasteTypeId:"",location:"",collectionDate:(new Date).toISOString().slice(0,10),collectionTime:(new Date).toTimeString().slice(0,5),quantity:void 0,photo_before:[],photo_after:[],remarks:"",process:""}),L={wasteTypeId:[{required:!0,message:"请选择废物类型",trigger:"change"}],process:[{required:!0,message:"请选择产生工序",trigger:"change"},{validator:(e,t,o)=>{"其他"!==t||y.value.trim()?o():o(new Error("请输入具体产生工序"))},trigger:"blur"}],location:[{required:!0,message:"请选择废物产生地点",trigger:"change"},{validator:(e,t,o)=>{"其他"!==t||b.value.trim()?o():o(new Error("请输入具体产生地点"))},trigger:"blur"}],collectionDate:[{required:!1}],collectionTime:[{required:!1}],quantity:[{required:!1,message:"请输入收集数量",trigger:"change"}]};(0,l.sV)((async()=>{const e=document.createElement("meta");e.setAttribute("name","viewport"),e.setAttribute("content","width=device-width,initial-scale=1.0,user-scalable=no,maximum-scale=1"),document.head.appendChild(e);const t=document.querySelector('meta[name="viewport"]');t&&t!==e&&t.remove(),await R(),await C()})),(0,l.xo)((()=>{const e=document.querySelector('meta[name="viewport"]');e&&e.remove();const t=document.createElement("meta");t.setAttribute("name","viewport"),t.setAttribute("content","width=device-width,initial-scale=1.0"),document.head.appendChild(t)}));const R=async()=>{try{const t=await oo.get(w.endpoints.units),o=t.data.find((t=>t.id===parseInt(e.id)));o&&(r.value=o.name,F[r.value]?k.value=F[r.value]:(k.value=[],console.warn(`未找到管理区 "${r.value}" 的地点选项`)))}catch(t){console.error("Error fetching unit name:",t),g.nk.error("获取单位信息失败")}},C=async()=>{try{const e=await oo.get(w.endpoints.wasteTypes);n.value=e.data}catch(e){console.error("Error fetching waste types:",e),g.nk.error("获取废物类型失败")}},W=e=>{const t=["image/jpeg","image/jpg","image/png","image/gif","image/bmp","image/webp"],o=t.includes(e.type);if(!o)return g.nk.error("只能上传图片文件!"),!1;const a=52428800;return e.size>a?(g.nk.error("图片大小不能超过50MB!"),!1):new Promise((t=>{p.value=!0,h.value="正在处理图片...",m.value=0,console.log("开始处理图片:",e.name,"类型:",e.type,"大小:",(e.size/1024).toFixed(2),"KB"),new(q())(e,{quality:.6,maxWidth:1920,maxHeight:1920,mimeType:"image/jpeg",convertSize:0,beforeDraw(){m.value=30,h.value="正在处理图片...",console.log("图片处理中...")},drew(){m.value=60,h.value="正在压缩图片...",console.log("图片绘制完成")},success(o){const a=e.name.replace(/\.[^/.]+$/,"")+".jpg",l=new File([o],a,{type:"image/jpeg",lastModified:(new Date).getTime()});console.log("图片处理完成:"),console.log("- 原始大小:",(e.size/1024).toFixed(2),"KB"),console.log("- 处理后大小:",(l.size/1024).toFixed(2),"KB"),console.log("- 压缩率:",Math.round(100*(1-l.size/e.size)),"%"),console.log("- 处理后文件类型:",l.type),console.log("- 处理后文件名:",l.name),h.value="图片处理完成",m.value=100,setTimeout((()=>{p.value=!1}),500),t(l)},error(o){console.error("图片压缩失败:",o),h.value="处理失败，使用原始图片",m.value=100,setTimeout((()=>{p.value=!1}),500),t(e)}})}))},V=async(e,t)=>{if(console.log("收集前照片变更:",e),console.log("当前文件列表:",t),d.value=[...t],e.processed)return void console.log("文件已处理过，跳过压缩:",e.name);if(e.raw&&"ready"===e.status){p.value=!0,h.value="正在处理图片...",m.value=0,console.log("开始处理收集前照片:",e.name,"类型:",e.raw.type,"大小:",(e.raw.size/1024).toFixed(2),"KB");try{const t=await new Promise((t=>{new(q())(e.raw,{quality:.6,maxWidth:1920,maxHeight:1920,mimeType:"image/jpeg",convertSize:0,beforeDraw(){m.value=30,h.value="正在处理图片...",console.log("图片处理中...")},drew(){m.value=60,h.value="正在压缩图片...",console.log("图片绘制完成")},success(o){const a=e.raw.name.replace(/\.[^/.]+$/,"")+".jpg",l=new File([o],a,{type:"image/jpeg",lastModified:(new Date).getTime()});console.log("图片处理完成:"),console.log("- 原始大小:",(e.raw.size/1024).toFixed(2),"KB"),console.log("- 处理后大小:",(l.size/1024).toFixed(2),"KB"),console.log("- 压缩率:",Math.round(100*(1-l.size/e.raw.size)),"%"),console.log("- 处理后文件类型:",l.type),console.log("- 处理后文件名:",l.name),h.value="图片处理完成",m.value=100,t(l)},error(o){console.error("图片压缩失败:",o),h.value="处理失败，使用原始图片",m.value=100,t(e.raw)}})}));console.log("替换原始文件为处理后的文件:",t.name),e.processed=!0,e.raw=t;const o=i.value.findIndex((t=>t.uid===e.uid||t.name===e.name));o>=0?i.value[o]=t:i.value.push(t);const a=d.value.findIndex((t=>t.uid===e.uid));a>=0&&(d.value[a].processed=!0),setTimeout((()=>{p.value=!1}),500)}catch(a){console.error("处理图片时出错:",a),g.nk.warning("图片处理失败，将使用原始图片");const t=i.value.findIndex((t=>t.uid===e.uid||t.name===e.name));t>=0?i.value[t]=e.raw:i.value.push(e.raw),p.value=!1}}else!e.raw&&e.url&&console.log("已有文件，不需要处理:",e.name);const o=[...i.value,...u.value];v.value=P(o),console.log("更新后的photoFilesBefore:",i.value),console.log("更新后的fileListBefore:",d.value)},$=(e,t)=>{console.log("收集前照片移除:",e),d.value=t,e.raw?i.value=i.value.filter((t=>t.name!==e.raw.name)):i.value=i.value.filter((t=>t.uid!==e.uid&&t.name!==e.name)),P([...i.value,...u.value])||(v.value=!1),console.log("更新后的photoFilesBefore:",i.value)},T=async(e,t)=>{if(console.log("收集后照片变更:",e),console.log("当前文件列表:",t),c.value=[...t],e.processed)return void console.log("文件已处理过，跳过压缩:",e.name);if(e.raw&&"ready"===e.status){p.value=!0,h.value="正在处理图片...",m.value=0,console.log("开始处理收集后照片:",e.name,"类型:",e.raw.type,"大小:",(e.raw.size/1024).toFixed(2),"KB");try{const t=await new Promise((t=>{new(q())(e.raw,{quality:.6,maxWidth:1920,maxHeight:1920,mimeType:"image/jpeg",convertSize:0,beforeDraw(){m.value=30,h.value="正在处理图片...",console.log("图片处理中...")},drew(){m.value=60,h.value="正在压缩图片...",console.log("图片绘制完成")},success(o){const a=e.raw.name.replace(/\.[^/.]+$/,"")+".jpg",l=new File([o],a,{type:"image/jpeg",lastModified:(new Date).getTime()});console.log("图片处理完成:"),console.log("- 原始大小:",(e.raw.size/1024).toFixed(2),"KB"),console.log("- 处理后大小:",(l.size/1024).toFixed(2),"KB"),console.log("- 压缩率:",Math.round(100*(1-l.size/e.raw.size)),"%"),console.log("- 处理后文件类型:",l.type),console.log("- 处理后文件名:",l.name),h.value="图片处理完成",m.value=100,t(l)},error(o){console.error("图片压缩失败:",o),h.value="处理失败，使用原始图片",m.value=100,t(e.raw)}})}));console.log("替换原始文件为处理后的文件:",t.name),e.processed=!0,e.raw=t;const o=u.value.findIndex((t=>t.uid===e.uid||t.name===e.name));o>=0?u.value[o]=t:u.value.push(t);const a=c.value.findIndex((t=>t.uid===e.uid));a>=0&&(c.value[a].processed=!0),setTimeout((()=>{p.value=!1}),500)}catch(a){console.error("处理图片时出错:",a),g.nk.warning("图片处理失败，将使用原始图片");const t=u.value.findIndex((t=>t.uid===e.uid||t.name===e.name));t>=0?u.value[t]=e.raw:u.value.push(e.raw),p.value=!1}}else!e.raw&&e.url&&console.log("已有文件，不需要处理:",e.name);const o=[...i.value,...u.value];v.value=P(o),console.log("更新后的photoFilesAfter:",u.value),console.log("更新后的fileListAfter:",c.value)},U=(e,t)=>{console.log("收集后照片移除:",e),c.value=t,e.raw?u.value=u.value.filter((t=>t.name!==e.raw.name)):u.value=u.value.filter((t=>t.uid!==e.uid&&t.name!==e.name)),P([...i.value,...u.value])||(v.value=!1),console.log("更新后的photoFilesAfter:",u.value)},P=e=>{const t=5242880;return e.some((e=>e.size>t))},S=e=>{if(e.total){const t=Math.round(100*e.loaded/e.total);m.value=t,h.value=t<33?"正在上传文件...":t<66?"正在处理文件...":t<100?"即将完成...":"上传完成，正在保存..."}},E=e=>100===e?"完成":`${e}%`,K=()=>{o.value.validate((async t=>{if(t){a.value=!0;try{const t=new FormData;t.append("unitId",e.id),t.append("wasteTypeId",I.wasteTypeId),"其他"===I.process&&y.value.trim()?t.append("process",y.value.trim()):t.append("process",I.process),"其他"===I.location&&b.value.trim()?t.append("location",b.value.trim()):t.append("location",I.location),I.collectionDate&&I.collectionTime&&(t.append("collectionDate",I.collectionDate),t.append("collectionTime",I.collectionTime)),void 0!==I.quantity&&null!==I.quantity&&""!==I.quantity&&t.append("quantity",I.quantity),t.append("remarks",I.remarks||""),fo.state.isLoggedIn&&fo.state.user?(t.append("creator_id",fo.state.user.id),console.log("添加用户信息:",{creator_id:fo.state.user.id,user:fo.state.user})):console.log("用户未登录或用户信息不完整"),console.log("提交表单数据:",{unitId:e.id,wasteTypeId:I.wasteTypeId,process:"其他"===I.process?y.value:I.process,location:"其他"===I.location?b.value:I.location,quantity:I.quantity,remarks:I.remarks||"",photo_before:i.value?i.value.length:0,photo_after:u.value?u.value.length:0}),i.value&&i.value.length>0&&(console.log("添加收集前照片数量:",i.value.length),i.value.forEach(((e,o)=>{e&&(console.log(`收集前照片 ${o+1}:`,e.name),t.append("photo_before",e))}))),u.value&&u.value.length>0&&(console.log("添加收集后照片数量:",u.value.length),u.value.forEach(((e,o)=>{e&&(console.log(`收集后照片 ${o+1}:`,e.name),t.append("photo_after",e))})));const o=[...i.value||[],...u.value||[]];v.value=P(o),o.length>0&&(p.value=!0,m.value=0,h.value="准备上传...");const a=await oo.postForm(w.endpoints.wasteRecords,t,S);console.log("提交响应:",a.data),g.nk.success("废物记录提交成功"),A()}catch(o){console.error("Error submitting form:",o),o.response&&(console.error("错误响应数据:",o.response.data),console.error("错误状态码:",o.response.status)),g.nk.error("提交失败，请稍后再试")}finally{a.value=!1,p.value=!1}}else g.nk.warning("请完成必填项")}))},A=()=>{o.value&&o.value.resetFields(),I.wasteTypeId="",I.location="",I.process="",I.remarks="",I.quantity=void 0,I.collectionDate=(new Date).toISOString().slice(0,10),I.collectionTime=(new Date).toTimeString().slice(0,5),b.value="",y.value="",i.value=[],u.value=[],d.value=[],c.value=[],v.value=!1},Q=()=>{x.value&&t.push("/")},X=()=>{t.push({name:"RecordsList",params:{unitId:e.id}})},B=e=>{setTimeout((()=>{if(e&&e.target){const t=e.target.querySelector("input");t&&t.select()}}),10)};return{form:I,rules:L,wasteForm:o,loading:a,unitName:r,wasteTypes:n,isAdmin:x,fileListBefore:d,fileListAfter:c,handlePhotoBeforeChange:V,handlePhotoBeforeRemove:$,handlePhotoAfterChange:T,handlePhotoAfterRemove:U,handleBeforeUpload:W,submitForm:K,resetForm:A,goBack:Q,viewRecords:X,selectAllText:B,showUploadProgress:p,uploadPercentage:m,uploadStatus:h,percentageFormat:E,showLargeFileWarning:v,locationOptions:k,customLocation:b,customProcess:y,processOptions:_}}};const D=(0,I.A)(B,[["render",A],["__scopeId","data-v-571d8ba8"]]);var M=D;const z={class:"records-container"},j={class:"header"},O={key:1},N={class:"content"},H={class:"unit-info"},Y={class:"actions"},J={class:"filter-header"},G={class:"filter-form-container"},Z={class:"quantity-range"},ee={class:"input-with-clear"},te={class:"input-with-clear"},oe={class:"filter-actions"},ae={class:"records-wrapper"},le={class:"card-header"},re={class:"card-actions"},ne={key:0,class:"photo-preview"},se=["onClick"],ie={key:0,class:"photo-count"},ue={key:1},de={key:0,class:"photo-preview"},ce=["onClick"],pe={key:0,class:"photo-count"},me={key:1},ge={class:"operation-buttons"},fe={key:0,class:"loading-row"},he={key:1,class:"load-more-row"},ve={key:2,class:"no-more-row"},we={key:0,class:"empty-block"},ke={key:1,class:"record-limit-tip"};function be(e,t,o,r,n,s){const u=(0,l.g2)("arrow-left"),d=(0,l.g2)("el-icon"),c=(0,l.g2)("home"),p=(0,l.g2)("plus"),m=(0,l.g2)("el-button"),g=(0,l.g2)("user"),f=(0,l.g2)("refresh"),h=(0,l.g2)("arrow-down"),v=(0,l.g2)("arrow-up"),w=(0,l.g2)("el-option"),k=(0,l.g2)("el-select"),b=(0,l.g2)("el-form-item"),y=(0,l.g2)("el-col"),_=(0,l.g2)("el-input"),F=(0,l.g2)("el-date-picker"),x=(0,l.g2)("el-row"),I=(0,l.g2)("el-input-number"),L=(0,l.g2)("CircleClose"),R=(0,l.g2)("el-form"),C=(0,l.g2)("el-card"),W=(0,l.g2)("download"),V=(0,l.g2)("el-table-column"),$=(0,l.g2)("el-image"),T=(0,l.g2)("loading"),U=(0,l.g2)("el-table"),P=(0,l.g2)("el-empty"),S=(0,l.g2)("el-alert"),E=(0,l.g2)("el-image-viewer"),K=(0,l.gN)("loading");return(0,l.uX)(),(0,l.CE)("div",z,[(0,l.Lk)("div",j,[(0,l.Lk)("div",{class:"back-button",onClick:t[0]||(t[0]=(...e)=>r.goBack&&r.goBack(...e))},[(0,l.bF)(d,null,{default:(0,l.k6)((()=>[(0,l.bF)(u)])),_:1}),t[11]||(t[11]=(0,l.eW)(" 返回填报 "))]),t[13]||(t[13]=(0,l.Lk)("h1",null,"废物记录查看",-1)),r.isAdmin?((0,l.uX)(),(0,l.CE)("div",{key:0,class:"home-link",onClick:t[1]||(t[1]=(...e)=>r.goHome&&r.goHome(...e))},[t[12]||(t[12]=(0,l.eW)(" 首页 ")),(0,l.bF)(d,null,{default:(0,l.k6)((()=>[(0,l.bF)(c)])),_:1})])):((0,l.uX)(),(0,l.CE)("div",O))]),(0,l.Lk)("div",N,[(0,l.Lk)("div",H,[(0,l.Lk)("h2",null,(0,i.v_)(r.unitName)+" 固体废物记录",1)]),(0,l.Lk)("div",Y,[(0,l.bF)(m,{type:"primary",onClick:r.addNewRecord},{default:(0,l.k6)((()=>[(0,l.bF)(d,null,{default:(0,l.k6)((()=>[(0,l.bF)(p)])),_:1}),t[14]||(t[14]=(0,l.eW)(" 新增填报 "))])),_:1},8,["onClick"]),r.isAdmin||r.isUnitAdmin?((0,l.uX)(),(0,l.Wv)(m,{key:0,type:"success",onClick:r.goToUserManagement},{default:(0,l.k6)((()=>[(0,l.bF)(d,null,{default:(0,l.k6)((()=>[(0,l.bF)(g)])),_:1}),t[15]||(t[15]=(0,l.eW)(" 人员管理 "))])),_:1},8,["onClick"])):(0,l.Q3)("",!0),(0,l.bF)(m,{onClick:r.refreshRecords},{default:(0,l.k6)((()=>[(0,l.bF)(d,null,{default:(0,l.k6)((()=>[(0,l.bF)(f)])),_:1}),t[16]||(t[16]=(0,l.eW)(" 刷新 "))])),_:1},8,["onClick"])]),(0,l.bF)(C,{class:"filter-card"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",J,[t[17]||(t[17]=(0,l.Lk)("h3",null,"筛选条件",-1)),(0,l.bF)(m,{type:"primary",link:"",onClick:t[2]||(t[2]=e=>r.showFilterPanel=!r.showFilterPanel)},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(r.showFilterPanel?"收起":"展开")+" ",1),r.showFilterPanel?((0,l.uX)(),(0,l.Wv)(d,{key:1},{default:(0,l.k6)((()=>[(0,l.bF)(v)])),_:1})):((0,l.uX)(),(0,l.Wv)(d,{key:0},{default:(0,l.k6)((()=>[(0,l.bF)(h)])),_:1}))])),_:1})]),(0,l.bo)((0,l.Lk)("div",G,[(0,l.bF)(R,{model:r.filterForm,"label-width":"100px",class:"filter-form"},{default:(0,l.k6)((()=>[(0,l.bF)(x,{gutter:20},{default:(0,l.k6)((()=>[(0,l.bF)(y,{xs:24,sm:12,md:8,lg:6,xl:6},{default:(0,l.k6)((()=>[(0,l.bF)(b,{label:"废物类型"},{default:(0,l.k6)((()=>[(0,l.bF)(k,{modelValue:r.filterForm.wasteTypeId,"onUpdate:modelValue":t[3]||(t[3]=e=>r.filterForm.wasteTypeId=e),placeholder:"选择废物类型",style:{width:"100%"},clearable:""},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.wasteTypes,(e=>((0,l.uX)(),(0,l.Wv)(w,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),(0,l.bF)(y,{xs:24,sm:12,md:8,lg:6,xl:6},{default:(0,l.k6)((()=>[(0,l.bF)(b,{label:"产生地点"},{default:(0,l.k6)((()=>[(0,l.bF)(_,{modelValue:r.filterForm.location,"onUpdate:modelValue":t[4]||(t[4]=e=>r.filterForm.location=e),placeholder:"输入地点关键词搜索",clearable:""},null,8,["modelValue"])])),_:1})])),_:1}),(0,l.bF)(y,{xs:24,sm:12,md:8,lg:6,xl:6},{default:(0,l.k6)((()=>[(0,l.bF)(b,{label:"产生工序"},{default:(0,l.k6)((()=>[(0,l.bF)(_,{modelValue:r.filterForm.process,"onUpdate:modelValue":t[5]||(t[5]=e=>r.filterForm.process=e),placeholder:"输入工序关键词搜索",clearable:""},null,8,["modelValue"])])),_:1})])),_:1}),(0,l.bF)(y,{xs:24,sm:12,md:8,lg:6,xl:6},{default:(0,l.k6)((()=>[(0,l.bF)(b,{label:"收集时间"},{default:(0,l.k6)((()=>[(0,l.bF)(F,{modelValue:r.filterForm.dateRange,"onUpdate:modelValue":t[6]||(t[6]=e=>r.filterForm.dateRange=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"},"disabled-date":r.disabledDate},null,8,["modelValue","disabled-date"])])),_:1})])),_:1})])),_:1}),(0,l.bF)(x,{gutter:20},{default:(0,l.k6)((()=>[(0,l.bF)(y,{xs:24,sm:12,md:16,lg:12,xl:12},{default:(0,l.k6)((()=>[(0,l.bF)(b,{label:"数量范围(吨)"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",Z,[(0,l.Lk)("div",ee,[(0,l.bF)(I,{modelValue:r.filterForm.minQuantity,"onUpdate:modelValue":t[7]||(t[7]=e=>r.filterForm.minQuantity=e),min:0,precision:3,step:.001,placeholder:"最小值",style:{width:"100%"}},null,8,["modelValue"]),null!==r.filterForm.minQuantity?((0,l.uX)(),(0,l.Wv)(d,{key:0,class:"clear-icon",onClick:t[8]||(t[8]=e=>r.filterForm.minQuantity=null)},{default:(0,l.k6)((()=>[(0,l.bF)(L)])),_:1})):(0,l.Q3)("",!0)]),t[18]||(t[18]=(0,l.Lk)("span",{class:"range-separator"},"至",-1)),(0,l.Lk)("div",te,[(0,l.bF)(I,{modelValue:r.filterForm.maxQuantity,"onUpdate:modelValue":t[9]||(t[9]=e=>r.filterForm.maxQuantity=e),min:r.filterForm.minQuantity||0,precision:3,step:.001,placeholder:"最大值",style:{width:"100%"}},null,8,["modelValue","min"]),null!==r.filterForm.maxQuantity?((0,l.uX)(),(0,l.Wv)(d,{key:0,class:"clear-icon",onClick:t[10]||(t[10]=e=>r.filterForm.maxQuantity=null)},{default:(0,l.k6)((()=>[(0,l.bF)(L)])),_:1})):(0,l.Q3)("",!0)])])])),_:1})])),_:1}),(0,l.bF)(y,{xs:24,sm:12,md:8,lg:12,xl:12,class:"filter-buttons-col"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",oe,[(0,l.bF)(m,{type:"primary",onClick:r.applyFilter},{default:(0,l.k6)((()=>t[19]||(t[19]=[(0,l.eW)("刷新筛选")]))),_:1},8,["onClick"]),(0,l.bF)(m,{onClick:r.resetFilter},{default:(0,l.k6)((()=>t[20]||(t[20]=[(0,l.eW)("重置")]))),_:1},8,["onClick"])])])),_:1})])),_:1})])),_:1},8,["model"])],512),[[a.aG,r.showFilterPanel]])])),_:1}),(0,l.Lk)("div",ae,[(0,l.bF)(C,{class:"records-card"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",le,[t[24]||(t[24]=(0,l.Lk)("h3",{class:"table-title"},"废物记录列表",-1)),(0,l.Lk)("div",re,[(0,l.bF)(m,{type:"warning",onClick:r.exportWithoutImages,loading:r.loading},{default:(0,l.k6)((()=>[(0,l.bF)(d,null,{default:(0,l.k6)((()=>[(0,l.bF)(W)])),_:1}),t[21]||(t[21]=(0,l.eW)(" 无照片 "))])),_:1},8,["onClick","loading"]),(0,l.bF)(m,{type:"warning",onClick:r.exportWithImages,loading:r.loading},{default:(0,l.k6)((()=>[(0,l.bF)(d,null,{default:(0,l.k6)((()=>[(0,l.bF)(W)])),_:1}),t[22]||(t[22]=(0,l.eW)(" 包含首张照片 "))])),_:1},8,["onClick","loading"]),(0,l.bF)(m,{type:"warning",onClick:r.exportWithAllImages,loading:r.loading},{default:(0,l.k6)((()=>[(0,l.bF)(d,null,{default:(0,l.k6)((()=>[(0,l.bF)(W)])),_:1}),t[23]||(t[23]=(0,l.eW)(" 包含全部照片 "))])),_:1},8,["onClick","loading"])])]),(0,l.bo)(((0,l.uX)(),(0,l.Wv)(U,{data:r.records,style:{width:"100%"},border:"",stripe:"",class:"responsive-table",height:r.tableHeight},{append:(0,l.k6)((()=>[r.loadingMore?((0,l.uX)(),(0,l.CE)("div",fe,[(0,l.bF)(d,{class:"loading"},{default:(0,l.k6)((()=>[(0,l.bF)(T)])),_:1}),t[27]||(t[27]=(0,l.eW)(" 正在加载... "))])):r.hasMore&&r.records.length>0?((0,l.uX)(),(0,l.CE)("div",he,[(0,l.bF)(m,{type:"primary",onClick:r.loadMore,disabled:r.loadingMore,size:"small"},{default:(0,l.k6)((()=>[t[28]||(t[28]=(0,l.eW)(" 点击加载更多 ")),(0,l.bF)(d,null,{default:(0,l.k6)((()=>[(0,l.bF)(h)])),_:1})])),_:1},8,["onClick","disabled"])])):r.records.length>0?((0,l.uX)(),(0,l.CE)("div",ve," 已全部加载 ")):(0,l.Q3)("",!0)])),default:(0,l.k6)((()=>[(0,l.bF)(V,{type:"index",label:"序号",width:"70",align:"center",index:r.indexMethod},null,8,["index"]),(0,l.bF)(V,{prop:"waste_type_name",label:"废物类型","min-width":"120"}),(0,l.bF)(V,{prop:"location",label:"产生地点","min-width":"120"}),(0,l.bF)(V,{prop:"process",label:"产生工序","min-width":"120"},{default:(0,l.k6)((e=>[(0,l.eW)((0,i.v_)(e.row.process||"无"),1)])),_:1}),(0,l.bF)(V,{prop:"remarks",label:"备注","min-width":"150"},{default:(0,l.k6)((e=>[(0,l.eW)((0,i.v_)(e.row.remarks||"无"),1)])),_:1}),(0,l.bF)(V,{label:"收集开始时间","min-width":"160"},{default:(0,l.k6)((e=>[(0,l.eW)((0,i.v_)(r.parseFormattedDateTime(e.row.collection_start_time)),1)])),_:1}),(0,l.bF)(V,{label:"数量(吨)","min-width":"100"},{default:(0,l.k6)((e=>[(0,l.eW)((0,i.v_)(null!==e.row.quantity&&void 0!==e.row.quantity?parseFloat(e.row.quantity).toFixed(3):""),1)])),_:1}),(0,l.bF)(V,{label:"汇报人","min-width":"100",class:"mobile-hidden"},{default:(0,l.k6)((e=>[(0,l.eW)((0,i.v_)(e.row.creator_name||"未知"),1)])),_:1}),(0,l.bF)(V,{label:"记录时间","min-width":"160",class:"mobile-hidden"},{default:(0,l.k6)((e=>[(0,l.eW)((0,i.v_)(r.parseFormattedDateTime(e.row.created_at)),1)])),_:1}),(0,l.bF)(V,{label:"清理前照片","min-width":"150",align:"center"},{default:(0,l.k6)((e=>[e.row.photo_path_before?((0,l.uX)(),(0,l.CE)("div",ne,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.parsePhotoPath(e.row.photo_path_before),((t,o)=>((0,l.uX)(),(0,l.CE)("div",{key:o,class:"photo-thumbnail-container",onClick:t=>r.previewPhoto(r.parsePhotoPath(e.row.photo_path_before),o)},[(0,l.bF)($,{style:{width:"50px",height:"50px",margin:"0 auto"},src:`${r.baseUrl}${t}`,fit:"cover"},null,8,["src"])],8,se)))),128)),r.parsePhotoPath(e.row.photo_path_before).length>1?((0,l.uX)(),(0,l.CE)("div",ie,(0,i.v_)(r.parsePhotoPath(e.row.photo_path_before).length)+"张 ",1)):(0,l.Q3)("",!0)])):((0,l.uX)(),(0,l.CE)("span",ue,"无"))])),_:1}),(0,l.bF)(V,{label:"清理后照片","min-width":"150",align:"center"},{default:(0,l.k6)((e=>[e.row.photo_path_after?((0,l.uX)(),(0,l.CE)("div",de,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.parsePhotoPath(e.row.photo_path_after),((t,o)=>((0,l.uX)(),(0,l.CE)("div",{key:o,class:"photo-thumbnail-container",onClick:t=>r.previewPhoto(r.parsePhotoPath(e.row.photo_path_after),o)},[(0,l.bF)($,{style:{width:"50px",height:"50px",margin:"0 auto"},src:`${r.baseUrl}${t}`,fit:"cover"},null,8,["src"])],8,ce)))),128)),r.parsePhotoPath(e.row.photo_path_after).length>1?((0,l.uX)(),(0,l.CE)("div",pe,(0,i.v_)(r.parsePhotoPath(e.row.photo_path_after).length)+"张 ",1)):(0,l.Q3)("",!0)])):((0,l.uX)(),(0,l.CE)("span",me,"无"))])),_:1}),(0,l.bF)(V,{label:"操作","min-width":"120"},{default:(0,l.k6)((e=>[(0,l.Lk)("div",ge,[r.canEdit(e.row)?((0,l.uX)(),(0,l.Wv)(m,{key:0,type:"primary",size:"small",onClick:t=>r.editRecord(e.row.id),text:""},{default:(0,l.k6)((()=>t[25]||(t[25]=[(0,l.eW)(" 编辑 ")]))),_:2},1032,["onClick"])):(0,l.Q3)("",!0),r.canEdit(e.row)&&(r.isAdmin||r.isUnitAdmin)?((0,l.uX)(),(0,l.Wv)(m,{key:1,type:"danger",size:"small",onClick:t=>r.confirmDelete(e.row),text:""},{default:(0,l.k6)((()=>t[26]||(t[26]=[(0,l.eW)(" 删除 ")]))),_:2},1032,["onClick"])):(0,l.Q3)("",!0)])])),_:1})])),_:1},8,["data","height"])),[[K,r.loading]]),0!==r.records.length||r.loading?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",we,[(0,l.bF)(P,{description:"暂无废物记录"})])),r.isAdmin||r.isUnitAdmin?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",ke,[(0,l.bF)(S,{title:"提示：只能查看过去48小时内的废物记录",type:"info",closable:!1,"show-icon":""})]))])),_:1})])]),r.showViewer?((0,l.uX)(),(0,l.Wv)(E,{key:0,"url-list":r.previewImages,"initial-index":r.previewIndex,onClose:r.closeViewer},null,8,["url-list","initial-index","onClose"])):(0,l.Q3)("",!0)])}var ye=o(8828),_e=o(2933),Fe=o(5320),xe=o(3230),Ie=o(7093),Le=o.n(Ie);console.log("XLSX库版本:",xe.version),console.log("XLSX库可用方法:",Object.keys(xe).join(", "));const Re=async(e,t=window.location.origin)=>{if(console.log("获取图片:",e),!e)return console.error("图片URL为空"),null;const o=e.startsWith("/")?`${t}${e}`:e;try{console.log("获取图片:",o);const e=await fetch(o,{headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}});if(!e.ok)throw new Error(`获取图片失败: ${e.status} ${e.statusText}`);const t=await e.arrayBuffer();return console.log("图片获取成功，大小:",t.byteLength,"字节"),t}catch(a){return console.error("获取图片失败:",a),null}},Ce=async(e,t,o,a=window.location.origin,l=null)=>{if(console.log("=== exportToExcelWithImages 函数被调用 ==="),console.log("数据条数:",e.length),!e||0===e.length)return console.error("导出失败：没有数据"),!1;try{t=t.replace(/[\\/:*?"<>|]/g,"_");const n=(new Date).toISOString().replace(/[-:.]/g,"").substring(0,14),s=`${t}_${n}.xlsx`,i=new(Le().Workbook);i.creator="固体废物管理系统",i.lastModifiedBy="固体废物管理系统",i.created=new Date,i.modified=new Date;const u=i.addWorksheet("固体废物记录"),d=o.map((e=>({header:e.text,key:e.field,width:e.isImage?20:15})));u.columns=d,u.getRow(1).font={bold:!0},u.getRow(1).alignment={vertical:"middle",horizontal:"center"},console.log("开始处理数据行...");const c=e.length*(1+o.filter((e=>e.isImage)).length);let p=0;for(let t=0;t<e.length;t++){const n=e[t];console.log(`处理第 ${t+1}/${e.length} 条记录...`);const s={};o.forEach((e=>{e.isImage||(s[e.field]=n[e.field]||"")}));const d=u.addRow(s);d.height=80,p++,l&&"function"===typeof l&&l(p,c);for(const e of o)if(e.isImage){const s=e.field,d=n[s];if(d){console.log(`记录 ${t+1} 的 ${s} 字段有图片路径: ${d}`);try{const e=await Re(d,a);if(e){const a=o.findIndex((e=>e.field===s))+1,l=u.getCell(t+2,a).address,r=i.addImage({buffer:e,extension:d.split(".").pop().toLowerCase()});u.addImage(r,{tl:{col:a-1,row:t+1},br:{col:a,row:t+1.9},editAs:"oneCell"}),console.log(`已添加图片到单元格 ${l}`)}else console.error(`获取图片失败: ${d}`)}catch(r){console.error("处理图片时出错:",r)}}else console.log(`记录 ${t+1} 的 ${s} 没有照片路径`);p++,l&&"function"===typeof l&&l(p,c)}}console.log("数据行处理完成，准备生成Excel文件...");const m=await i.xlsx.writeBuffer(),g=new Blob([m],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),f=window.URL.createObjectURL(g),h=document.createElement("a");return h.href=f,h.download=s,h.click(),window.URL.revokeObjectURL(f),console.log("Excel文件生成并下载成功"),!0}catch(n){return console.error("导出Excel文件失败:",n),!1}},We=async(e,t,o)=>{if(!e||0===e.length)return console.error("导出失败：没有数据"),!1;t=t.replace(/[\\/:*?"<>|]/g,"_");const a=(new Date).toISOString().replace(/[-:.]/g,"").substring(0,14),l=`${t}_${a}.xlsx`;console.log("导出函数被调用，数据条数:",e.length);try{console.log("使用ExcelJS导出Excel...");const t=new(Le().Workbook);t.creator="固体废物管理系统",t.lastModifiedBy="固体废物管理系统",t.created=new Date,t.modified=new Date;const a=t.addWorksheet("固体废物记录"),r=o.map((e=>({header:e.text,key:e.field,width:15})));a.columns=r,a.getRow(1).font={bold:!0},a.getRow(1).alignment={vertical:"middle",horizontal:"center"},e.forEach((e=>{const t={};o.forEach((o=>{t[o.field]=e[o.field]||""})),a.addRow(t)})),console.log("生成Excel数据...");const n=await t.xlsx.writeBuffer(),s=new Blob([n],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),i=URL.createObjectURL(s),u=document.createElement("a");return u.href=i,u.download=l,console.log("下载链接创建成功，准备触发点击"),document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(i),console.log("Excel导出成功"),!0}catch(r){return console.error("导出Excel失败，错误详情:",r),console.log("回退到CSV导出"),Ve(e,t,o),!1}},Ve=(e,t,o)=>{const a=(new Date).toISOString().replace(/[-:.]/g,"").substring(0,14),l=`${t}_${a}.csv`;let r="\ufeff";const n=o.map((e=>`"${e.title}"`)).join(",");r+=n+"\r\n",e.forEach((e=>{const t=o.map((t=>{const o=e[t.field];if(null===o||void 0===o)return"";if("number"===t.type||"number"===typeof o)return o;let a=String(o);return(a.includes(",")||a.includes('"')||a.includes("\n"))&&(a=a.replace(/"/g,'""'),a=`"${a}"`),a})).join(",");r+=t+"\r\n"}));const s=new Blob([r],{type:"text/csv;charset=utf-8;"}),i=URL.createObjectURL(s),u=document.createElement("a");u.setAttribute("href",i),u.setAttribute("download",l),u.style.visibility="hidden",document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(i),console.log("CSV导出成功")};var $e={name:"RecordsList",components:{ArrowLeft:Q.nkM,Home:Q.Home,Refresh:Q.C42,Plus:Q.FWt,User:Q.KJW,ArrowDown:Q.yd$,ArrowUp:Q.DoI,Download:Q.f5X,ElImageViewer:ye.Tg,Loading:Q.Rhj,CircleClose:Q.R$5},props:{unitId:{type:[String,Number],required:!0}},setup(e){const t=(0,s.rd)(),o=(0,f.KR)([]),a=(0,f.KR)(!1),r=(0,f.KR)(""),n=(0,f.KR)([]),i=(0,f.KR)(!0),u=w.baseURL,d=e=>{if(!e)return[];try{return e.startsWith("[")&&e.endsWith("]")?JSON.parse(e):[e]}catch(t){return console.error("解析照片路径失败:",t),[e]}},c=(0,f.KR)(1),p=(0,f.KR)(20),m=(0,f.KR)(!0),v=(0,f.KR)(!1),k=(0,f.Kh)({dateRange:null,wasteTypeId:null,minQuantity:null,maxQuantity:null,location:"",process:""}),b=(0,f.KR)(null);(0,l.wB)([()=>k.wasteTypeId,()=>k.location,()=>k.process,()=>k.minQuantity,()=>k.maxQuantity,()=>k.dateRange],(()=>{b.value&&clearTimeout(b.value),b.value=setTimeout((()=>{c.value=1,z()}),300)}));const y=(0,l.EW)((()=>fo.isAdmin())),_=(0,l.EW)((()=>fo.isUnitAdmin())),F=e=>{if(!e)return"";const t=new Date(e);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")} ${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`},x=async()=>{await z(),g.nk.success("记录已刷新")},I=()=>{const e=fo.getUnitId();e?t.push(`/unit/${e}`):t.push("/")},L=()=>{t.push("/")},R=()=>{t.push("/user-management")},C=()=>{t.push(`/unit/${e.unitId}`)},W=e=>{t.push(`/record/${e}`)},V=e=>{if(!e)return!1;if(y.value)return!0;const t=fo.getUnitId();if(_.value&&t&&e.unit_id===parseInt(t))return!0;const o=fo.getUserId();return o&&e.creator_id===parseInt(o)},$=e=>e+1,T=e=>{y.value||_.value?_e.s.confirm("确定要删除这条废物记录吗？此操作不可逆。","删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{await oo.delete(`${w.endpoints.wasteRecords}/${e.id}`),g.nk.success("记录已成功删除"),await z()}catch(t){console.error("删除记录失败:",t),g.nk.error("删除记录失败，请重试")}})).catch((()=>{g.nk.info("已取消删除")})):g.nk.error("您没有删除记录的权限")},U=async()=>{try{c.value=1,await z(),g.nk.success("筛选条件已应用")}catch(e){console.error("应用筛选失败:",e),g.nk.error("应用筛选失败")}},P=async()=>{k.dateRange=null,k.wasteTypeId=null,k.minQuantity=null,k.maxQuantity=null,k.location="",k.process="",c.value=1,await z(),g.nk.success("筛选条件已重置")},S=(0,f.KR)(!1),E=(0,f.KR)([]),K=(0,f.KR)(0),A=(e,t)=>{const o=Array.isArray(e)?e:[e];E.value=o.map((e=>`${u}${e}`)),K.value=t||0,S.value=!0},Q=()=>{S.value=!1},X=(0,f.KR)(750),q=()=>{const e=window.innerHeight,t=Math.max(.85*e,700);X.value=t},B=()=>{q()};(0,l.sV)((async()=>{q(),window.addEventListener("resize",B),await M(),await D(),await z()})),(0,l.hi)((()=>{window.removeEventListener("resize",B)}));const D=async()=>{try{const e=await oo.get(w.endpoints.wasteTypes);n.value=e.data}catch(e){console.error("Error fetching waste types:",e),g.nk.error("获取废物类型列表失败")}},M=async()=>{try{const t=await oo.get(w.endpoints.units),o=t.data.find((t=>t.id===parseInt(e.unitId)));o&&(r.value=o.name)}catch(t){console.error("Error fetching unit name:",t),g.nk.error("获取单位信息失败")}},z=async(t=!1)=>{t?v.value=!0:(a.value=!0,c.value=1,o.value=[]);try{if(!fo.state.isLoggedIn||!fo.state.user)throw new Error("用户未登录");const a={page:c.value,pageSize:p.value,wasteTypeId:k.wasteTypeId||void 0,minQuantity:k.minQuantity||void 0,maxQuantity:k.maxQuantity||void 0,location:k.location||void 0,process:k.process||void 0,unitId:e.unitId?parseInt(e.unitId):void 0};k.dateRange&&2===k.dateRange.length&&(a.dateRange=JSON.stringify(k.dateRange)),console.log("【筛选】请求废物记录，参数:",JSON.stringify(a,null,2));const l=w.getUrl(`${w.endpoints.wasteRecords}/user/${fo.state.user.id}`);console.log("【筛选】请求URL:",l);const r=await h.A.get(l,{params:a});if(console.log("【筛选】获取到废物记录响应:",r.data),!r.data||!r.data.records)throw console.error("【筛选】响应数据格式错误:",r.data),new Error("响应数据格式错误");const n=r.data.records.map((e=>({...e,created_at:F(e.created_at),collection_start_time:F(e.collection_start_time)})));console.log(`【筛选】获取到${n.length}条记录`),o.value=t?[...o.value,...n]:n,m.value=r.data.hasMore,m.value&&c.value++}catch(l){console.error("【筛选】获取废物记录失败:",l),g.nk.error("获取废物记录失败: "+(l.message||"未知错误"))}finally{a.value=!1,v.value=!1}},j=()=>{console.log("手动触发加载更多");const e=document.querySelector(".el-table__body-wrapper"),t=e?e.scrollTop:0;return z(!0).then((()=>{console.log("加载完成，当前记录数:",o.value.length),setTimeout((()=>{e&&(e.scrollTop=t)}),10)})).catch((e=>{console.error("加载失败:",e),g.nk.error("加载更多数据失败")}))},O=(0,l.EW)((()=>!y.value&&!_.value)),N=async()=>{try{(0,g.nk)({message:"导出大量包含图片的记录所需时间较长，请耐心等待",type:"info",duration:5e3});const t=Fe.Ks.service({lock:!0,text:"正在导出记录，请稍候...",background:"rgba(0, 0, 0, 0.7)"});a.value=!0;const o={wasteTypeId:k.wasteTypeId?k.wasteTypeId:void 0,minQuantity:k.minQuantity?k.minQuantity:void 0,maxQuantity:k.maxQuantity?k.maxQuantity:void 0,location:k.location||void 0,process:k.process||void 0,dateRange:k.dateRange?JSON.stringify(k.dateRange):void 0,unitId:e.unitId?parseInt(e.unitId):void 0};console.log("导出记录的筛选条件:",o);const{data:l}=await h.A.get(`${w.getUrl(w.endpoints.exportWasteRecords)}/${fo.state.user.id}`,{params:o});if(console.log(`从后端获取到 ${l.length} 条记录用于导出`),0===l.length)return t.close(),g.nk.warning("没有符合条件的记录可导出"),void(a.value=!1);t.setText(`准备导出 ${l.length} 条记录...`);const n=l.map((e=>{const t=d(e.photo_path_before),o=d(e.photo_path_after);return{"单位":e.unit_name,"废物类型":e.waste_type_name,"产生地点":e.location,"产生工序":e.process||"无","备注":e.remarks||"无","收集开始时间":F(e.collection_start_time),"数量(吨)":e.quantity,"填报人":e.creator_name||"系统","记录时间":F(e.created_at),"清理前照片":t.length>0?t[0]:"","清理后照片":o.length>0?o[0]:""}})),s=`固体废物记录_${r.value?r.value:"全部单位"}`,i=[{text:"单位",field:"单位"},{text:"废物类型",field:"废物类型"},{text:"产生工序",field:"产生工序"},{text:"产生地点",field:"产生地点"},{text:"备注",field:"备注"},{text:"收集开始时间",field:"收集开始时间"},{text:"数量(吨)",field:"数量(吨)"},{text:"填报人",field:"填报人"},{text:"记录时间",field:"记录时间"},{text:"清理前照片",field:"清理前照片",isImage:!0},{text:"清理后照片",field:"清理后照片",isImage:!0}],u=window.location.origin,c=(e,o)=>{const a=Math.round(e/o*100);t.setText(`正在导出：${a}% (${e}/${o})`)},p=await Ce(n,s,i,u,c);t.close(),p?g.nk.success("导出成功"):g.nk.error("导出失败，请重试")}catch(t){console.error("导出记录失败:",t),g.nk.error("导出失败: "+(t.message||"未知错误"))}finally{a.value=!1,Fe.Ks.service().close()}},H=async()=>{try{(0,g.nk)({message:"导出大量包含全部图片的记录所需时间较长，请耐心等待",type:"info",duration:5e3});const t=Fe.Ks.service({lock:!0,text:"正在导出记录，请稍候...",background:"rgba(0, 0, 0, 0.7)"});a.value=!0;const o={wasteTypeId:k.wasteTypeId?k.wasteTypeId:void 0,minQuantity:k.minQuantity?k.minQuantity:void 0,maxQuantity:k.maxQuantity?k.maxQuantity:void 0,location:k.location||void 0,process:k.process||void 0,dateRange:k.dateRange?JSON.stringify(k.dateRange):void 0,unitId:e.unitId?parseInt(e.unitId):void 0};console.log("导出记录的筛选条件:",o);const{data:l}=await h.A.get(`${w.getUrl(w.endpoints.exportWasteRecords)}/${fo.state.user.id}`,{params:o});if(console.log(`从后端获取到 ${l.length} 条记录用于导出`),0===l.length)return t.close(),g.nk.warning("没有符合条件的记录可导出"),void(a.value=!1);t.setText(`准备导出 ${l.length} 条记录的全部照片...`);const n=l.map((e=>{const t=d(e.photo_path_before),o=d(e.photo_path_after),a={"单位":e.unit_name,"废物类型":e.waste_type_name,"产生工序":e.process||"无","产生地点":e.location,"备注":e.remarks||"无","收集开始时间":F(e.collection_start_time),"数量(吨)":e.quantity,"填报人":e.creator_name||"系统","记录时间":F(e.created_at)};for(let l=0;l<5;l++)a[`清理前照片${l+1}`]=l<t.length?t[l]:"";for(let l=0;l<5;l++)a[`清理后照片${l+1}`]=l<o.length?o[l]:"";return a})),s=`固体废物记录_全部照片_${r.value?r.value:"全部单位"}`,i=[{text:"单位",field:"单位"},{text:"废物类型",field:"废物类型"},{text:"产生工序",field:"产生工序"},{text:"产生地点",field:"产生地点"},{text:"备注",field:"备注"},{text:"收集开始时间",field:"收集开始时间"},{text:"数量(吨)",field:"数量(吨)"},{text:"填报人",field:"填报人"},{text:"记录时间",field:"记录时间"}];for(let e=0;e<5;e++)i.push({text:`清理前照片${e+1}`,field:`清理前照片${e+1}`,isImage:!0});for(let e=0;e<5;e++)i.push({text:`清理后照片${e+1}`,field:`清理后照片${e+1}`,isImage:!0});const u=window.location.origin,c=(e,o)=>{const a=Math.round(e/o*100);t.setText(`正在导出全部照片：${a}% (${e}/${o})`)},p=await Ce(n,s,i,u,c);t.close(),p?g.nk.success("导出成功"):g.nk.error("导出失败，请重试")}catch(t){console.error("导出记录失败:",t),g.nk.error("导出失败: "+(t.message||"未知错误"))}finally{a.value=!1,Fe.Ks.service().close()}},Y=async()=>{try{const t=Fe.Ks.service({lock:!0,text:"正在导出记录，请稍候...",background:"rgba(0, 0, 0, 0.7)"});a.value=!0;const o={wasteTypeId:k.wasteTypeId?k.wasteTypeId:void 0,minQuantity:k.minQuantity?k.minQuantity:void 0,maxQuantity:k.maxQuantity?k.maxQuantity:void 0,location:k.location||void 0,process:k.process||void 0,dateRange:k.dateRange?JSON.stringify(k.dateRange):void 0,unitId:e.unitId?parseInt(e.unitId):void 0},{data:l}=await h.A.get(`${w.getUrl(w.endpoints.exportWasteRecords)}/${fo.state.user.id}`,{params:o});if(0===l.length)return t.close(),g.nk.warning("没有符合条件的记录可导出"),void(a.value=!1);t.setText(`准备导出 ${l.length} 条记录...`);const n=l.map((e=>({"单位":e.unit_name,"废物类型":e.waste_type_name,"产生工序":e.process||"无","产生地点":e.location,"备注":e.remarks||"无","收集开始时间":F(e.collection_start_time),"数量(吨)":e.quantity,"填报人":e.creator_name||"系统","记录时间":F(e.created_at),"清理前照片":e.photo_path_before?"有":"无","清理后照片":e.photo_path_after?"有":"无"}))),s=`固体废物记录_${r.value?r.value:"全部单位"}`,i=[{text:"单位",field:"单位"},{text:"废物类型",field:"废物类型"},{text:"产生地点",field:"产生地点"},{text:"产生工序",field:"产生工序"},{text:"备注",field:"备注"},{text:"收集开始时间",field:"收集开始时间"},{text:"数量(吨)",field:"数量(吨)"},{text:"填报人",field:"填报人"},{text:"记录时间",field:"记录时间"},{text:"清理前照片",field:"清理前照片"},{text:"清理后照片",field:"清理后照片"}],u=await We(n,s,i);t.close(),u?g.nk.success("导出成功"):g.nk.error("导出失败，请重试")}catch(t){console.error("导出记录失败:",t),g.nk.error("导出失败: "+(t.message||"未知错误"))}finally{a.value=!1,Fe.Ks.service().close()}},J=e=>{if(!y.value&&!_.value){const t=new Date,o=new Date(t);return o.setHours(t.getHours()-48),e<o||e>t}return!1};return{records:o,loading:a,unitName:r,wasteTypes:n,isAdmin:y,isUnitAdmin:_,parseFormattedDateTime:F,refreshRecords:x,goBack:I,goHome:L,goToUserManagement:R,addNewRecord:C,editRecord:W,canEdit:V,confirmDelete:T,apiConfig:w,showFilterPanel:i,filterForm:k,applyFilter:U,resetFilter:P,debounceTimer:b,exportWithImages:N,exportWithAllImages:H,exportWithoutImages:Y,showViewer:S,previewImages:E,previewIndex:K,previewPhoto:A,closeViewer:Q,handleResize:B,parsePhotoPath:d,baseUrl:u,page:c,pageSize:p,hasMore:m,loadingMore:v,indexMethod:$,disabledDate:J,tableHeight:X,isBasicEmployee:O,loadMore:j}}};const Te=(0,I.A)($e,[["render",be],["__scopeId","data-v-56bbcc21"]]);var Ue=Te;const Pe={class:"login-container"},Se={class:"login-card"},Ee={key:0,class:"login-error"};function Ke(e,t,o,r,n,s){const u=(0,l.g2)("el-input"),d=(0,l.g2)("el-form-item"),c=(0,l.g2)("el-checkbox"),p=(0,l.g2)("el-button"),m=(0,l.g2)("el-form");return(0,l.uX)(),(0,l.CE)("div",Pe,[(0,l.Lk)("div",Se,[t[5]||(t[5]=(0,l.Lk)("div",{class:"login-header"},[(0,l.Lk)("h1",null,"固体废物管理系统"),(0,l.Lk)("h2",null,"用户登录")],-1)),(0,l.bF)(m,{ref:"loginForm",model:r.form,rules:r.rules,"label-width":"80px",class:"login-form",onSubmit:(0,a.D$)(r.submitForm,["prevent"])},{default:(0,l.k6)((()=>[(0,l.bF)(d,{label:"用户",prop:"phone"},{default:(0,l.k6)((()=>[(0,l.bF)(u,{modelValue:r.form.phone,"onUpdate:modelValue":t[0]||(t[0]=e=>r.form.phone=e),placeholder:"请输入用户名"},null,8,["modelValue"])])),_:1}),(0,l.bF)(d,{label:"密码",prop:"password"},{default:(0,l.k6)((()=>[(0,l.bF)(u,{modelValue:r.form.password,"onUpdate:modelValue":t[1]||(t[1]=e=>r.form.password=e),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])])),_:1}),(0,l.bF)(d,null,{default:(0,l.k6)((()=>[(0,l.bF)(c,{modelValue:r.form.rememberMe,"onUpdate:modelValue":t[2]||(t[2]=e=>r.form.rememberMe=e)},{default:(0,l.k6)((()=>t[3]||(t[3]=[(0,l.eW)("记住登录")]))),_:1},8,["modelValue"])])),_:1}),(0,l.bF)(d,null,{default:(0,l.k6)((()=>[(0,l.bF)(p,{type:"primary","native-type":"submit",onClick:r.submitForm,loading:r.auth.state.loading,style:{width:"100%"}},{default:(0,l.k6)((()=>t[4]||(t[4]=[(0,l.eW)(" 登录 ")]))),_:1},8,["onClick","loading"])])),_:1})])),_:1},8,["model","rules","onSubmit"]),r.auth.state.error?((0,l.uX)(),(0,l.CE)("div",Ee,(0,i.v_)(r.auth.state.error),1)):(0,l.Q3)("",!0)])])}var Ae={name:"LoginView",setup(){const e=(0,s.rd)(),t=(0,f.KR)(null),o=(0,f.Kh)({phone:"",password:"",rememberMe:!1}),a=(0,l.EW)((()=>{const e=[{required:!0,message:"请输入用户名",trigger:"submit"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的格式",trigger:"submit"}],t=[{required:!0,message:"请输入密码",trigger:"submit"}];return{phone:e,password:t}})),r=async()=>{console.log("提交表单被触发"),t.value?fo.state.loading?console.log("登录正在进行中，跳过"):t.value.validate((async e=>{e?(console.log("表单验证通过"),await n()):console.log("表单验证失败")})):console.log("表单引用不存在")},n=async()=>{console.log("开始登录，账号:",o.phone);try{console.log("开始处理登录操作...");const t=await fo.login(o.phone,o.password,o.rememberMe);if(console.log("登录响应:",t),t.success){const o=t.user;g.nk.success(`欢迎，${o.username||o.phone}`),3===o.role_id?e.push("/admin-records"):4===o.role_id?e.push("/record/new"):(o.role_id,e.push(`/unit/${o.unit_id}`))}else g.nk.error(t.error||"登录失败")}catch(t){g.nk.error(t.response?.data?.error||"登录失败，请检查网络连接")}};return(0,l.sV)((()=>{if(fo.state.isLoggedIn){const t=fo.state.user;3===t.role_id?e.push("/admin-records"):4===t.role_id?e.push("/record/new"):(t.role_id,e.push(`/unit/${t.unit_id}`))}})),{form:o,rules:a,loginForm:t,submitForm:r,auth:fo}}};const Qe=(0,I.A)(Ae,[["render",Ke],["__scopeId","data-v-25ea481a"]]);var Xe=Qe;const qe={class:"edit-record-container"},Be={class:"header"},De={key:1},Me={key:3},ze={class:"content"},je={class:"form-header"},Oe={key:0,class:"upload-warning"},Ne={class:"upload-progress"},He={class:"upload-status"};function Ye(e,t,o,a,r,n){const s=(0,l.g2)("arrow-left"),u=(0,l.g2)("el-icon"),d=(0,l.g2)("el-option"),c=(0,l.g2)("el-select"),p=(0,l.g2)("el-form-item"),m=(0,l.g2)("el-input"),g=(0,l.g2)("el-date-picker"),f=(0,l.g2)("clock"),h=(0,l.g2)("el-time-picker"),v=(0,l.g2)("el-input-number"),w=(0,l.g2)("el-alert"),k=(0,l.g2)("plus"),b=(0,l.g2)("el-upload"),y=(0,l.g2)("el-image-viewer"),_=(0,l.g2)("el-button"),F=(0,l.g2)("el-form"),x=(0,l.g2)("el-progress"),I=(0,l.g2)("el-dialog"),L=(0,l.gN)("loading");return(0,l.uX)(),(0,l.CE)("div",qe,[(0,l.Lk)("div",Be,[a.isSupervisor?((0,l.uX)(),(0,l.CE)("div",De)):((0,l.uX)(),(0,l.CE)("div",{key:0,class:"back-button",onClick:t[0]||(t[0]=(...e)=>a.goBack&&a.goBack(...e))},[(0,l.bF)(u,null,{default:(0,l.k6)((()=>[(0,l.bF)(s)])),_:1}),t[13]||(t[13]=(0,l.eW)(" 查看记录 "))])),(0,l.Lk)("h1",null,(0,i.v_)(a.isNew?"新增废物记录":"编辑废物记录"),1),a.isSupervisor?((0,l.uX)(),(0,l.CE)("div",{key:2,class:"back-button supervisor-back-button",onClick:t[1]||(t[1]=(...e)=>a.goBack&&a.goBack(...e))}," 查看记录 ")):((0,l.uX)(),(0,l.CE)("div",Me))]),(0,l.Lk)("div",ze,[(0,l.Lk)("div",je,[(0,l.Lk)("h2",null,(0,i.v_)(a.unitName),1)]),(0,l.bo)(((0,l.uX)(),(0,l.Wv)(F,{ref:"recordForm",model:a.form,rules:a.rules,"label-width":"120px",class:"record-form"},{default:(0,l.k6)((()=>[a.isAdmin&&a.isNew?((0,l.uX)(),(0,l.Wv)(p,{key:0,label:"单位",prop:"unitId"},{default:(0,l.k6)((()=>[(0,l.bF)(c,{modelValue:a.form.unitId,"onUpdate:modelValue":t[2]||(t[2]=e=>a.form.unitId=e),placeholder:"请选择单位",style:{width:"100%"}},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(a.units,(e=>((0,l.uX)(),(0,l.Wv)(d,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),t[14]||(t[14]=(0,l.Lk)("div",{class:"form-tip"},"请先选择单位，才能选择产生地点",-1))])),_:1})):(0,l.Q3)("",!0),(0,l.bF)(p,{label:"废物类型",prop:"wasteTypeId"},{default:(0,l.k6)((()=>[(0,l.bF)(c,{modelValue:a.form.wasteTypeId,"onUpdate:modelValue":t[3]||(t[3]=e=>a.form.wasteTypeId=e),placeholder:"请选择废物类型",style:{width:"100%"}},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(a.wasteTypes,(e=>((0,l.uX)(),(0,l.Wv)(d,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),(0,l.bF)(p,{label:"产生工序",prop:"process"},{default:(0,l.k6)((()=>[(0,l.bF)(c,{modelValue:a.form.process,"onUpdate:modelValue":t[4]||(t[4]=e=>a.form.process=e),placeholder:"请选择产生工序",style:{width:"100%"}},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(a.processOptions,(e=>((0,l.uX)(),(0,l.Wv)(d,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue"]),"其他"===a.form.process?((0,l.uX)(),(0,l.Wv)(m,{key:0,modelValue:a.customProcess,"onUpdate:modelValue":t[5]||(t[5]=e=>a.customProcess=e),placeholder:"请输入具体产生工序",style:{"margin-top":"10px",height:"40px"}},null,8,["modelValue"])):(0,l.Q3)("",!0)])),_:1}),(0,l.bF)(p,{label:"产生地点",prop:"location"},{default:(0,l.k6)((()=>[(0,l.bF)(c,{modelValue:a.form.location,"onUpdate:modelValue":t[6]||(t[6]=e=>a.form.location=e),placeholder:a.isAdmin&&!a.unitName?"请先选择单位":"请选择废物产生地点",style:{width:"100%"},disabled:a.isAdmin&&!a.unitName},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(a.locationOptions,(e=>((0,l.uX)(),(0,l.Wv)(d,{key:e,label:e,value:e},null,8,["label","value"])))),128))])),_:1},8,["modelValue","placeholder","disabled"]),"其他"===a.form.location?((0,l.uX)(),(0,l.Wv)(m,{key:0,modelValue:a.customLocation,"onUpdate:modelValue":t[7]||(t[7]=e=>a.customLocation=e),placeholder:"请输入具体产生地点",style:{"margin-top":"10px",height:"40px"}},null,8,["modelValue"])):(0,l.Q3)("",!0)])),_:1}),(0,l.bF)(p,{label:"备注",prop:"remarks"},{default:(0,l.k6)((()=>[(0,l.bF)(m,{modelValue:a.form.remarks,"onUpdate:modelValue":t[8]||(t[8]=e=>a.form.remarks=e),type:"textarea",rows:1,placeholder:"请输入备注信息（选填）"},null,8,["modelValue"])])),_:1}),(0,l.bF)(p,{label:"收集日期"},{default:(0,l.k6)((()=>[(0,l.bF)(g,{modelValue:a.form.collectionDate,"onUpdate:modelValue":t[9]||(t[9]=e=>a.form.collectionDate=e),type:"date",placeholder:"选择日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])])),_:1}),(0,l.bF)(p,{label:"收集时间"},{default:(0,l.k6)((()=>[(0,l.bF)(h,{modelValue:a.form.collectionTime,"onUpdate:modelValue":t[10]||(t[10]=e=>a.form.collectionTime=e),format:"HH:mm",placeholder:"选择时间","value-format":"HH:mm",style:{width:"100%"}},{prefix:(0,l.k6)((()=>[(0,l.bF)(u,null,{default:(0,l.k6)((()=>[(0,l.bF)(f)])),_:1})])),_:1},8,["modelValue"])])),_:1}),(0,l.bF)(p,{label:"收集数量(吨)",prop:"quantity"},{default:(0,l.k6)((()=>[(0,l.bF)(v,{modelValue:a.form.quantity,"onUpdate:modelValue":t[11]||(t[11]=e=>a.form.quantity=e),min:0,precision:3,step:.001,style:{width:"100%"}},null,8,["modelValue"])])),_:1}),(0,l.bF)(p,{label:"现场照片（收集前）",prop:"photo_path_before"},{default:(0,l.k6)((()=>[t[15]||(t[15]=(0,l.Lk)("div",{class:"photo-tip"},"请上传废物收集前的现场照片（最多5张）",-1)),a.showLargeFileWarning?((0,l.uX)(),(0,l.CE)("div",Oe,[(0,l.bF)(w,{title:"上传大文件可能会导致处理时间较长，请耐心等待",type:"warning",closable:!1,"show-icon":""})])):(0,l.Q3)("",!0),(0,l.bF)(b,{class:"waste-photo-uploader",action:"#","auto-upload":!1,"on-change":a.handlePhotoBeforeChange,"on-remove":a.handlePhotoBeforeRemove,"file-list":a.fileListBefore,limit:5,multiple:"","list-type":"picture-card","on-preview":a.handlePictureCardPreview,"before-upload":a.handleBeforeUpload,accept:"image/jpeg,image/jpg,image/png,image/gif,image/bmp,image/webp,.jpeg,.jpg,.png,.gif,.bmp,.webp"},{default:(0,l.k6)((()=>[(0,l.bF)(u,null,{default:(0,l.k6)((()=>[(0,l.bF)(k)])),_:1})])),_:1},8,["on-change","on-remove","file-list","on-preview","before-upload"])])),_:1}),(0,l.bF)(p,{label:"现场照片（收集后）",prop:"photo_path_after"},{default:(0,l.k6)((()=>[t[16]||(t[16]=(0,l.Lk)("div",{class:"photo-tip"},"请上传废物收集后的现场照片（最多5张）",-1)),(0,l.bF)(b,{class:"waste-photo-uploader",action:"#","auto-upload":!1,"on-change":a.handlePhotoAfterChange,"on-remove":a.handlePhotoAfterRemove,"file-list":a.fileListAfter,limit:5,multiple:"","list-type":"picture-card","on-preview":a.handlePictureCardPreview,"before-upload":a.handleBeforeUpload,accept:"image/jpeg,image/jpg,image/png,image/gif,image/bmp,image/webp,.jpeg,.jpg,.png,.gif,.bmp,.webp"},{default:(0,l.k6)((()=>[(0,l.bF)(u,null,{default:(0,l.k6)((()=>[(0,l.bF)(k)])),_:1})])),_:1},8,["on-change","on-remove","file-list","on-preview","before-upload"]),a.showViewer?((0,l.uX)(),(0,l.Wv)(y,{key:0,"url-list":a.previewImages,"initial-index":a.previewIndex,onClose:a.closeViewer},null,8,["url-list","initial-index","onClose"])):(0,l.Q3)("",!0)])),_:1}),(0,l.bF)(p,null,{default:(0,l.k6)((()=>[(0,l.bF)(_,{type:"primary",onClick:a.submitForm,loading:a.loading},{default:(0,l.k6)((()=>t[17]||(t[17]=[(0,l.eW)("保存")]))),_:1},8,["onClick","loading"]),(0,l.bF)(_,{onClick:a.goBack},{default:(0,l.k6)((()=>t[18]||(t[18]=[(0,l.eW)("取消")]))),_:1},8,["onClick"])])),_:1})])),_:1},8,["model","rules"])),[[L,a.loading]])]),(0,l.bF)(I,{modelValue:a.showUploadProgress,"onUpdate:modelValue":t[12]||(t[12]=e=>a.showUploadProgress=e),title:"正在上传文件",width:"30%","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},{default:(0,l.k6)((()=>[(0,l.Lk)("div",Ne,[t[19]||(t[19]=(0,l.Lk)("p",null,"正在上传文件，请勿关闭页面...",-1)),(0,l.bF)(x,{percentage:a.uploadPercentage,format:a.percentageFormat,status:100===a.uploadPercentage?"success":""},null,8,["percentage","format","status"]),(0,l.Lk)("p",He,(0,i.v_)(a.uploadStatus),1)])])),_:1},8,["modelValue"]),t[20]||(t[20]=(0,l.Lk)("div",{class:"footer"},[(0,l.Lk)("p",null,"© 2025 固体废物管理系统")],-1))])}var Je={name:"EditRecordView",components:{ArrowLeft:Q.nkM,Plus:Q.FWt,Clock:Q.zD7,ElImageViewer:ye.Tg},setup(){const e=(0,s.rd)(),t=(0,s.lq)(),o=(0,f.KR)(null),a=(0,f.KR)(!1),r=(0,f.KR)(!1),n=(0,f.KR)(""),i=(0,f.KR)([]),u=(0,f.KR)([]),d=(0,f.KR)([]),c=(0,f.KR)([]),p=(0,f.KR)([]),m=(0,f.KR)([]),h=(0,f.KR)([]),v=(0,f.KR)(!1),k=(0,f.KR)(0),b=(0,f.KR)(""),y=(0,f.KR)(!1),_=(0,f.KR)(0),F=(0,f.KR)("准备上传..."),x=(0,f.KR)(!1),I=(0,f.KR)(null),L=(0,f.KR)([]),R=(0,f.KR)(""),C=(0,f.KR)(""),W=["作业现场","清罐清理","报废清理","管线刺漏","历史遗留","日常维护","封井退出","其他"],V={"桓台":["金家接转站","金17-1注采站","金17-2注采站","金6金9项目组","金8注采站","其他"],"潍北":["潍北联合站","昌79注采站","昌3注采站","疃3注采站","昌15注采站","其他"],"高青":["高青联合站","樊107注采站","樊14注采站","高21注采站","高54注采站","其他"],"牛庄":["牛25集输站","牛25注采站","营13注采站","史112注采站","其他"],"金角":["长堤注采站","桩23注采站","其他"],"信远":["河125注采站","河122注采站","永551注采站","其他"],"滨博":["樊142注采站","樊142-2-12注采站","樊162注采站","樊页1井组","滨博接转站","其他"],"无棣":["车41注采站","车142注采站","车40注采站","车408注采站","车274注采站","车1接转站","东风港联合站","其他"],"河口":["沾14东注采站","沾14西注采站","渤南注采站","大北注采站","沾5注采站","太平接转站","沾5接转站","其他"],"胜兴":["博兴注采站","其他"],"其他":["其他"]},$=e=>{if(!e)return[];console.log("解析照片路径，原始值:",e,"类型:",typeof e);try{if(Array.isArray(e))return console.log("照片路径已经是数组:",e),e;if("string"===typeof e){if(e.startsWith("[")&&e.endsWith("]")){const t=JSON.parse(e);return console.log("照片路径解析为JSON数组:",t),t}if(e.includes(",")){const t=e.split(",").map((e=>e.trim())).filter((e=>e));return console.log("照片路径解析为逗号分隔字符串:",t),t}return console.log("照片路径解析为单个字符串:",[e]),[e]}return console.log("照片路径类型未知，尝试转换为字符串:",String(e)),[String(e)]}catch(t){return console.error("解析照片路径失败:",t),"string"===typeof e?[e]:[]}},T=(0,l.EW)((()=>!t.params.id||"new"===t.params.id)),U=(0,l.EW)((()=>fo.state.isLoggedIn&&(3===fo.state.user.role_id||4===fo.state.user.role_id))),P=(0,l.EW)((()=>fo.state.isLoggedIn&&4===fo.state.user.role_id)),S=(0,f.Kh)({unitId:"",wasteTypeId:"",location:"",collectionDate:"",collectionTime:"",quantity:void 0,recordId:null,creatorId:fo.state.user?.id||null,photo_path_before:"",photo_path_after:"",remarks:"",process:""}),E={unitId:[{required:!0,message:"请选择单位",trigger:"change"}],wasteTypeId:[{required:!0,message:"请选择废物类型",trigger:"change"}],process:[{required:!0,message:"请选择产生工序",trigger:"change"},{validator:(e,t,o)=>{"其他"!==t||C.value.trim()?o():o(new Error("请输入具体产生工序"))},trigger:"blur"}],location:[{required:!0,message:"请选择废物产生地点",trigger:"change"},{validator:(e,t,o)=>{"其他"!==t||R.value.trim()?o():o(new Error("请输入具体产生地点"))},trigger:"blur"}],collectionDate:[{required:!1}],collectionTime:[{required:!1}],quantity:[{required:!1,message:"请输入收集数量",trigger:"change"}]};(0,l.sV)((async()=>{a.value=!0;try{await Q(),U.value&&await K(),T.value?(!U.value&&fo.state.user&&(S.unitId=fo.state.user.unit_id,await A(S.unitId)),S.collectionDate=(new Date).toISOString().slice(0,10),S.collectionTime=(new Date).toTimeString().slice(0,5)):await X()}catch(e){console.error("初始化数据失败:",e),g.nk.error("加载数据失败，请刷新重试")}finally{a.value=!1}}));const K=async()=>{try{const e=await oo.get(w.endpoints.units);u.value=e.data}catch(e){console.error("获取单位列表失败:",e),g.nk.error("获取单位列表失败")}},A=async e=>{try{const t=await oo.get(w.endpoints.units),o=t.data.find((t=>t.id===parseInt(e)));o&&(n.value=o.name,V[n.value]?L.value=V[n.value]:(L.value=[],console.warn(`未找到管理区 "${n.value}" 的地点选项`)))}catch(t){console.error("获取单位信息失败:",t)}},Q=async()=>{try{const e=await oo.get(w.endpoints.wasteTypes);i.value=e.data}catch(e){console.error("获取废物类型失败:",e),g.nk.error("获取废物类型失败")}},X=async()=>{try{a.value=!0;const e=await oo.get(`${w.endpoints.wasteRecords}/detail/${t.params.id}`);I.value=e.data;const o=e.data;if(console.log("获取到的记录详情:",o),S.unitId=o.unit_id,S.wasteTypeId=o.waste_type_id,await A(S.unitId),o.process&&(W.includes(o.process)?S.process=o.process:(S.process="其他",C.value=o.process)),L.value.includes(o.location)?S.location=o.location:(S.location="其他",R.value=o.location),S.recordId=o.id,o.collection_start_time){const e=new Date(o.collection_start_time);S.collectionDate=e.toISOString().slice(0,10),S.collectionTime=e.toTimeString().slice(0,5)}if(S.quantity=o.quantity,S.remarks=o.remarks||"",console.log("设置备注字段:",o.remarks),o.photo_path_before){console.log("收集前照片路径:",o.photo_path_before);const e=$(o.photo_path_before);console.log("解析后的收集前照片路径:",e),d.value=e.map((e=>{let t=e;if(!e.startsWith("http")){const o=e.startsWith("/")?e.substring(1):e;t=`${window.location.origin}/${o}`}return console.log("收集前照片完整URL:",t),{name:e.split("/").pop(),url:t}}))}if(o.photo_path_after){console.log("收集后照片路径:",o.photo_path_after);const e=$(o.photo_path_after);console.log("解析后的收集后照片路径:",e),c.value=e.map((e=>{let t=e;if(!e.startsWith("http")){const o=e.startsWith("/")?e.substring(1):e;t=`${window.location.origin}/${o}`}return console.log("收集后照片完整URL:",t),{name:e.split("/").pop(),url:t}}))}n.value=o.unit_name,b.value=o.created_at,O([...d.value,...c.value])}catch(e){console.error("获取记录详情失败:",e),g.nk.error("获取记录详情失败")}finally{a.value=!1}},B=e=>{const t=["image/jpeg","image/jpg","image/png","image/gif","image/bmp","image/webp"],o=t.includes(e.type);if(!o)return g.nk.error("只能上传图片文件!"),!1;const a=52428800;return e.size>a?(g.nk.error("图片大小不能超过50MB!"),!1):new Promise((t=>{y.value=!0,F.value="正在处理图片...",_.value=0,console.log("开始处理图片:",e.name,"类型:",e.type,"大小:",(e.size/1024).toFixed(2),"KB"),new(q())(e,{quality:.6,maxWidth:1920,maxHeight:1920,mimeType:"image/jpeg",convertSize:0,beforeDraw(){_.value=30,F.value="正在处理图片...",console.log("图片处理中...")},drew(){_.value=60,F.value="正在压缩图片...",console.log("图片绘制完成")},success(o){const a=e.name.replace(/\.[^/.]+$/,"")+".jpg",l=new File([o],a,{type:"image/jpeg",lastModified:(new Date).getTime()});console.log("图片处理完成:"),console.log("- 原始大小:",(e.size/1024).toFixed(2),"KB"),console.log("- 处理后大小:",(l.size/1024).toFixed(2),"KB"),console.log("- 压缩率:",Math.round(100*(1-l.size/e.size)),"%"),console.log("- 处理后文件类型:",l.type),console.log("- 处理后文件名:",l.name),F.value="图片处理完成",_.value=100,setTimeout((()=>{y.value=!1}),500),t(l)},error(o){console.error("图片压缩失败:",o),F.value="处理失败，使用原始图片",_.value=100,setTimeout((()=>{y.value=!1}),500),t(e)}})}))},D=async(e,t)=>{if(console.log("收集前照片变更:",e),console.log("当前文件列表:",t),d.value=[...t],!e.processed){if(e.raw&&"ready"===e.status){y.value=!0,F.value="正在处理图片...",_.value=0,console.log("开始处理收集前照片:",e.name,"类型:",e.raw.type,"大小:",(e.raw.size/1024).toFixed(2),"KB");try{const t=await new Promise((t=>{new(q())(e.raw,{quality:.6,maxWidth:1920,maxHeight:1920,mimeType:"image/jpeg",convertSize:0,beforeDraw(){_.value=30,F.value="正在处理图片...",console.log("图片处理中...")},drew(){_.value=60,F.value="正在压缩图片...",console.log("图片绘制完成")},success(o){const a=e.raw.name.replace(/\.[^/.]+$/,"")+".jpg",l=new File([o],a,{type:"image/jpeg",lastModified:(new Date).getTime()});console.log("图片处理完成:"),console.log("- 原始大小:",(e.raw.size/1024).toFixed(2),"KB"),console.log("- 处理后大小:",(l.size/1024).toFixed(2),"KB"),console.log("- 压缩率:",Math.round(100*(1-l.size/e.raw.size)),"%"),console.log("- 处理后文件类型:",l.type),console.log("- 处理后文件名:",l.name),F.value="图片处理完成",_.value=100,t(l)},error(o){console.error("图片压缩失败:",o),F.value="处理失败，使用原始图片",_.value=100,t(e.raw)}})}));console.log("替换原始文件为处理后的文件:",t.name),e.processed=!0,e.raw=t;const o=p.value.findIndex((t=>t.uid===e.uid||t.name===e.name));o>=0?p.value[o]=t:p.value.push(t);const a=d.value.findIndex((t=>t.uid===e.uid));a>=0&&(d.value[a].processed=!0),setTimeout((()=>{y.value=!1}),500)}catch(o){console.error("处理图片时出错:",o),g.nk.warning("图片处理失败，将使用原始图片");const t=p.value.findIndex((t=>t.uid===e.uid||t.name===e.name));t>=0?p.value[t]=e.raw:p.value.push(e.raw),y.value=!1}}else!e.raw&&e.url&&console.log("已有文件，不需要处理:",e.name);return Y(t),void 0===e.raw&&"ready"===e.status&&(e.raw=e.originFileObj||e,console.log("为收集前照片添加raw属性:",e.raw)),O([...d.value,...c.value]),console.log("更新后的fileListBefore:",d.value),console.log("更新后的photoFilesBefore:",p.value),!1}console.log("文件已处理过，跳过压缩:",e.name)},M=(e,t)=>{console.log("收集前照片移除:",e),d.value=t,Y([...d.value,...c.value])||(x.value=!1),O([...d.value,...c.value])},z=async(e,t)=>{if(console.log("收集后照片变更:",e),console.log("当前文件列表:",t),c.value=[...t],!e.processed){if(e.raw&&"ready"===e.status){y.value=!0,F.value="正在处理图片...",_.value=0,console.log("开始处理收集后照片:",e.name,"类型:",e.raw.type,"大小:",(e.raw.size/1024).toFixed(2),"KB");try{const t=await new Promise((t=>{new(q())(e.raw,{quality:.6,maxWidth:1920,maxHeight:1920,mimeType:"image/jpeg",convertSize:0,beforeDraw(){_.value=30,F.value="正在处理图片...",console.log("图片处理中...")},drew(){_.value=60,F.value="正在压缩图片...",console.log("图片绘制完成")},success(o){const a=e.raw.name.replace(/\.[^/.]+$/,"")+".jpg",l=new File([o],a,{type:"image/jpeg",lastModified:(new Date).getTime()});console.log("图片处理完成:"),console.log("- 原始大小:",(e.raw.size/1024).toFixed(2),"KB"),console.log("- 处理后大小:",(l.size/1024).toFixed(2),"KB"),console.log("- 压缩率:",Math.round(100*(1-l.size/e.raw.size)),"%"),console.log("- 处理后文件类型:",l.type),console.log("- 处理后文件名:",l.name),F.value="图片处理完成",_.value=100,t(l)},error(o){console.error("图片压缩失败:",o),F.value="处理失败，使用原始图片",_.value=100,t(e.raw)}})}));console.log("替换原始文件为处理后的文件:",t.name),e.processed=!0,e.raw=t;const o=m.value.findIndex((t=>t.uid===e.uid||t.name===e.name));o>=0?m.value[o]=t:m.value.push(t);const a=c.value.findIndex((t=>t.uid===e.uid));a>=0&&(c.value[a].processed=!0),setTimeout((()=>{y.value=!1}),500)}catch(o){console.error("处理图片时出错:",o),g.nk.warning("图片处理失败，将使用原始图片");const t=m.value.findIndex((t=>t.uid===e.uid||t.name===e.name));t>=0?m.value[t]=e.raw:m.value.push(e.raw),y.value=!1}}else!e.raw&&e.url&&console.log("已有文件，不需要处理:",e.name);return Y(t),void 0===e.raw&&"ready"===e.status&&(e.raw=e.originFileObj||e,console.log("为收集后照片添加raw属性:",e.raw)),O([...d.value,...c.value]),console.log("更新后的fileListAfter:",c.value),console.log("更新后的photoFilesAfter:",m.value),!1}console.log("文件已处理过，跳过压缩:",e.name)},j=(e,t)=>{console.log("收集后照片移除:",e),c.value=t,Y([...d.value,...c.value])||(x.value=!1),O([...d.value,...c.value])},O=e=>{h.value=e.map((e=>e.url?(console.log("预览图片URL:",e.url),e.url):e.raw?(e._blobUrl||(e._blobUrl=URL.createObjectURL(e.raw)),console.log("预览图片从raw创建:",e._blobUrl),e._blobUrl):e instanceof File?(e._blobUrl||(e._blobUrl=URL.createObjectURL(e)),console.log("预览图片从File创建:",e._blobUrl),e._blobUrl):"")).filter((e=>e)),console.log("预览图片列表:",h.value)},N=e=>{console.log("预览图片:",e),O([...d.value,...c.value]);const t=h.value.findIndex((t=>{if(e.url)return t===e.url;if(e.raw){const o=URL.createObjectURL(e.raw),a=t===o;return URL.revokeObjectURL(o),a}return!1}));k.value=-1!==t?t:0,v.value=!0},H=()=>{v.value=!1},Y=e=>{const t=2097152;return e.some((e=>e.size>t))},J=e=>{if(e.total){const t=Math.round(100*e.loaded/e.total);_.value=t,F.value=t<33?"正在上传文件...":t<66?"正在处理文件...":t<100?"即将完成...":"上传完成，正在保存..."}},G=e=>100===e?"完成":`${e}%`,Z=async()=>{o.value&&await o.value.validate((async e=>{if(!e)return console.log("表单验证失败"),g.nk.error("请填写所有必填字段"),!1;_.value=0,F.value="正在上传文件...",y.value=!0;try{const e=new FormData;if(e.append("unitId",S.unitId),e.append("wasteTypeId",S.wasteTypeId),"其他"===S.process&&C.value.trim()?e.append("process",C.value.trim()):e.append("process",S.process),"其他"===S.location&&R.value.trim()?e.append("location",R.value.trim()):e.append("location",S.location),e.append("collectionDate",S.collectionDate),e.append("collectionTime",S.collectionTime),void 0!==S.quantity&&null!==S.quantity&&""!==S.quantity&&e.append("quantity",S.quantity),e.append("remarks",S.remarks||""),d.value.length>0){const t=d.value.filter((e=>e.raw)),o=d.value.filter((e=>!e.raw));if(t.length>0){if(console.log("有新上传的收集前照片，需要合并现有照片"),t.forEach((t=>{t.raw&&(console.log("添加新的收集前照片:",t.raw.name),e.append("photo_before",t.raw))})),o.length>0){const t=o.map((e=>{let t=e.url;const o=window.location.origin;return t.startsWith(o)&&(t=t.substring(o.length),t.startsWith("/")||(t="/"+t)),t}));console.log("保存现有收集前照片路径:",t),e.append("photo_path_before",JSON.stringify(t))}}else if(o.length>0){const t=o.map((e=>{let t=e.url;const o=window.location.origin;return t.startsWith(o)&&(t=t.substring(o.length),t.startsWith("/")||(t="/"+t)),t}));console.log("保存现有收集前照片路径(无新照片):",t),e.append("photo_path_before",JSON.stringify(t))}}else!T.value&&I.value&&I.value.photo_path_before&&(console.log("用户删除了所有收集前照片，发送NULL标记"),e.append("photo_path_before","NULL"));if(c.value.length>0){const t=c.value.filter((e=>e.raw)),o=c.value.filter((e=>!e.raw));if(t.length>0){if(console.log("有新上传的收集后照片，需要合并现有照片"),t.forEach((t=>{t.raw&&(console.log("添加新的收集后照片:",t.raw.name),e.append("photo_after",t.raw))})),o.length>0){const t=o.map((e=>{let t=e.url;const o=window.location.origin;return t.startsWith(o)&&(t=t.substring(o.length),t.startsWith("/")||(t="/"+t)),t}));console.log("保存现有收集后照片路径:",t),e.append("photo_path_after",JSON.stringify(t))}}else if(o.length>0){const t=o.map((e=>{let t=e.url;const o=window.location.origin;return t.startsWith(o)&&(t=t.substring(o.length),t.startsWith("/")||(t="/"+t)),t}));console.log("保存现有收集后照片路径(无新照片):",t),e.append("photo_path_after",JSON.stringify(t))}}else!T.value&&I.value&&I.value.photo_path_after&&(console.log("用户删除了所有收集后照片，发送NULL标记"),e.append("photo_path_after","NULL"));console.log("FormData内容:");for(let[t,o]of e.entries())o instanceof File?console.log(`${t}: File - ${o.name} (${o.type}, ${o.size} bytes)`):console.log(`${t}: ${o}`);S.recordId?(await oo.putForm(`${w.endpoints.wasteRecords}/${S.recordId}`,e,J),g.nk.success("废物记录更新成功")):(await oo.postForm(w.endpoints.wasteRecords,e,J),g.nk.success("废物记录添加成功")),y.value=!1,ee()}catch(t){console.error("提交表单失败:",t),t.response&&t.response.data?(console.error("服务器返回错误:",t.response.data),g.nk.error(`提交表单失败: ${t.response.data.error||"未知错误"}`)):g.nk.error("提交表单失败，请检查网络连接"),y.value=!1}}))},ee=()=>{U.value?e.push("/admin-records"):e.push({name:"RecordsList",params:{unitId:fo.state.user.unit_id}})};return(0,l.wB)((()=>S.unitId),(async e=>{e?await A(e):(L.value=[],n.value="")})),{form:S,rules:E,recordForm:o,loading:a,submitting:r,unitName:n,wasteTypes:i,units:u,fileListBefore:d,fileListAfter:c,photoFilesBefore:p,photoFilesAfter:m,previewImages:h,showViewer:v,previewIndex:k,isNew:T,isAdmin:U,isSupervisor:P,parsePhotoPath:$,handlePhotoBeforeChange:D,handlePhotoBeforeRemove:M,handlePhotoAfterChange:z,handlePhotoAfterRemove:j,handlePictureCardPreview:N,handleBeforeUpload:B,closeViewer:H,submitForm:Z,goBack:ee,showUploadProgress:y,uploadPercentage:_,uploadStatus:F,percentageFormat:G,showLargeFileWarning:x,record:I,locationOptions:L,locationMap:V,customLocation:R,customProcess:C,processOptions:W}}};const Ge=(0,I.A)(Je,[["render",Ye],["__scopeId","data-v-e5b1e94a"]]);var Ze=Ge;const et={class:"user-management-container"},tt={class:"header"},ot={class:"content"},at={class:"toolbar"},lt={class:"search-container"},rt={key:0,class:"password-hint"},nt={key:1,class:"password-hint"},st={class:"dialog-footer"};function it(e,t,o,a,r,n){const s=(0,l.g2)("arrow-left"),u=(0,l.g2)("el-icon"),d=(0,l.g2)("search"),c=(0,l.g2)("el-input"),p=(0,l.g2)("plus"),m=(0,l.g2)("el-button"),g=(0,l.g2)("el-table-column"),f=(0,l.g2)("el-tag"),h=(0,l.g2)("el-popconfirm"),v=(0,l.g2)("el-table"),w=(0,l.g2)("el-form-item"),k=(0,l.g2)("el-option"),b=(0,l.g2)("el-select"),y=(0,l.g2)("el-form"),_=(0,l.g2)("el-dialog"),F=(0,l.gN)("loading");return(0,l.uX)(),(0,l.CE)("div",et,[(0,l.Lk)("div",tt,[(0,l.Lk)("div",{class:"back-button",onClick:t[0]||(t[0]=(...e)=>a.goBack&&a.goBack(...e))},[(0,l.bF)(u,null,{default:(0,l.k6)((()=>[(0,l.bF)(s)])),_:1}),t[9]||(t[9]=(0,l.eW)(" 返回 "))]),t[10]||(t[10]=(0,l.Lk)("h1",null,"人员管理",-1)),t[11]||(t[11]=(0,l.Lk)("div",null,null,-1))]),(0,l.Lk)("div",ot,[(0,l.Lk)("div",at,[(0,l.Lk)("div",lt,[(0,l.bF)(c,{modelValue:a.searchKeyword,"onUpdate:modelValue":t[1]||(t[1]=e=>a.searchKeyword=e),placeholder:"请输入姓名关键字搜索",clearable:"",onClear:a.clearSearch,class:"search-input"},{prefix:(0,l.k6)((()=>[(0,l.bF)(u,null,{default:(0,l.k6)((()=>[(0,l.bF)(d)])),_:1})])),_:1},8,["modelValue","onClear"])]),(0,l.bF)(m,{type:"primary",onClick:a.openAddDialog},{default:(0,l.k6)((()=>[(0,l.bF)(u,null,{default:(0,l.k6)((()=>[(0,l.bF)(p)])),_:1}),t[12]||(t[12]=(0,l.eW)(" 添加用户 "))])),_:1},8,["onClick"])]),(0,l.bo)(((0,l.uX)(),(0,l.Wv)(v,{data:a.users,border:"",stripe:"",style:{width:"100%","margin-top":"20px"}},{default:(0,l.k6)((()=>[(0,l.bF)(g,{type:"index",label:"序号",width:"70",align:"center"}),(0,l.bF)(g,{prop:"username",label:"姓名",width:"120"}),(0,l.bF)(g,{prop:"phone",label:"手机号",width:"140"}),(0,l.bF)(g,{prop:"role_name",label:"角色",width:"120"}),(0,l.bF)(g,{prop:"unit_name",label:"单位","min-width":"120"}),(0,l.bF)(g,{label:"状态",width:"100",align:"center"},{default:(0,l.k6)((e=>[(0,l.bF)(f,{type:1===e.row.status?"success":"danger"},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(1===e.row.status?"正常":"已停用"),1)])),_:2},1032,["type"])])),_:1}),(0,l.bF)(g,{label:"操作",width:"240",fixed:"right"},{default:(0,l.k6)((e=>[a.isSuperAdmin||2!==e.row.role_id?((0,l.uX)(),(0,l.Wv)(m,{key:0,size:"small",onClick:t=>a.handleEdit(e.row)},{default:(0,l.k6)((()=>t[13]||(t[13]=[(0,l.eW)(" 编辑 ")]))),_:2},1032,["onClick"])):(0,l.Q3)("",!0),a.isSuperAdmin||2!==e.row.role_id?((0,l.uX)(),(0,l.Wv)(m,{key:1,size:"small",type:1===e.row.status?"warning":"success",onClick:t=>a.handleStatusChange(e.row)},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(1===e.row.status?"停用":"恢复"),1)])),_:2},1032,["type","onClick"])):(0,l.Q3)("",!0),a.isSuperAdmin||2!==e.row.role_id?((0,l.uX)(),(0,l.Wv)(h,{key:2,title:"确定要删除此用户吗？",onConfirm:t=>a.handleDelete(e.row)},{reference:(0,l.k6)((()=>[(0,l.bF)(m,{size:"small",type:"danger"},{default:(0,l.k6)((()=>t[14]||(t[14]=[(0,l.eW)("删除")]))),_:1})])),_:2},1032,["onConfirm"])):(0,l.Q3)("",!0)])),_:1})])),_:1},8,["data"])),[[F,a.loading]])]),(0,l.bF)(_,{modelValue:a.dialogVisible,"onUpdate:modelValue":t[8]||(t[8]=e=>a.dialogVisible=e),title:a.isEdit?"编辑用户":"添加用户",width:"500px"},{footer:(0,l.k6)((()=>[(0,l.Lk)("span",st,[(0,l.bF)(m,{onClick:t[7]||(t[7]=e=>a.dialogVisible=!1)},{default:(0,l.k6)((()=>t[15]||(t[15]=[(0,l.eW)("取消")]))),_:1}),(0,l.bF)(m,{type:"primary",onClick:a.submitForm,loading:a.formLoading},{default:(0,l.k6)((()=>t[16]||(t[16]=[(0,l.eW)(" 确认 ")]))),_:1},8,["onClick","loading"])])])),default:(0,l.k6)((()=>[(0,l.bF)(y,{ref:"userForm",model:a.form,rules:a.rules,"label-width":"100px",style:{"max-width":"400px",margin:"0 auto"}},{default:(0,l.k6)((()=>[(0,l.bF)(w,{label:"姓名",prop:"username"},{default:(0,l.k6)((()=>[(0,l.bF)(c,{modelValue:a.form.username,"onUpdate:modelValue":t[2]||(t[2]=e=>a.form.username=e),placeholder:"请输入姓名"},null,8,["modelValue"])])),_:1}),(0,l.bF)(w,{label:"手机号",prop:"phone"},{default:(0,l.k6)((()=>[(0,l.bF)(c,{modelValue:a.form.phone,"onUpdate:modelValue":t[3]||(t[3]=e=>a.form.phone=e),placeholder:"请输入手机号"},null,8,["modelValue"])])),_:1}),(0,l.bF)(w,{label:"角色",prop:"roleId"},{default:(0,l.k6)((()=>[(0,l.bF)(b,{modelValue:a.form.roleId,"onUpdate:modelValue":t[4]||(t[4]=e=>a.form.roleId=e),placeholder:"请选择角色",style:{width:"100%"}},{default:(0,l.k6)((()=>[a.isSuperAdmin?((0,l.uX)(),(0,l.Wv)(k,{key:0,value:3,label:"超级管理员"})):(0,l.Q3)("",!0),a.isSuperAdmin?((0,l.uX)(),(0,l.Wv)(k,{key:1,value:4,label:"监督人员"})):(0,l.Q3)("",!0),(0,l.bF)(k,{value:2,label:"单位管理员"}),(0,l.bF)(k,{value:1,label:"基层员工"})])),_:1},8,["modelValue"])])),_:1}),3!==a.form.roleId&&4!==a.form.roleId?((0,l.uX)(),(0,l.Wv)(w,{key:0,label:"单位",prop:"unitId"},{default:(0,l.k6)((()=>[(0,l.bF)(b,{modelValue:a.form.unitId,"onUpdate:modelValue":t[5]||(t[5]=e=>a.form.unitId=e),placeholder:"请选择单位",style:{width:"100%"},disabled:!a.isSuperAdmin&&a.isEdit},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(a.units,(e=>((0,l.uX)(),(0,l.Wv)(k,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue","disabled"])])),_:1})):(0,l.Q3)("",!0),(0,l.bF)(w,{label:"密码",prop:a.isEdit?"":"password"},{default:(0,l.k6)((()=>[(0,l.bF)(c,{modelValue:a.form.password,"onUpdate:modelValue":t[6]||(t[6]=e=>a.form.password=e),placeholder:"请输入密码",type:"password","show-password":""},null,8,["modelValue"]),a.isEdit?((0,l.uX)(),(0,l.CE)("div",nt,"不修改密码请留空")):((0,l.uX)(),(0,l.CE)("div",rt,"所有账号必须设置密码"))])),_:1},8,["prop"])])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),t[17]||(t[17]=(0,l.Lk)("div",{class:"footer"},[(0,l.Lk)("p",null,"© 2025 固体废物管理系统")],-1))])}var ut={name:"UserManagement",components:{ArrowLeft:Q.nkM,Plus:Q.FWt,Search:Q.vji},setup(){const e=(0,s.rd)(),t=(0,f.KR)(!1),o=(0,f.KR)(!1),a=(0,f.KR)(!1),r=(0,f.KR)(!1),n=(0,f.KR)(null),i=(0,f.KR)([]),u=(0,f.KR)([]),d=(0,f.KR)(""),c=(0,f.KR)([]),p=(0,l.EW)((()=>fo.state.isLoggedIn&&(3===fo.state.user.role_id||4===fo.state.user.role_id))),m=(0,l.EW)((()=>fo.state.isLoggedIn?fo.state.user.unit_id:null)),h=(0,f.Kh)({id:null,username:"",phone:"",roleId:1,unitId:null,password:""}),v={username:[{required:!0,message:"请输入姓名",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入有效的手机号码",trigger:"blur"}],roleId:[{required:!0,message:"请选择角色",trigger:"change"}],unitId:[{required:function(){return 3!==h.roleId&&4!==h.roleId},message:"请选择单位",trigger:"change"}],password:[{required:function(){return!r.value},message:"请输入密码",trigger:"blur"},{validator:(e,t,o)=>{t&&t.length>0?t.length<1||t.length>20?o(new Error("长度在 1 到 20 个字符")):o():r.value?o():o(new Error("请输入密码"))},trigger:"blur"}]},k=async()=>{t.value=!0;try{let e;e=p.value?await oo.get(w.endpoints.users):await oo.get(`${w.endpoints.units}/${m.value}/users`),i.value=e.data,c.value=e.data}catch(e){console.error("Error fetching users:",e),g.nk.error("获取用户列表失败")}finally{t.value=!1}},b=async()=>{try{const e=await oo.get(w.endpoints.units);u.value=e.data}catch(e){console.error("Error fetching units:",e),g.nk.error("获取单位列表失败")}},y=()=>{r.value=!1,I(),a.value=!0,p.value||(h.unitId=m.value)},_=e=>{r.value=!0,h.id=e.id,h.username=e.username,h.phone=e.phone,h.roleId=e.role_id,h.unitId=e.unit_id,h.password="",a.value=!0},F=async e=>{try{await oo.delete(`${w.endpoints.users}/${e.id}`),g.nk.success("用户删除成功"),k()}catch(t){console.error("Error deleting user:",t);let e="删除用户失败";t.response&&t.response.data&&t.response.data.error&&(e=t.response.data.error),g.nk.error(e)}},x=async e=>{const t=1===e.status?0:1,o=1===t?"恢复":"停用";try{await oo.put(`${w.endpoints.users}/${e.id}/status`,{status:t}),g.nk.success(`用户${o}成功`),k()}catch(a){console.error("状态变更失败:",a);let e=`${o}用户失败`;a.response&&a.response.data&&a.response.data.error&&(e=a.response.data.error),g.nk.error(e)}},I=()=>{n.value&&n.value.resetFields(),h.id=null,h.username="",h.phone="",h.roleId=1,h.unitId=null,h.password=""},L=()=>{n.value.validate((async e=>{if(e){o.value=!0;try{const e={username:h.username,phone:h.phone,roleId:h.roleId,unitId:3!==h.roleId?h.unitId:null};h.password&&(e.password=h.password),r.value?(await oo.put(`${w.endpoints.users}/${h.id}`,e),g.nk.success("用户更新成功")):(await oo.post(w.endpoints.users,e),g.nk.success("用户添加成功")),a.value=!1,k()}catch(t){console.error("Error submitting user form:",t);let e=r.value?"更新用户失败":"添加用户失败";t.response&&t.response.data&&t.response.data.error&&(e=t.response.data.error),g.nk.error(e)}finally{o.value=!1}}else g.nk.warning("请完成必填项")}))},R=()=>{e.back()},C=()=>{if(d.value.trim()){const e=d.value.toLowerCase();i.value=c.value.filter((t=>t.username.toLowerCase().includes(e)))}else i.value=c.value},W=()=>{d.value="",C()};return(0,l.sV)((()=>{k(),b()})),(0,l.wB)(d,(()=>{C()})),{loading:t,formLoading:o,dialogVisible:a,isEdit:r,userForm:n,users:i,units:u,form:h,rules:v,isSuperAdmin:p,currentUnitId:m,openAddDialog:y,handleEdit:_,handleDelete:F,handleStatusChange:x,submitForm:L,goBack:R,searchKeyword:d,filterUsers:C,clearSearch:W}}};const dt=(0,I.A)(ut,[["render",it],["__scopeId","data-v-35edc7f7"]]);var ct=dt;const pt={class:"admin-records-container"},mt={class:"content"},gt={class:"actions"},ft={class:"filter-header"},ht={class:"filter-form-container"},vt={class:"quantity-range"},wt={class:"input-with-clear"},kt={class:"input-with-clear"},bt={class:"filter-actions"},yt={class:"records-wrapper"},_t={class:"card-header"},Ft={class:"card-actions"},xt={class:"table-wrapper",ref:"tableContainer"},It={key:0,class:"photo-preview"},Lt=["onClick"],Rt={key:0,class:"photo-count"},Ct={key:1},Wt={key:0,class:"photo-preview"},Vt=["onClick"],$t={key:0,class:"photo-count"},Tt={key:1},Ut={class:"operation-buttons"},Pt={key:0,class:"loading-row"},St={key:1,class:"load-more-row"},Et={key:2,class:"no-more-row"},Kt={key:0,class:"empty-block"};function At(e,t,o,r,n,s){const u=(0,l.g2)("plus"),d=(0,l.g2)("el-icon"),c=(0,l.g2)("el-button"),p=(0,l.g2)("user"),m=(0,l.g2)("refresh"),g=(0,l.g2)("arrow-down"),f=(0,l.g2)("arrow-up"),h=(0,l.g2)("el-option"),v=(0,l.g2)("el-select"),w=(0,l.g2)("el-form-item"),k=(0,l.g2)("el-col"),b=(0,l.g2)("el-input"),y=(0,l.g2)("el-switch"),_=(0,l.g2)("el-row"),F=(0,l.g2)("el-date-picker"),x=(0,l.g2)("el-input-number"),I=(0,l.g2)("CircleClose"),L=(0,l.g2)("el-form"),R=(0,l.g2)("el-card"),C=(0,l.g2)("download"),W=(0,l.g2)("el-table-column"),V=(0,l.g2)("el-image"),$=(0,l.g2)("loading"),T=(0,l.g2)("el-table"),U=(0,l.g2)("el-empty"),P=(0,l.g2)("el-image-viewer"),S=(0,l.gN)("loading");return(0,l.uX)(),(0,l.CE)("div",pt,[t[26]||(t[26]=(0,l.Lk)("div",{class:"header"},[(0,l.Lk)("h1",null,"固体废物管理系统历史记录")],-1)),(0,l.Lk)("div",mt,[(0,l.Lk)("div",gt,[(0,l.bF)(c,{type:"primary",onClick:r.addNewRecord},{default:(0,l.k6)((()=>[(0,l.bF)(d,null,{default:(0,l.k6)((()=>[(0,l.bF)(u)])),_:1}),t[11]||(t[11]=(0,l.eW)(" 新增填报 "))])),_:1},8,["onClick"]),r.isSuperAdmin?((0,l.uX)(),(0,l.Wv)(c,{key:0,type:"success",onClick:r.goToUserManagement},{default:(0,l.k6)((()=>[(0,l.bF)(d,null,{default:(0,l.k6)((()=>[(0,l.bF)(p)])),_:1}),t[12]||(t[12]=(0,l.eW)(" 人员管理 "))])),_:1},8,["onClick"])):(0,l.Q3)("",!0),(0,l.bF)(c,{onClick:r.refreshRecords},{default:(0,l.k6)((()=>[(0,l.bF)(d,null,{default:(0,l.k6)((()=>[(0,l.bF)(m)])),_:1}),t[13]||(t[13]=(0,l.eW)(" 刷新 "))])),_:1},8,["onClick"])]),(0,l.bF)(R,{class:"filter-card"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",ft,[t[14]||(t[14]=(0,l.Lk)("h3",null,"筛选条件",-1)),(0,l.bF)(c,{type:"primary",link:"",onClick:t[0]||(t[0]=e=>r.showFilterPanel=!r.showFilterPanel)},{default:(0,l.k6)((()=>[(0,l.eW)((0,i.v_)(r.showFilterPanel?"收起":"展开")+" ",1),r.showFilterPanel?((0,l.uX)(),(0,l.Wv)(d,{key:1},{default:(0,l.k6)((()=>[(0,l.bF)(f)])),_:1})):((0,l.uX)(),(0,l.Wv)(d,{key:0},{default:(0,l.k6)((()=>[(0,l.bF)(g)])),_:1}))])),_:1})]),(0,l.bo)((0,l.Lk)("div",ht,[(0,l.bF)(L,{model:r.filterForm,"label-width":"100px",class:"filter-form"},{default:(0,l.k6)((()=>[(0,l.bF)(_,{gutter:20},{default:(0,l.k6)((()=>[(0,l.bF)(k,{xs:24,sm:12,md:5,lg:5,xl:5},{default:(0,l.k6)((()=>[(0,l.bF)(w,{label:"所属单位"},{default:(0,l.k6)((()=>[(0,l.bF)(v,{modelValue:r.filterForm.unitId,"onUpdate:modelValue":t[1]||(t[1]=e=>r.filterForm.unitId=e),placeholder:"选择单位",style:{width:"100%"},clearable:""},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.units,(e=>((0,l.uX)(),(0,l.Wv)(h,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),(0,l.bF)(k,{xs:24,sm:12,md:5,lg:5,xl:5},{default:(0,l.k6)((()=>[(0,l.bF)(w,{label:"废物类型"},{default:(0,l.k6)((()=>[(0,l.bF)(v,{modelValue:r.filterForm.wasteTypeId,"onUpdate:modelValue":t[2]||(t[2]=e=>r.filterForm.wasteTypeId=e),placeholder:"选择废物类型",style:{width:"100%"},clearable:""},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.wasteTypes,(e=>((0,l.uX)(),(0,l.Wv)(h,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),(0,l.bF)(k,{xs:24,sm:12,md:5,lg:5,xl:5},{default:(0,l.k6)((()=>[(0,l.bF)(w,{label:"产生地点"},{default:(0,l.k6)((()=>[(0,l.bF)(b,{modelValue:r.filterForm.location,"onUpdate:modelValue":t[3]||(t[3]=e=>r.filterForm.location=e),placeholder:"输入地点关键词搜索",clearable:""},null,8,["modelValue"])])),_:1})])),_:1}),(0,l.bF)(k,{xs:24,sm:12,md:5,lg:5,xl:5},{default:(0,l.k6)((()=>[(0,l.bF)(w,{label:"产生工序"},{default:(0,l.k6)((()=>[(0,l.bF)(b,{modelValue:r.filterForm.process,"onUpdate:modelValue":t[4]||(t[4]=e=>r.filterForm.process=e),placeholder:"输入工序关键词搜索",clearable:""},null,8,["modelValue"])])),_:1})])),_:1}),r.isSuperAdmin?((0,l.uX)(),(0,l.Wv)(k,{key:0,xs:24,sm:12,md:4,lg:4,xl:4},{default:(0,l.k6)((()=>[(0,l.bF)(w,{label:"监督数据"},{default:(0,l.k6)((()=>[(0,l.bF)(y,{modelValue:r.filterForm.showSupervised,"onUpdate:modelValue":t[5]||(t[5]=e=>r.filterForm.showSupervised=e),"active-text":"显示","inactive-text":"隐藏","active-color":"#13ce66","inactive-color":"#ff4949","active-value":!0,"inactive-value":!1,style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1})):(0,l.Q3)("",!0)])),_:1}),(0,l.bF)(_,{gutter:20},{default:(0,l.k6)((()=>[(0,l.bF)(k,{xs:24,sm:24,md:10,lg:10,xl:10},{default:(0,l.k6)((()=>[(0,l.bF)(w,{label:"收集时间"},{default:(0,l.k6)((()=>[(0,l.bF)(F,{modelValue:r.filterForm.dateRange,"onUpdate:modelValue":t[6]||(t[6]=e=>r.filterForm.dateRange=e),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])])),_:1})])),_:1}),(0,l.bF)(k,{xs:24,sm:24,md:8,lg:8,xl:8},{default:(0,l.k6)((()=>[(0,l.bF)(w,{label:"数量范围(吨)"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",vt,[(0,l.Lk)("div",wt,[(0,l.bF)(x,{modelValue:r.filterForm.minQuantity,"onUpdate:modelValue":t[7]||(t[7]=e=>r.filterForm.minQuantity=e),min:0,precision:3,step:.001,placeholder:"最小值",style:{width:"100%"}},null,8,["modelValue"]),null!==r.filterForm.minQuantity?((0,l.uX)(),(0,l.Wv)(d,{key:0,class:"clear-icon",onClick:t[8]||(t[8]=e=>r.filterForm.minQuantity=null)},{default:(0,l.k6)((()=>[(0,l.bF)(I)])),_:1})):(0,l.Q3)("",!0)]),t[15]||(t[15]=(0,l.Lk)("span",{class:"range-separator"},"至",-1)),(0,l.Lk)("div",kt,[(0,l.bF)(x,{modelValue:r.filterForm.maxQuantity,"onUpdate:modelValue":t[9]||(t[9]=e=>r.filterForm.maxQuantity=e),min:r.filterForm.minQuantity||0,precision:3,step:.001,placeholder:"最大值",style:{width:"100%"}},null,8,["modelValue","min"]),null!==r.filterForm.maxQuantity?((0,l.uX)(),(0,l.Wv)(d,{key:0,class:"clear-icon",onClick:t[10]||(t[10]=e=>r.filterForm.maxQuantity=null)},{default:(0,l.k6)((()=>[(0,l.bF)(I)])),_:1})):(0,l.Q3)("",!0)])])])),_:1})])),_:1}),(0,l.bF)(k,{xs:24,sm:24,md:6,lg:6,xl:6,class:"filter-buttons-col"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",bt,[(0,l.bF)(c,{type:"primary",onClick:r.applyFilter},{default:(0,l.k6)((()=>t[16]||(t[16]=[(0,l.eW)("刷新筛选")]))),_:1},8,["onClick"]),(0,l.bF)(c,{onClick:r.resetFilter},{default:(0,l.k6)((()=>t[17]||(t[17]=[(0,l.eW)("重置")]))),_:1},8,["onClick"])])])),_:1})])),_:1})])),_:1},8,["model"])],512),[[a.aG,r.showFilterPanel]])])),_:1}),(0,l.Lk)("div",yt,[(0,l.bF)(R,{class:"records-card"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",_t,[t[21]||(t[21]=(0,l.Lk)("h3",{class:"table-title"},"所有废物记录",-1)),(0,l.Lk)("div",Ft,[(0,l.bF)(c,{type:"warning",onClick:r.exportWithoutImages,loading:r.loading},{default:(0,l.k6)((()=>[(0,l.bF)(d,null,{default:(0,l.k6)((()=>[(0,l.bF)(C)])),_:1}),t[18]||(t[18]=(0,l.eW)(" 无照片 "))])),_:1},8,["onClick","loading"]),(0,l.bF)(c,{type:"warning",onClick:r.exportWithImages,loading:r.loading},{default:(0,l.k6)((()=>[(0,l.bF)(d,null,{default:(0,l.k6)((()=>[(0,l.bF)(C)])),_:1}),t[19]||(t[19]=(0,l.eW)(" 包含首张照片 "))])),_:1},8,["onClick","loading"]),(0,l.bF)(c,{type:"warning",onClick:r.exportWithAllImages,loading:r.loading},{default:(0,l.k6)((()=>[(0,l.bF)(d,null,{default:(0,l.k6)((()=>[(0,l.bF)(C)])),_:1}),t[20]||(t[20]=(0,l.eW)(" 包含全部照片 "))])),_:1},8,["onClick","loading"])])]),(0,l.Lk)("div",xt,[(0,l.bo)(((0,l.uX)(),(0,l.Wv)(T,{ref:"tableRef",data:r.filteredRecords,style:{width:"100%"},border:"",stripe:"",class:"responsive-table",height:r.tableHeight},{append:(0,l.k6)((()=>[r.loadingMore?((0,l.uX)(),(0,l.CE)("div",Pt,[(0,l.bF)(d,{class:"loading"},{default:(0,l.k6)((()=>[(0,l.bF)($)])),_:1}),t[24]||(t[24]=(0,l.eW)(" 正在加载... "))])):r.hasMore&&r.records.length>0?((0,l.uX)(),(0,l.CE)("div",St,[(0,l.bF)(c,{type:"primary",onClick:r.loadMore,disabled:r.loadingMore,size:"small"},{default:(0,l.k6)((()=>[t[25]||(t[25]=(0,l.eW)(" 点击加载更多 ")),(0,l.bF)(d,null,{default:(0,l.k6)((()=>[(0,l.bF)(g)])),_:1})])),_:1},8,["onClick","disabled"])])):r.records.length>0?((0,l.uX)(),(0,l.CE)("div",Et," 已全部加载 ")):(0,l.Q3)("",!0)])),default:(0,l.k6)((()=>[(0,l.bF)(W,{type:"index",label:"序号",width:"70",align:"center",index:r.indexMethod},null,8,["index"]),(0,l.bF)(W,{prop:"unit_name",label:"单位","min-width":"100"}),(0,l.bF)(W,{prop:"waste_type_name",label:"废物类型","min-width":"100"}),(0,l.bF)(W,{prop:"location",label:"产生地点","min-width":"100"}),(0,l.bF)(W,{prop:"process",label:"产生工序","min-width":"100"},{default:(0,l.k6)((e=>[(0,l.eW)((0,i.v_)(e.row.process||"无"),1)])),_:1}),(0,l.bF)(W,{prop:"remarks",label:"备注","min-width":"120"},{default:(0,l.k6)((e=>[(0,l.eW)((0,i.v_)(e.row.remarks||"无"),1)])),_:1}),(0,l.bF)(W,{prop:"collection_start_time",label:"收集开始时间","min-width":"160"}),(0,l.bF)(W,{label:"数量(吨)","min-width":"100"},{default:(0,l.k6)((e=>[(0,l.eW)((0,i.v_)(null!==e.row.quantity&&void 0!==e.row.quantity?parseFloat(e.row.quantity).toFixed(3):""),1)])),_:1}),(0,l.bF)(W,{prop:"creator_name",label:"填报人","min-width":"100"}),(0,l.bF)(W,{prop:"created_at",label:"记录时间","min-width":"160"}),(0,l.bF)(W,{label:"清理前照片","min-width":"140",align:"center"},{default:(0,l.k6)((e=>[e.row.photo_path_before?((0,l.uX)(),(0,l.CE)("div",It,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.parsePhotoPath(e.row.photo_path_before),((t,o)=>((0,l.uX)(),(0,l.CE)("div",{key:o,class:"photo-thumbnail-container",onClick:t=>r.previewPhoto(r.parsePhotoPath(e.row.photo_path_before),o)},[(0,l.bF)(V,{style:{width:"50px",height:"50px",margin:"0 auto"},src:`${r.baseUrl}${t}`,fit:"cover"},null,8,["src"])],8,Lt)))),128)),r.parsePhotoPath(e.row.photo_path_before).length>1?((0,l.uX)(),(0,l.CE)("div",Rt,(0,i.v_)(r.parsePhotoPath(e.row.photo_path_before).length)+"张 ",1)):(0,l.Q3)("",!0)])):((0,l.uX)(),(0,l.CE)("span",Ct,"无"))])),_:1}),(0,l.bF)(W,{label:"清理后照片","min-width":"140",align:"center"},{default:(0,l.k6)((e=>[e.row.photo_path_after?((0,l.uX)(),(0,l.CE)("div",Wt,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.parsePhotoPath(e.row.photo_path_after),((t,o)=>((0,l.uX)(),(0,l.CE)("div",{key:o,class:"photo-thumbnail-container",onClick:t=>r.previewPhoto(r.parsePhotoPath(e.row.photo_path_after),o)},[(0,l.bF)(V,{style:{width:"50px",height:"50px",margin:"0 auto"},src:`${r.baseUrl}${t}`,fit:"cover"},null,8,["src"])],8,Vt)))),128)),r.parsePhotoPath(e.row.photo_path_after).length>1?((0,l.uX)(),(0,l.CE)("div",$t,(0,i.v_)(r.parsePhotoPath(e.row.photo_path_after).length)+"张 ",1)):(0,l.Q3)("",!0)])):((0,l.uX)(),(0,l.CE)("span",Tt,"无"))])),_:1}),(0,l.bF)(W,{label:"操作","min-width":"130"},{default:(0,l.k6)((e=>[(0,l.Lk)("div",Ut,[(0,l.bF)(c,{type:"primary",size:"small",onClick:t=>r.editRecord(e.row.id),text:""},{default:(0,l.k6)((()=>t[22]||(t[22]=[(0,l.eW)(" 编辑 ")]))),_:2},1032,["onClick"]),(0,l.bF)(c,{type:"danger",size:"small",onClick:t=>r.confirmDelete(e.row),text:""},{default:(0,l.k6)((()=>t[23]||(t[23]=[(0,l.eW)(" 删除 ")]))),_:2},1032,["onClick"])])])),_:1})])),_:1},8,["data","height"])),[[S,r.loading]])],512),0!==r.records.length||r.loading?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",Kt,[(0,l.bF)(U,{description:"暂无废物记录"})]))])),_:1})])]),r.showViewer?((0,l.uX)(),(0,l.Wv)(P,{key:0,"url-list":r.previewImages,"initial-index":r.previewIndex,onClose:r.closeViewer},null,8,["url-list","initial-index","onClose"])):(0,l.Q3)("",!0)])}const Qt=e=>{if(!e)return[];try{return e.startsWith("[")&&e.endsWith("]")?JSON.parse(e):[e]}catch(t){return console.error("解析照片路径失败:",t),[e]}},Xt=(e,t)=>{if(!e.photos)return[];try{const o=JSON.parse(e.photos);return Array.isArray(o)?o.filter((e=>e.type===t)):[]}catch(o){return console.error("解析照片JSON失败:",o),[]}};var qt={name:"AdminRecordsView",components:{Plus:Q.FWt,Refresh:Q.C42,User:Q.KJW,ArrowDown:Q.yd$,ArrowUp:Q.DoI,Download:Q.f5X,ElImageViewer:ye.Tg,Loading:Q.Rhj,CircleClose:Q.R$5},setup(){const e=(0,s.rd)(),t=(0,f.KR)([]),o=(0,f.KR)(!1),a=(0,f.KR)([]),r=(0,f.KR)([]),n=(0,f.KR)(!0),i=w.baseURL,u=(0,f.KR)(750),d=(0,f.KR)(null),c=()=>{const e=window.innerHeight,t=Math.min(Math.max(.85*e,650),900);u.value=t,console.log("设置表格高度:",t)},p=()=>{c()},m=(0,f.KR)(!1),v=(0,f.KR)([]),k=(0,f.KR)(0),b=(0,f.KR)(1),y=(0,f.KR)(1),_=(0,f.KR)(20),F=(0,f.KR)(!0),x=(0,f.KR)(!1),I=(0,f.KR)(null),L=(0,f.Kh)({unitId:null,dateRange:null,wasteTypeId:null,minQuantity:null,maxQuantity:null,location:"",process:"",showSupervised:!0}),R=(0,f.KR)(null);(0,l.wB)([()=>L.unitId,()=>L.dateRange,()=>L.wasteTypeId,()=>L.minQuantity,()=>L.maxQuantity,()=>L.location,()=>L.process,()=>L.showSupervised],(()=>{R.value&&clearTimeout(R.value),R.value=setTimeout((()=>{b.value=1,T()}),300)}));const C=(0,l.EW)((()=>(console.log("开始本地筛选，记录数:",t.value.length),console.log("筛选条件:",{unitId:L.unitId,wasteTypeId:L.wasteTypeId,dateRange:L.dateRange,location:L.location,process:L.process,minQuantity:L.minQuantity,maxQuantity:L.maxQuantity}),t.value.filter((e=>{if(L.unitId&&parseInt(e.unit_id)!==parseInt(L.unitId))return console.log(`记录 ${e.id} 单位不匹配: ${e.unit_id} (${typeof e.unit_id}) !== ${L.unitId} (${typeof L.unitId})`),!1;if(L.wasteTypeId&&parseInt(e.waste_type_id)!==parseInt(L.wasteTypeId))return!1;if(null!==L.minQuantity&&""!==L.minQuantity&&null!==e.quantity&&void 0!==e.quantity&&parseFloat(e.quantity)<L.minQuantity)return!1;if(null!==L.maxQuantity&&""!==L.maxQuantity&&null!==e.quantity&&void 0!==e.quantity&&parseFloat(e.quantity)>L.maxQuantity)return!1;if(L.location&&!e.location.toLowerCase().includes(L.location.toLowerCase()))return!1;if(L.process&&!e.process?.toLowerCase().includes(L.process.toLowerCase()))return!1;if(L.dateRange&&2===L.dateRange.length){const t=new Date(L.dateRange[0]),o=new Date(L.dateRange[1]);if(o.setHours(23,59,59,999),!e.collection_start_time)return!1;{const a=W(e.collection_start_time);if(a<t||a>o)return!1}}return!0}))))),W=e=>{const t=e.replace(/[^0-9\-: ]/g,"");return new Date(t)};(0,l.sV)((async()=>{if(3!==fo.state.user.role_id&&4!==fo.state.user.role_id)return g.nk.error("权限不足"),void e.push("/login");await V(),await $(),T(),c(),window.addEventListener("resize",p)})),(0,l.hi)((()=>{window.removeEventListener("resize",p)}));const V=async()=>{try{const e=await h.A.get(w.getUrl(w.endpoints.units));a.value=e.data}catch(e){console.error("获取单位列表失败:",e),g.nk.error("获取单位列表失败")}},$=async()=>{try{const e=await h.A.get(w.getUrl(w.endpoints.wasteTypes));r.value=e.data}catch(e){console.error("获取废物类型列表失败:",e),g.nk.error("获取废物类型列表失败")}},T=async(e=!1)=>{console.log(`开始加载数据，是否加载更多: ${e}`),e?(x.value=!0,console.log(`加载更多: 当前page=${b.value}, currentPage=${y.value}`)):(o.value=!0,b.value=1,y.value=1,t.value=[],console.log("初始化加载: 重置页码和记录"));try{const o={page:b.value,pageSize:_.value,unitId:L.unitId?parseInt(L.unitId):void 0,wasteTypeId:L.wasteTypeId?parseInt(L.wasteTypeId):void 0,minQuantity:L.minQuantity,maxQuantity:L.maxQuantity,location:L.location,process:L.process,showSupervised:L.showSupervised?"true":"false"};console.log("发送请求参数:",o),console.log("单位筛选参数:",L.unitId),L.dateRange&&2===L.dateRange.length&&(o.dateRange=JSON.stringify(L.dateRange));const a=`${w.getUrl(w.endpoints.wasteRecords)}/user/${fo.state.user.id}`;console.log("请求URL:",a);const l=await h.A.get(a,{params:o});console.log("服务器返回数据:",{recordsCount:l.data.records.length,hasMore:l.data.hasMore});const r=l.data.records.map((e=>({...e,created_at:U(e.created_at),collection_start_time:U(e.collection_start_time)})));e?(t.value=[...t.value,...r],console.log(`追加${r.length}条记录，现在总共有${t.value.length}条记录`)):(t.value=r,console.log(`加载了${r.length}条新记录`)),F.value=l.data.hasMore,console.log(`服务器是否有更多数据: ${F.value}`),F.value?(b.value++,console.log(`有更多数据，下一页将是: page=${b.value}`)):console.log("没有更多数据了")}catch(a){console.error("获取废物记录失败:",a),g.nk.error("获取废物记录失败")}finally{o.value=!1,x.value=!1,console.log(`加载完成，状态: loading=${o.value}, loadingMore=${x.value}`)}},U=e=>{if(!e)return"";const t=new Date(e);return t.toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1})},P=()=>{T()},S=()=>{3===fo.state.user.role_id||4===fo.state.user.role_id?e.push("/record/new"):e.push(`/unit/${fo.state.user.unit_id}`)},E=()=>{e.push("/user-management")},K=t=>{e.push(`/record/${t}`)},A=async()=>{await T(),g.nk.success("筛选已应用")},Q=async()=>{L.unitId=null,L.dateRange=null,L.wasteTypeId=null,L.minQuantity=null,L.maxQuantity=null,L.location="",L.process="",L.showSupervised=!0,await T(),g.nk.info("筛选条件已重置")},X=async()=>{try{(0,g.nk)({message:"导出大量包含图片的记录所需时间较长，请耐心等待",type:"info",duration:5e3});const e=Fe.Ks.service({lock:!0,text:"正在导出记录，请稍候...",background:"rgba(0, 0, 0, 0.7)"});o.value=!0;const t={wasteTypeId:L.wasteTypeId?parseInt(L.wasteTypeId):void 0,minQuantity:L.minQuantity?L.minQuantity:void 0,maxQuantity:L.maxQuantity?L.maxQuantity:void 0,location:L.location||void 0,process:L.process||void 0,dateRange:L.dateRange?JSON.stringify(L.dateRange):void 0,unitId:L.unitId?parseInt(L.unitId):void 0,showSupervised:L.showSupervised?"true":"false"};console.log("导出记录的筛选条件:",t);const{data:l}=await h.A.get(`${w.getUrl(w.endpoints.exportWasteRecords)}/${fo.state.user.id}`,{params:t});if(console.log(`从后端获取到 ${l.length} 条记录用于导出`),0===l.length)return e.close(),g.nk.warning("没有符合条件的记录可导出"),void(o.value=!1);e.setText(`准备导出 ${l.length} 条记录...`);const r=l.map((e=>{const t=Qt(e.photo_path_before),o=Qt(e.photo_path_after);return{"单位":e.unit_name,"废物类型":e.waste_type_name,"产生地点":e.location,"产生工序":e.process||"无","备注":e.remarks||"无","收集开始时间":U(e.collection_start_time),"数量(吨)":e.quantity,"填报人":e.creator_name||"系统","记录时间":U(e.created_at),"清理前照片":t.length>0?t[0]:"","清理后照片":o.length>0?o[0]:""}})),n=L.unitId?a.value.find((e=>e.id===L.unitId))?.name||"未知单位":"全部单位",s=`固体废物记录_${n}`,i=[{text:"单位",field:"单位"},{text:"废物类型",field:"废物类型"},{text:"产生地点",field:"产生地点"},{text:"产生工序",field:"产生工序"},{text:"备注",field:"备注"},{text:"收集开始时间",field:"收集开始时间"},{text:"数量(吨)",field:"数量(吨)"},{text:"填报人",field:"填报人"},{text:"记录时间",field:"记录时间"},{text:"清理前照片",field:"清理前照片",isImage:!0},{text:"清理后照片",field:"清理后照片",isImage:!0}],u=window.location.origin,d=(t,o)=>{const a=Math.round(t/o*100);e.setText(`正在导出：${a}% (${t}/${o})`)},c=await Ce(r,s,i,u,d);e.close(),c?g.nk.success("导出成功"):g.nk.error("导出失败，请重试")}catch(e){console.error("导出记录失败:",e),g.nk.error("导出失败: "+(e.message||"未知错误"))}finally{o.value=!1,Fe.Ks.service().close()}},q=async()=>{try{(0,g.nk)({message:"导出大量包含全部图片的记录所需时间较长，请耐心等待",type:"info",duration:5e3});const e=Fe.Ks.service({lock:!0,text:"正在导出记录，请稍候...",background:"rgba(0, 0, 0, 0.7)"});o.value=!0;const t={wasteTypeId:L.wasteTypeId?parseInt(L.wasteTypeId):void 0,minQuantity:L.minQuantity?L.minQuantity:void 0,maxQuantity:L.maxQuantity?L.maxQuantity:void 0,location:L.location||void 0,process:L.process||void 0,dateRange:L.dateRange?JSON.stringify(L.dateRange):void 0,unitId:L.unitId?parseInt(L.unitId):void 0,showSupervised:L.showSupervised?"true":"false"};console.log("导出记录的筛选条件:",t);const{data:l}=await h.A.get(`${w.getUrl(w.endpoints.exportWasteRecords)}/${fo.state.user.id}`,{params:t});if(console.log(`从后端获取到 ${l.length} 条记录用于导出`),0===l.length)return e.close(),g.nk.warning("没有符合条件的记录可导出"),void(o.value=!1);e.setText(`准备导出 ${l.length} 条记录的全部照片...`);const r=l.map((e=>{const t=Qt(e.photo_path_before),o=Qt(e.photo_path_after),a={"单位":e.unit_name,"废物类型":e.waste_type_name,"产生工序":e.process||"无","产生地点":e.location,"备注":e.remarks||"无","收集开始时间":U(e.collection_start_time),"数量(吨)":e.quantity,"填报人":e.creator_name||"系统","记录时间":U(e.created_at)};for(let l=0;l<5;l++)a[`清理前照片${l+1}`]=l<t.length?t[l]:"";for(let l=0;l<5;l++)a[`清理后照片${l+1}`]=l<o.length?o[l]:"";return a})),n=L.unitId?a.value.find((e=>e.id===L.unitId))?.name||"未知单位":"全部单位",s=`固体废物记录_全部照片_${n}`,i=[{text:"单位",field:"单位"},{text:"废物类型",field:"废物类型"},{text:"产生工序",field:"产生工序"},{text:"产生地点",field:"产生地点"},{text:"备注",field:"备注"},{text:"收集开始时间",field:"收集开始时间"},{text:"数量(吨)",field:"数量(吨)"},{text:"填报人",field:"填报人"},{text:"记录时间",field:"记录时间"}];for(let o=0;o<5;o++)i.push({text:`清理前照片${o+1}`,field:`清理前照片${o+1}`,isImage:!0});for(let o=0;o<5;o++)i.push({text:`清理后照片${o+1}`,field:`清理后照片${o+1}`,isImage:!0});const u=window.location.origin,d=(t,o)=>{const a=Math.round(t/o*100);e.setText(`正在导出全部照片：${a}% (${t}/${o})`)},c=await Ce(r,s,i,u,d);e.close(),c?g.nk.success("导出成功"):g.nk.error("导出失败，请重试")}catch(e){console.error("导出记录失败:",e),g.nk.error("导出失败: "+(e.message||"未知错误"))}finally{o.value=!1,Fe.Ks.service().close()}},B=async()=>{try{const e=Fe.Ks.service({lock:!0,text:"正在导出记录，请稍候...",background:"rgba(0, 0, 0, 0.7)"});o.value=!0;const t={wasteTypeId:L.wasteTypeId?parseInt(L.wasteTypeId):void 0,minQuantity:L.minQuantity?L.minQuantity:void 0,maxQuantity:L.maxQuantity?L.maxQuantity:void 0,location:L.location||void 0,process:L.process||void 0,dateRange:L.dateRange?JSON.stringify(L.dateRange):void 0,unitId:L.unitId?parseInt(L.unitId):void 0,showSupervised:L.showSupervised?"true":"false"},{data:l}=await h.A.get(`${w.getUrl(w.endpoints.exportWasteRecords)}/${fo.state.user.id}`,{params:t});if(0===l.length)return e.close(),g.nk.warning("没有符合条件的记录可导出"),void(o.value=!1);e.setText(`准备导出 ${l.length} 条记录...`);const r=l.map((e=>({"单位":e.unit_name,"废物类型":e.waste_type_name,"产生工序":e.process||"无","产生地点":e.location,"备注":e.remarks||"无","收集开始时间":U(e.collection_start_time),"数量(吨)":e.quantity,"填报人":e.creator_name||"系统","记录时间":U(e.created_at),"清理前照片":e.photo_path_before?"有":"无","清理后照片":e.photo_path_after?"有":"无"}))),n=L.unitId?a.value.find((e=>e.id===L.unitId))?.name||"未知单位":"全部单位",s=`固体废物记录_${n}`,i=[{text:"单位",field:"单位"},{text:"废物类型",field:"废物类型"},{text:"产生地点",field:"产生地点"},{text:"产生工序",field:"产生工序"},{text:"备注",field:"备注"},{text:"收集开始时间",field:"收集开始时间"},{text:"数量(吨)",field:"数量(吨)"},{text:"填报人",field:"填报人"},{text:"记录时间",field:"记录时间"},{text:"清理前照片",field:"清理前照片"},{text:"清理后照片",field:"清理后照片"}],u=await We(r,s,i);e.close(),u?g.nk.success("导出成功"):g.nk.error("导出失败，请重试")}catch(e){console.error("导出记录失败:",e),g.nk.error("导出失败: "+(e.message||"未知错误"))}finally{o.value=!1,Fe.Ks.service().close()}},D=e=>{_e.s.confirm("此操作将永久删除该记录，是否继续？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{try{await h.A.delete(`${w.getUrl(w.endpoints.wasteRecords)}/${e.id}`),g.nk.success("删除成功"),await T()}catch(t){console.error("删除记录失败:",t),g.nk.error("删除记录失败")}})).catch((()=>{g.nk.info("已取消删除")}))},M=(e,t)=>{const o=Array.isArray(e)?e:[e];v.value=o.map((e=>`${i}${e}`)),k.value=t||0,m.value=!0},z=()=>{m.value=!1},j=()=>{console.log("手动触发加载更多");const e=document.querySelector(".el-table__body-wrapper"),o=e?e.scrollTop:0;return T(!0).then((()=>{console.log("加载完成，当前记录数:",t.value.length),setTimeout((()=>{e&&(e.scrollTop=o)}),10)})).catch((e=>{console.error("加载失败:",e),g.nk.error("加载更多数据失败")}))},O=e=>e+1,N=(0,l.EW)((()=>fo.state.isLoggedIn&&3===fo.state.user.role_id));return{records:t,filteredRecords:C,loading:o,units:a,wasteTypes:r,showFilterPanel:n,filterForm:L,applyFilter:A,resetFilter:Q,exportWithImages:X,exportWithAllImages:q,exportWithoutImages:B,parsePhotoPath:Qt,getPhotosByType:Xt,refreshRecords:P,addNewRecord:S,goToUserManagement:E,editRecord:K,confirmDelete:D,showViewer:m,previewImages:v,previewIndex:k,previewPhoto:M,closeViewer:z,baseUrl:i,page:b,currentPage:y,pageSize:_,hasMore:F,loadingMore:x,indexMethod:O,tableHeight:u,debounceTimer:R,tableRef:I,loadMore:j,tableContainer:d,isSuperAdmin:N}}};const Bt=(0,I.A)(qt,[["render",At],["__scopeId","data-v-7b0ce57c"]]);var Dt=Bt;const Mt={class:"user-profile-container"},zt={class:"header"},jt={class:"content"};function Ot(e,t,o,a,r,n){const s=(0,l.g2)("arrow-left"),i=(0,l.g2)("el-icon"),u=(0,l.g2)("el-input"),d=(0,l.g2)("el-form-item"),c=(0,l.g2)("el-divider"),p=(0,l.g2)("el-button"),m=(0,l.g2)("el-form"),g=(0,l.g2)("el-card");return(0,l.uX)(),(0,l.CE)("div",Mt,[(0,l.Lk)("div",zt,[(0,l.Lk)("div",{class:"back-button",onClick:t[0]||(t[0]=(...e)=>a.goBack&&a.goBack(...e))},[(0,l.bF)(i,null,{default:(0,l.k6)((()=>[(0,l.bF)(s)])),_:1}),t[6]||(t[6]=(0,l.eW)(" 返回 "))]),t[7]||(t[7]=(0,l.Lk)("h1",null,"个人账户设置",-1)),t[8]||(t[8]=(0,l.Lk)("div",null,null,-1))]),(0,l.Lk)("div",jt,[(0,l.bF)(g,{class:"profile-card"},{header:(0,l.k6)((()=>t[9]||(t[9]=[(0,l.Lk)("div",{class:"card-header"},[(0,l.Lk)("h3",null,"账户信息")],-1)]))),default:(0,l.k6)((()=>[(0,l.bF)(m,{ref:"profileForm",model:a.form,rules:a.rules,"label-position":"top",class:"profile-form"},{default:(0,l.k6)((()=>[(0,l.bF)(d,{label:"手机号码"},{default:(0,l.k6)((()=>[(0,l.bF)(u,{modelValue:a.form.phone,"onUpdate:modelValue":t[1]||(t[1]=e=>a.form.phone=e),disabled:"",placeholder:"手机号码"},null,8,["modelValue"]),t[10]||(t[10]=(0,l.Lk)("div",{class:"field-hint"},"手机号码不可修改",-1))])),_:1}),(0,l.bF)(d,{label:"用户名",prop:"username"},{default:(0,l.k6)((()=>[(0,l.bF)(u,{modelValue:a.form.username,"onUpdate:modelValue":t[2]||(t[2]=e=>a.form.username=e),placeholder:"请输入您的名字"},null,8,["modelValue"])])),_:1}),(0,l.bF)(c,null,{default:(0,l.k6)((()=>t[11]||(t[11]=[(0,l.eW)("修改密码（可选）")]))),_:1}),(0,l.bF)(d,{label:"原密码",prop:"oldPassword"},{default:(0,l.k6)((()=>[(0,l.bF)(u,{modelValue:a.form.oldPassword,"onUpdate:modelValue":t[3]||(t[3]=e=>a.form.oldPassword=e),placeholder:"请输入原密码",type:"password","show-password":""},null,8,["modelValue"])])),_:1}),(0,l.bF)(d,{label:"新密码",prop:"newPassword"},{default:(0,l.k6)((()=>[(0,l.bF)(u,{modelValue:a.form.newPassword,"onUpdate:modelValue":t[4]||(t[4]=e=>a.form.newPassword=e),placeholder:"请输入新密码",type:"password","show-password":""},null,8,["modelValue"]),t[12]||(t[12]=(0,l.Lk)("div",{class:"field-hint"},"如不修改密码，请留空",-1))])),_:1}),(0,l.bF)(d,{label:"确认新密码",prop:"confirmPassword"},{default:(0,l.k6)((()=>[(0,l.bF)(u,{modelValue:a.form.confirmPassword,"onUpdate:modelValue":t[5]||(t[5]=e=>a.form.confirmPassword=e),placeholder:"请再次输入新密码",type:"password","show-password":""},null,8,["modelValue"])])),_:1}),(0,l.bF)(d,null,{default:(0,l.k6)((()=>[(0,l.bF)(p,{type:"primary",onClick:a.saveProfile,loading:a.loading},{default:(0,l.k6)((()=>t[13]||(t[13]=[(0,l.eW)(" 保存修改 ")]))),_:1},8,["onClick","loading"])])),_:1})])),_:1},8,["model","rules"])])),_:1})])])}var Nt={name:"UserProfile",components:{ArrowLeft:Q.nkM},setup(){const e=(0,s.rd)(),t=(0,f.KR)(null),o=(0,f.KR)(!1),a=(0,f.Kh)({username:"",phone:"",oldPassword:"",newPassword:"",confirmPassword:""}),r=(0,f.Kh)({username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:2,max:20,message:"用户名长度应为2-20个字符",trigger:"blur"}],oldPassword:[{validator:(e,t,o)=>{a.newPassword&&!t?o(new Error("修改密码时需要输入原密码")):o()},trigger:"blur"}],newPassword:[{min:1,max:20,message:"密码长度应为1-20个字符",trigger:"blur"}],confirmPassword:[{validator:(e,t,o)=>{a.newPassword?t?t!==a.newPassword?o(new Error("两次输入的密码不一致")):o():o(new Error("请再次输入新密码")):o()},trigger:"blur"}]});(0,l.sV)((()=>{if(!fo.state.isLoggedIn)return g.nk.error("请先登录"),void e.push("/login");a.username=fo.state.user.username||"",a.phone=fo.state.user.phone||""}));const n=()=>{e.go(-1)},i=async()=>{if(fo.state.isLoggedIn)try{await t.value.validate(),await _e.s.confirm("确定要保存这些修改吗？","确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),o.value=!0;const e={username:a.username};a.newPassword&&(e.oldPassword=a.oldPassword,e.newPassword=a.newPassword),await oo.put(w.getUrl(`/api/users/${fo.state.user.id}/profile`),e),fo.updateUserInfo({...fo.state.user,username:a.username}),g.nk.success("个人资料已更新"),a.oldPassword="",a.newPassword="",a.confirmPassword="",setTimeout((()=>{n()}),1500)}catch(e){if("cancel"===e)return;e.response&&e.response.data&&e.response.data.error?g.nk.error(e.response.data.error):e.message?g.nk.error(e.message):g.nk.error("保存失败，请重试")}finally{o.value=!1}else g.nk.error("请先登录")};return{profileForm:t,form:a,rules:r,loading:o,goBack:n,saveProfile:i}}};const Ht=(0,I.A)(Nt,[["render",Ot],["__scopeId","data-v-6ab973ca"]]);var Yt=Ht;const Jt=[{path:"/login",name:"Login",component:Xe,meta:{requiresAuth:!1}},{path:"/user-management",name:"UserManagement",component:ct,meta:{requiresAuth:!0,requiresManager:!0}},{path:"/profile",name:"UserProfile",component:Yt,meta:{requiresAuth:!0}},{path:"/",name:"UnitSelection",component:R,meta:{requiresAuth:!0,requiresSuperAdmin:!0}},{path:"/admin-records",name:"AdminRecords",component:Dt,meta:{requiresAuth:!0,requiresSuperAdmin:!0}},{path:"/record/new",name:"EditRecord",component:Ze,props:{id:null},meta:{requiresAuth:!0}},{path:"/record/:id",name:"EditRecord",component:Ze,props:!0,meta:{requiresAuth:!0}},{path:"/unit/:id",name:"WasteForm",component:M,props:!0,meta:{requiresAuth:!0}},{path:"/records/:unitId",name:"RecordsList",component:Ue,props:!0,meta:{requiresAuth:!0}}],Gt=(0,s.aE)({history:(0,s.LA)("/"),routes:Jt});Gt.beforeEach(((e,t,o)=>{const a=e.matched.some((e=>e.meta.requiresAuth)),l=e.matched.some((e=>e.meta.requiresSuperAdmin)),r=e.matched.some((e=>e.meta.requiresManager));if(!a||fo.state.isLoggedIn)if(l&&fo.state.isLoggedIn&&3!==fo.state.user.role_id&&4!==fo.state.user.role_id)o({name:"WasteForm",params:{id:fo.state.user.unit_id}});else if(!r||!fo.state.isLoggedIn||1!==fo.state.user.role_id&&4!==fo.state.user.role_id){if("Login"!==e.name||!fo.state.isLoggedIn)return"/"===e.path&&fo.state.isLoggedIn?3===fo.state.user.role_id?void o({name:"AdminRecords"}):4===fo.state.user.role_id?void o({name:"EditRecord",params:{id:null}}):(fo.state.user.role_id,void o({name:"WasteForm",params:{id:fo.state.user.unit_id}})):void("WasteForm"===e.name&&fo.state.isLoggedIn&&3!==fo.state.user.role_id&&4!==fo.state.user.role_id&&fo.state.user.unit_id!==parseInt(e.params.id)?o({name:"WasteForm",params:{id:fo.state.user.unit_id}}):o());3===fo.state.user.role_id?o({name:"AdminRecords"}):4===fo.state.user.role_id?o({name:"EditRecord",params:{id:null}}):(fo.state.user.role_id,o({name:"WasteForm",params:{id:fo.state.user.unit_id}}))}else o({name:"WasteForm",params:{id:fo.state.user.unit_id}});else o({name:"Login"})}));var Zt=Gt;const eo=h.A.create({baseURL:w.baseURL,timeout:3e5,headers:{"Content-Type":"application/json"},maxContentLength:52428800,maxBodyLength:52428800});eo.interceptors.request.use((e=>{const t=localStorage.getItem("token")||sessionStorage.getItem("token");return t&&(e.headers.Authorization=`Bearer ${t}`),e}),(e=>(console.error("Request error:",e),Promise.reject(e)))),eo.interceptors.response.use((e=>e),(e=>{if(e.response)switch(e.response.status){case 401:if(e.config.url.includes("/api/login"))return Promise.reject(e);fo.logout(),g.nk.error("登录已过期，请重新登录"),Zt.push("/login");break;case 403:g.nk.error("没有权限访问该资源");break;case 404:g.nk.error("请求的资源不存在");break;case 500:g.nk.error("服务器错误，请稍后重试");break;default:g.nk.error(e.response.data?.error||"请求失败")}else e.request?g.nk.error("网络错误，请检查网络连接"):g.nk.error("请求配置错误");return Promise.reject(e)}));const to={get(e,t={}){return eo.get(e,{params:t})},post(e,t={}){return eo.post(e,t)},postForm(e,t,o){const a={headers:{"Content-Type":"multipart/form-data"},timeout:3e5,maxContentLength:52428800,maxBodyLength:52428800};"function"===typeof o&&(a.onUploadProgress=o);const l=localStorage.getItem("token")||sessionStorage.getItem("token");return l&&(a.headers.Authorization=`Bearer ${l}`),eo.post(e,t,a)},put(e,t={}){return eo.put(e,t)},putForm(e,t,o){const a={headers:{"Content-Type":"multipart/form-data"},timeout:3e5,maxContentLength:52428800,maxBodyLength:52428800};"function"===typeof o&&(a.onUploadProgress=o);const l=localStorage.getItem("token")||sessionStorage.getItem("token");return l&&(a.headers.Authorization=`Bearer ${l}`),eo.put(e,t,a)},delete(e){return eo.delete(e)},defaults:eo.defaults};var oo=to;const ao={user:null,token:null,isLoggedIn:!1,loading:!1,error:null},lo=(0,f.Kh)({...ao}),ro=()=>{const e=localStorage.getItem("user"),t=localStorage.getItem("token");if(e&&t)try{const o=JSON.parse(e);lo.user=o,lo.token=t,lo.isLoggedIn=!0,oo.defaults&&oo.defaults.headers&&(oo.defaults.headers.common["Authorization"]=`Bearer ${t}`)}catch(o){console.error("Error parsing saved user data:",o),localStorage.removeItem("user"),localStorage.removeItem("token")}},no=async(e,t,o=!1)=>{lo.loading=!0,lo.error=null,console.log("auth.login 开始执行，手机号:",e);try{const l={phone:e,rememberMe:o};null!==t&&void 0!==t&&""!==t?(l.password=t,console.log("auth.login 发送密码参数")):console.log("auth.login 不发送密码参数"),console.log("发送登录请求，数据:",l);const r=await oo.post(w.endpoints.login,l);console.log("登录请求成功响应:",r.data);const{token:n,...s}=r.data;lo.user=s,lo.token=n,lo.isLoggedIn=!0,oo.defaults&&oo.defaults.headers&&(oo.defaults.headers.common["Authorization"]=`Bearer ${n}`),o?(localStorage.setItem("user",JSON.stringify(s)),localStorage.setItem("token",n)):(sessionStorage.setItem("user",JSON.stringify(s)),sessionStorage.setItem("token",n),localStorage.removeItem("user"),localStorage.removeItem("token"));try{"caches"in window&&caches.keys().then((e=>{e.forEach((e=>{caches.delete(e)}))}))}catch(a){console.warn("清除缓存失败:",a)}return{success:!0,user:s}}catch(l){return lo.error=l.response?.data?.error||"登录失败，请检查网络连接",console.error("Login error:",l),{success:!1,error:lo.error}}finally{lo.loading=!1}},so=()=>{lo.user=null,lo.token=null,lo.isLoggedIn=!1,oo.defaults&&oo.defaults.headers&&delete oo.defaults.headers.common["Authorization"],localStorage.removeItem("user"),localStorage.removeItem("token"),sessionStorage.removeItem("user"),sessionStorage.removeItem("token")},io=()=>lo.isLoggedIn&&lo.user&&(3===lo.user.role_id||4===lo.user.role_id),uo=()=>lo.isLoggedIn&&lo.user&&2===lo.user.role_id,co=()=>lo.isLoggedIn&&lo.user&&4===lo.user.role_id,po=()=>lo.user?lo.user.id:null,mo=()=>lo.user?lo.user.unit_id:null,go=e=>{lo.isLoggedIn&&lo.user&&(lo.user={...lo.user,...e},localStorage.getItem("user")&&localStorage.setItem("user",JSON.stringify(lo.user)),sessionStorage.getItem("user")&&sessionStorage.setItem("user",JSON.stringify(lo.user)))};ro();var fo={state:lo,login:no,logout:so,isAdmin:io,isUnitAdmin:uo,isSupervisor:co,getUserId:po,getUnitId:mo,updateUserInfo:go},ho={name:"AppHeader",setup(){const e=(0,s.rd)(),t=(0,l.EW)((()=>fo.state.isLoggedIn?fo.state.user.username||fo.state.user.phone:"")),o=()=>{fo.logout(),g.nk.success("已退出登录"),e.push("/login")},a=()=>{e.push("/profile")};return{auth:fo,userName:t,handleLogout:o,goToProfile:a}}};const vo=(0,I.A)(ho,[["render",m],["__scopeId","data-v-673ebfe5"]]);var wo=vo,ko={components:{AppHeader:wo},setup(){const e=(0,s.lq)(),t=(0,l.EW)((()=>"/login"!==e.path)),o="1.0.1",a="app_version";return(0,l.sV)((()=>{const e=localStorage.getItem(a);e&&e!==o?_e.s.confirm("应用有新的更新，需要刷新页面以获取最新功能。","版本更新",{confirmButtonText:"立即刷新",cancelButtonText:"稍后再说",type:"warning"}).then((()=>{localStorage.setItem(a,o),window.location.reload(!0)})).catch((()=>{localStorage.setItem(a,o)})):localStorage.setItem(a,o)})),{showHeader:t}}};const bo=(0,I.A)(ko,[["render",n]]);var yo=bo,_o=o(6070),Fo=(o(4188),o(5186));const xo=(0,a.Ef)(yo);xo.use(Zt),xo.use(_o.A,{locale:Fo.A}),xo.mount("#app")}},t={};function o(a){var l=t[a];if(void 0!==l)return l.exports;var r=t[a]={exports:{}};return e[a].call(r.exports,r,r.exports,o),r.exports}o.m=e,function(){var e=[];o.O=function(t,a,l,r){if(!a){var n=1/0;for(d=0;d<e.length;d++){a=e[d][0],l=e[d][1],r=e[d][2];for(var s=!0,i=0;i<a.length;i++)(!1&r||n>=r)&&Object.keys(o.O).every((function(e){return o.O[e](a[i])}))?a.splice(i--,1):(s=!1,r<n&&(n=r));if(s){e.splice(d--,1);var u=l();void 0!==u&&(t=u)}}return t}r=r||0;for(var d=e.length;d>0&&e[d-1][2]>r;d--)e[d]=e[d-1];e[d]=[a,l,r]}}(),function(){o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,{a:t}),t}}(),function(){o.d=function(e,t){for(var a in t)o.o(t,a)&&!o.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={524:0};o.O.j=function(t){return 0===e[t]};var t=function(t,a){var l,r,n=a[0],s=a[1],i=a[2],u=0;if(n.some((function(t){return 0!==e[t]}))){for(l in s)o.o(s,l)&&(o.m[l]=s[l]);if(i)var d=i(o)}for(t&&t(a);u<n.length;u++)r=n[u],o.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return o.O(d)},a=self["webpackChunkhazardous_waste_management_frontend"]=self["webpackChunkhazardous_waste_management_frontend"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=o.O(void 0,[504],(function(){return o(6839)}));a=o.O(a)})();
//# sourceMappingURL=app.add2b820.js.map